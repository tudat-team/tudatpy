<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>tudatpy.data.mission_data_downloader - TudatPy API Reference</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.css?v=ab9fdd52" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     Have questions or feedback? See the <a href='https://docs.tudat.space/en/latest/index_user_guide.html'>User Guide</a> or let us know in our <a href='https://github.com/orgs/tudat-team/discussions?discussions_q='>Github Discussion forum</a>! 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">TudatPy API Reference</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">TudatPy API Reference</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../astro.html"><code class="docutils literal notranslate"><span class="pre">astro</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of astro</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../frame_conversion.html"><code class="docutils literal notranslate"><span class="pre">frame_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../element_conversion.html"><code class="docutils literal notranslate"><span class="pre">element_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../time_conversion.html"><code class="docutils literal notranslate"><span class="pre">time_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../two_body_dynamics.html"><code class="docutils literal notranslate"><span class="pre">two_body_dynamics</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../polyhedron_utilities.html"><code class="docutils literal notranslate"><span class="pre">polyhedron_utilities</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gravitation.html"><code class="docutils literal notranslate"><span class="pre">gravitation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fundamentals.html"><code class="docutils literal notranslate"><span class="pre">fundamentals</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../constants.html"><code class="docutils literal notranslate"><span class="pre">constants</span></code></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../data.html"><code class="docutils literal notranslate"><span class="pre">data</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of data</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../horizons.html"><code class="docutils literal notranslate"><span class="pre">horizons</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mpc.html"><code class="docutils literal notranslate"><span class="pre">mpc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sbdb.html"><code class="docutils literal notranslate"><span class="pre">sbdb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mission_data_downloader.html"><code class="docutils literal notranslate"><span class="pre">mission_data_downloader</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../exceptions.html"><code class="docutils literal notranslate"><span class="pre">exceptions</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of exceptions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../spice_exceptions.html"><code class="docutils literal notranslate"><span class="pre">spice_exceptions</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../interface.html"><code class="docutils literal notranslate"><span class="pre">interface</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of interface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../spice.html"><code class="docutils literal notranslate"><span class="pre">spice</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../math.html"><code class="docutils literal notranslate"><span class="pre">math</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of math</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../interpolators.html"><code class="docutils literal notranslate"><span class="pre">interpolators</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../root_finders.html"><code class="docutils literal notranslate"><span class="pre">root_finders</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../numerical_simulation.html"><code class="docutils literal notranslate"><span class="pre">numerical_simulation</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of numerical_simulation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../estimation_setup.html"><code class="docutils literal notranslate"><span class="pre">estimation_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of estimation_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../observation.html"><code class="docutils literal notranslate"><span class="pre">observation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../parameter.html"><code class="docutils literal notranslate"><span class="pre">parameter</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../environment_setup.html"><code class="docutils literal notranslate"><span class="pre">environment_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of environment_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../aerodynamic_coefficients.html"><code class="docutils literal notranslate"><span class="pre">aerodynamic_coefficients</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../atmosphere.html"><code class="docutils literal notranslate"><span class="pre">atmosphere</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ephemeris.html"><code class="docutils literal notranslate"><span class="pre">ephemeris</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gravity_field.html"><code class="docutils literal notranslate"><span class="pre">gravity_field</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../gravity_field_variation.html"><code class="docutils literal notranslate"><span class="pre">gravity_field_variation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ground_station.html"><code class="docutils literal notranslate"><span class="pre">ground_station</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../radiation_pressure.html"><code class="docutils literal notranslate"><span class="pre">radiation_pressure</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rigid_body.html"><code class="docutils literal notranslate"><span class="pre">rigid_body</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rotation_model.html"><code class="docutils literal notranslate"><span class="pre">rotation_model</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../shape.html"><code class="docutils literal notranslate"><span class="pre">shape</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../shape_deformation.html"><code class="docutils literal notranslate"><span class="pre">shape_deformation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../vehicle_systems.html"><code class="docutils literal notranslate"><span class="pre">vehicle_systems</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../propagation_setup.html"><code class="docutils literal notranslate"><span class="pre">propagation_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of propagation_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../acceleration.html"><code class="docutils literal notranslate"><span class="pre">acceleration</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../dependent_variable.html"><code class="docutils literal notranslate"><span class="pre">dependent_variable</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../integrator.html"><code class="docutils literal notranslate"><span class="pre">integrator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mass_rate.html"><code class="docutils literal notranslate"><span class="pre">mass_rate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../propagator.html"><code class="docutils literal notranslate"><span class="pre">propagator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../torque.html"><code class="docutils literal notranslate"><span class="pre">torque</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../thrust.html"><code class="docutils literal notranslate"><span class="pre">thrust</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../estimation.html"><code class="docutils literal notranslate"><span class="pre">estimation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../environment.html"><code class="docutils literal notranslate"><span class="pre">environment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../propagation.html"><code class="docutils literal notranslate"><span class="pre">propagation</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../trajectory_design.html"><code class="docutils literal notranslate"><span class="pre">trajectory_design</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of trajectory_design</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../transfer_trajectory.html"><code class="docutils literal notranslate"><span class="pre">transfer_trajectory</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shape_based_thrust.html"><code class="docutils literal notranslate"><span class="pre">shape_based_thrust</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plotting.html"><code class="docutils literal notranslate"><span class="pre">plotting</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../util.html"><code class="docutils literal notranslate"><span class="pre">util</span></code></a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for tudatpy.data.mission_data_downloader</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="c1">### Import Relevant (Sub)Modules</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.request</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlretrieve</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">spice</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tabulate</span><span class="w"> </span><span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">colorama</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>


<span class="c1">### Class for Loading PDS files</span>
<div class="viewcode-block" id="LoadPDS">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LoadPDS</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_check_existing_files</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_load_standard_kernels</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;juice&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;juice)_(?P&lt;instrument&gt;(sc|mga|sa))_(?P&lt;data_type&gt;(meas|crema_\w+_baseline))?_?(?P&lt;reference_file&gt;[a-zA-Z]+)?_?(?P&lt;prod_ID&gt;[a-zA-Z]+)?_?(?P&lt;start_date_file&gt;(\d</span><span class="si">{6}</span><span class="s2">|\d</span><span class="si">{8}</span><span class="s2">))?_?(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;sclk&gt;(s|t|f)\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.bc)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;juice)_(?P&lt;data_type&gt;(orbc|crema))_(?P&lt;reference_file_prod_ID&gt;(\d</span><span class="si">{6}</span><span class="s2">|\w+_plan))?_?(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.bsp)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;juice)_(?P&lt;data_type&gt;(dsk_surfaces|events_\w+|ops|roi|sci|stations_topo))_(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.tf)$&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;mro&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)_(?P&lt;instrument&gt;(sc|hga|sa))_(?P&lt;mission_phase&gt;(cru|ab|psp|rel|psp))_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)?(?P&lt;extension&gt;\.bc)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)_(?P&lt;instrument&gt;(sc|hga|sa|struct))_(?P&lt;mission_phase&gt;(cru|ab|psp|rel|psp))_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)?(?P&lt;extension&gt;\.bsp)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;odf&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)(?P&lt;dataset&gt;magr)(?P&lt;date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">_\d</span><span class="si">{4}</span><span class="s2">)(?P&lt;uplink&gt;x|n)(?P&lt;station&gt;nn|mm|[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;downlink&gt;[123m])(?P&lt;version&gt;v\d+)(?P&lt;extension&gt;\.odf)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tnf&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)(?P&lt;dataset&gt;magr)(?P&lt;date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">_\d</span><span class="si">{4}</span><span class="s2">)(?P&lt;uplink&gt;x|n)(?P&lt;station&gt;nn|mm|[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;downlink&gt;[123m])(?P&lt;version&gt;v\d+)(?P&lt;extension&gt;\.tnf)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tro&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)(?P&lt;dataset&gt;magr)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.tro)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;mro)(?P&lt;dataset&gt;magr)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.ion)$&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;lro&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;lro)(?P&lt;instrument&gt;(sc|hg|sa|dv|))_(?P&lt;start_date_file&gt;\d</span><span class="si">{7}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{7}</span><span class="s2">)_(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.bc)$&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;cassini&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;start_date_file&gt;\d</span><span class="si">{5}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{5}</span><span class="s2">)(?P&lt;type&gt;(p|r))(?P&lt;version&gt;[a-z])(?P&lt;freeform&gt;\w+)?(?P&lt;extension&gt;\.bc)$&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;insight&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;insight)_(?P&lt;purpose&gt;(cru_rec|edl_rec|surf_ops|))_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.bc)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;mex&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;MEX)?_?(?P&lt;data&gt;ATNM)?_?(?P&lt;purpose&gt;(MEASURED|T6|SA))?_?(?P&lt;start_date_file&gt;(\d</span><span class="si">{4}</span><span class="s2">|\d</span><span class="si">{6}</span><span class="s2">|P\d</span><span class="si">{12}</span><span class="s2">))?_?(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;sclk&gt;S\d</span><span class="si">{6}</span><span class="s2">)?_?(?P&lt;version&gt;(V\d+|\d+))?(?P&lt;extension&gt;\.BC)?$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="s2">&quot;^(?P&lt;data&gt;(ORMM|ORMF))_(?P&lt;SPK_type&gt;T19)_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_?(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;version&gt;\d</span><span class="si">{5}</span><span class="s2">)(?P&lt;extension&gt;\.BSP)?$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ifms&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]</span><span class="si">{9}</span><span class="s2">)_(?P&lt;version&gt;[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.tab$)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dp2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]</span><span class="si">{9}</span><span class="s2">)_(?P&lt;version&gt;[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.tab$)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dpx&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]</span><span class="si">{9}</span><span class="s2">)_(?P&lt;version&gt;[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.tab$)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dps&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]</span><span class="si">{9}</span><span class="s2">)_(?P&lt;version&gt;[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.tab$)&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;gra)_(?P&lt;instrument&gt;rec)_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)(?P&lt;extension&gt;\.bc)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grail)_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;instrument&gt;(sci|nav))_(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)?(?P&lt;extension&gt;\.bsp)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;odf&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;(gra))(?P&lt;experiment&gt;lugf)(?P&lt;date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">_\d</span><span class="si">{4}</span><span class="s2">)(?P&lt;pre_version&gt;smmm)(?P&lt;version&gt;v\d{1,2})(?P&lt;extension&gt;\.odf)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tro&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grx)(?P&lt;experiment&gt;lugf)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.tro)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;gra)(?P&lt;experiment&gt;lugf)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.ion)$&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grb)_(?P&lt;instrument&gt;rec)_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)(?P&lt;extension&gt;\.bc)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grail)_(?P&lt;start_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{6}</span><span class="s2">)_(?P&lt;instrument&gt;(sci|nav))_(?P&lt;version&gt;v\d</span><span class="si">{2}</span><span class="s2">)?(?P&lt;extension&gt;\.bsp)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;odf&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;(grb))(?P&lt;experiment&gt;lugf)(?P&lt;date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">_\d</span><span class="si">{4}</span><span class="s2">)(?P&lt;pre_version&gt;smmm)(?P&lt;version&gt;v\d{1,2})(?P&lt;extension&gt;\.odf)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;tro&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grx)(?P&lt;experiment&gt;lugf)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.tro)$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;grb)(?P&lt;experiment&gt;lugf)(?P&lt;start_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)_(?P&lt;end_date_file&gt;\d</span><span class="si">{4}</span><span class="s2">_\d</span><span class="si">{3}</span><span class="s2">)(?P&lt;extension&gt;\.ion)$&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="c1"># &quot;DP2&quot;: r&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]{9})_(?P&lt;version&gt;[0-9]{2})(?P&lt;extension&gt;\.TAB$)&quot;,</span>
                <span class="s2">&quot;dp2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;[a-zA-Z0-9]+)_(?P&lt;band&gt;[a-zA-Z0-9]+)_(?P&lt;date_file&gt;[0-9]</span><span class="si">{9}</span><span class="s2">)_(?P&lt;version&gt;[0-9]</span><span class="si">{2}</span><span class="s2">)(?P&lt;extension&gt;\.TAB$)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;^(?P&lt;mission&gt;ROS)?_?(?P&lt;data&gt;(ATNM|CATT|LATT|RATM|ROTT))?(?:_+(?P&lt;token1&gt;[A-Z0-9]+))?(?:_+(?P&lt;token2&gt;[A-Z0-9]+))?(?:_+(?P&lt;token3&gt;[A-Z0-9]+))?(?:_+(?P&lt;token4&gt;[A-Z0-9]+))?$&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mes&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;()&quot;</span><span class="p">,</span>
                <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;()&quot;</span><span class="p">,</span>

            <span class="p">}</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cassini_titan_flyby_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;T011&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0133&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;27.02.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2006</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T022&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0168&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;28.12.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">362</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2006</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T033&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr8&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0176&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;29.06.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2007</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T045&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr11&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0239&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;30.07.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">212</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2008</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T068&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr15&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0320&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;19.05.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">139</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2010</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T074&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr16&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0349, cors_0350&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0349&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0350&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;18.02.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2011</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T089&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr17&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0394, cors_0395&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0394&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0395&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;16.02.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2013</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T099&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr18&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0487, cors_0488&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0487&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0488&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;06.03.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2014</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T110&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr19&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0525&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;16.03.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;T122&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;tigr20&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pds_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0566, cors_0567&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ancillary_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0566&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cumindex_repo&quot;</span><span class="p">:</span> <span class="s2">&quot;cors_0567&quot;</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;09.08.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;doy&quot;</span><span class="p">:</span> <span class="mi">222</span><span class="p">,</span>
                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2016</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>



        <span class="c1"># Mapping of data types to their expected file extensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ck&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bc&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dsk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bds&quot;</span><span class="p">],</span>
            <span class="s2">&quot;spk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bsp&quot;</span><span class="p">],</span>
            <span class="s2">&quot;fk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tf&quot;</span><span class="p">],</span>
            <span class="s2">&quot;mk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tm&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ik&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ti&quot;</span><span class="p">],</span>
            <span class="s2">&quot;lsk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tls&quot;</span><span class="p">],</span>
            <span class="s2">&quot;pck&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bpc&quot;</span><span class="p">,</span> <span class="s2">&quot;tpc&quot;</span><span class="p">],</span>     <span class="c1"># supports both PCK types</span>
            <span class="s2">&quot;sclk&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tsc&quot;</span><span class="p">],</span>
            <span class="s2">&quot;odf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;odf&quot;</span><span class="p">],</span>
            <span class="s2">&quot;tnf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tnf&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ifms&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tab&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dp2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tab&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dps&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tab&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dpx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tab&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">],</span>
            <span class="s2">&quot;tro&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tro&quot;</span><span class="p">],</span>
            <span class="s2">&quot;eop&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;eop&quot;</span><span class="p">],</span>
            <span class="s2">&quot;maneuver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;asc&quot;</span><span class="p">],</span>
            <span class="s2">&quot;antenna_switch&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;asc&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="c1"># Mapping of data types to their expected file extensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_odf_time_formats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mro&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYY_jjj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYY_jjj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span> <span class="s2">&quot;YYYY_jjj&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_url</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mro&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/extras/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mex&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cassini&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/co-s_j_e_v-spice-6-v1.0/cosp_1000/extras/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/extras/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/extras/mk/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/mk/&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_pattern</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mro&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(mro)_(\d</span><span class="si">{4}</span><span class="s2">)_v(\d</span><span class="si">{2}</span><span class="s2">)\.tm$&quot;</span><span class="p">),</span>
            <span class="s2">&quot;mex&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;MEX_OPS.TM&quot;</span><span class="p">),</span>
            <span class="s2">&quot;juice&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;juice_ops.tm&quot;</span><span class="p">),</span>
            <span class="s2">&quot;cassini&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^cas_(\d</span><span class="si">{4}</span><span class="s2">)_v(\d</span><span class="si">{2}</span><span class="s2">)\.tm$&quot;</span><span class="p">),</span>
            <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^grail_v(\d</span><span class="si">{2}</span><span class="s2">)\.tm$&quot;</span><span class="p">),</span>
            <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^grail_v(\d</span><span class="si">{2}</span><span class="s2">)\.tm$&quot;</span><span class="p">),</span>
            <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ROS_OPS.TM&quot;</span><span class="p">),</span>

        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_kernels_url</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mro&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mex&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cassini&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/co-s_j_e_v-spice-6-v1.0/cosp_1000/data/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ro&quot;</span><span class="p">:</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.print_titan_flyby_table">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.print_titan_flyby_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_titan_flyby_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        This method prints a table displaying the Titan flyby data in a readable format. It iterates over the `cassini_titan_flyby_dict`, extracts relevant information for each flyby, and constructs a table. The table is formatted with headers and colored using the `colorama` library for enhanced readability.</span>

<span class="sd">        Input:</span>
<span class="sd">            None.</span>

<span class="sd">        Output:</span>
<span class="sd">            None: This method prints the formatted table to the console.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cassini_titan_flyby_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;pds_repo&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;ancillary_repo&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;cumindex_repo&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;doy&quot;</span><span class="p">],</span>
                <span class="n">value</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Flyby ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Experiment&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PDS Repository&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ancillary Repository&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Cumulative Index Repository&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Date&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Year&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Adding color to the header</span>
        <span class="n">colored_headers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Fore</span><span class="o">.</span><span class="n">MAGENTA</span><span class="si">}{</span><span class="n">header</span><span class="si">}{</span><span class="n">Fore</span><span class="o">.</span><span class="n">RESET</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colored_headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;fancy_grid&quot;</span><span class="p">,</span> <span class="n">stralign</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">))</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.spice_transfer2binary">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.spice_transfer2binary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">spice_transfer2binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Converts transfer-file format SPICE kernels (e.g., .ckf, .spk)</span>
<span class="sd">            into binary SPICE kernels (e.g., .ck, .bsp) using the SPACIT utility.</span>
<span class="sd">            This is necessary for loading the kernels with spice.load_kernels.</span>
<span class="sd">            The function handles the conversion by running the SPACIT tool as a subprocess and</span>
<span class="sd">            manages timeouts during the conversion process.</span>

<span class="sd">        Input:</span>
<span class="sd">            - input_file (str): The path to the SPICE kernel file to be converted. It must have either a .ckf or .spk extension.</span>
<span class="sd">            - timeout (int, optional): The timeout duration for the SPACIT process, default is 5 seconds.</span>

<span class="sd">        Output:</span>
<span class="sd">            - str: The path to the output file (either .ck or .bsp), depending on the input file type. If the output file already exists, the function returns the existing output file path.</span>

<span class="sd">        Notes:</span>
<span class="sd">            If the conversion fails or times out, an error message is printed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">input_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ckf&quot;</span><span class="p">):</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.ck&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
                <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;spacit&quot;</span><span class="p">],</span>
                    <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Write the necessary inputs to the process&#39; stdin stream</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;T</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Command to convert transfer files to binary</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Input file</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output file</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Wait for the process to finish, with a timeout</span>
                    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

                    <span class="c1"># Check if the process was successful</span>
                    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Error converting </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> to binary. Error: </span><span class="si">{</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Successfully converted </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">. Output: </span><span class="si">{</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Kill the process if it times out</span>

            <span class="k">return</span> <span class="n">output_file</span>

        <span class="k">elif</span> <span class="n">input_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.spk&quot;</span><span class="p">):</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.bsp&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_file</span><span class="p">):</span>
                <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;spacit&quot;</span><span class="p">],</span>
                    <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Write the necessary inputs to the process&#39; stdin stream</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;T</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Command to convert transfer files to binary</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Input file</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output file</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Wait for the process to finish, with a timeout</span>
                    <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>

                    <span class="c1"># Check if the process was successful</span>
                    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Error converting </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> to binary. Error: </span><span class="si">{</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Successfully converted </span><span class="si">{</span><span class="n">input_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">. Output: </span><span class="si">{</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
                    <span class="n">proc</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Kill the process if it times out</span>

            <span class="k">return</span> <span class="n">output_file</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="n">input_file</span>
            <span class="k">return</span> <span class="n">output_file</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">create_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">placeholders</span><span class="p">):</span>
        <span class="n">final_pattern</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">placeholder</span> <span class="ow">in</span> <span class="n">placeholders</span><span class="p">:</span>
            <span class="n">escaped</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">placeholder</span><span class="p">)</span>
            <span class="c1"># Replace specific dynamic sections with regex patterns</span>
            <span class="c1"># Replace sequences of digits with a numeric pattern</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;[0-9]+&quot;</span><span class="p">,</span> <span class="n">escaped</span><span class="p">)</span>
            <span class="c1"># Replace fixed-length sequences of lowercase letters (e.g., &quot;sc&quot;, &quot;hg&quot;) with a general pattern</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;start_date_file&quot;</span>
                <span class="ow">or</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;end_date_file&quot;</span>
                <span class="ow">or</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span>
            <span class="p">):</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[0-9]+&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[a-z]{1,}&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;[a-z]{1,}&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                <span class="n">placeholder_mapping</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>
            <span class="k">elif</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span>
                <span class="n">placeholder_mapping</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">placeholder</span><span class="si">}</span><span class="s2">&gt;v</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;extension&quot;</span><span class="p">:</span>
                <span class="n">placeholder_mapping</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">placeholder</span><span class="si">}</span><span class="s2">&gt;.</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="n">placeholder</span> <span class="o">==</span> <span class="s2">&quot;start_date_file&quot;</span><span class="p">:</span>
                <span class="n">placeholder_mapping</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">placeholder</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">placeholder_mapping</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(?P&lt;</span><span class="si">{</span><span class="n">placeholder</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">final_pattern</span> <span class="o">+=</span> <span class="n">placeholder_mapping</span>

        <span class="c1"># Add start and end anchors</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;^</span><span class="si">{</span><span class="n">final_pattern</span><span class="si">}</span><span class="s2">$&quot;</span>

    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.format_string_to_datetime">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.format_string_to_datetime">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_string_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Attempts to convert a given date string into a `datetime` object using multiple supported time formats. The function iterates over a list of predefined date formats (e.g., `%y%m%d`, `%Y%j`, `%Y_%j`) and tries each format until it successfully parses the date. This is used throughout the code to handle various date formats from different mission data files.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `date` (`str`): The date string to be parsed.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `datetime`: The parsed `datetime` object if a matching format is found, or `None` if no format matches.</span>

<span class="sd">        Notes:</span>
<span class="sd">            The function supports multiple date formats, such as:</span>
<span class="sd">            - `YYMMDD` (e.g., `220101`)</span>
<span class="sd">            - `YYYYjjj` (e.g., `2022323`)</span>
<span class="sd">            - `YYYY_MM_DD` (e.g., `2022_03_15`)</span>
<span class="sd">            - And others, tailored for specific mission data.</span>
<span class="sd">            If no matching format is found, the function silently skips to the next format without throwing an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_time_formats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;YYMMDD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYYjjj&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y%j&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_jjj&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%j&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYjjjhhmm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%y%j%H%M&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_JJJ_hhmm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%j_%H%M&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_MM_DD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY-jjjThhmmss&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y-%jT%H:%M:%S&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYYMMDD_&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_&quot;</span><span class="p">,</span>
            <span class="p">),</span>  <span class="c1"># added this for mex_sa_date_trick (formats %Y_%j_%H%M and %Y%m%d might be confused, so I add an artificial underscore.)</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">str_format</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_time_formats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">str_format</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span></div>


<div class="viewcode-block" id="LoadPDS.format_datetime_to_string">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.format_datetime_to_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_datetime_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">format_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Converts a `datetime` object to a string based on a specified format key from a list of supported formats. The function maps the provided format key (e.g., &quot;YYMMDD&quot;, &quot;YYYY-jjj&quot;) to a corresponding `strftime` format string and then formats the given `datetime` object accordingly.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `date` (`datetime`): The `datetime` object to be formatted.</span>
<span class="sd">            - `format_key` (`str`): A key from the `supported_time_formats` dictionary that specifies the desired output format.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `str`: The formatted date string according to the specified format key.</span>

<span class="sd">        Notes:</span>
<span class="sd">            The function supports several predefined date formats, such as:</span>
<span class="sd">            - `&quot;YYMMDD&quot;`: e.g., `220101`</span>
<span class="sd">            - `&quot;YYYYjjj&quot;`: e.g., `2022323`</span>
<span class="sd">            - `&quot;YYYY-MM-DD&quot;`: e.g., `2022-03-15`</span>
<span class="sd">            If the provided `format_key` is not in the supported formats, an error message is printed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_time_formats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;YYMMDD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYYjjj&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y%j&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_jjj&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%j&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYjjjhhmm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%y%j%H%M&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_JJJ_hhmm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%j_%H%M&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY_MM_DD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYY-MM-DD&quot;</span><span class="p">:</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;YYYYMMDD_&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_&quot;</span>
            <span class="p">),</span>  <span class="c1"># added this for mex_sa_date_trick (formats %Y_%j_%H%M and %Y%m%d might be confused, so I add an artificial underscore.)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">format_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_time_formats</span><span class="p">:</span>
            <span class="c1"># Get the format string and use strftime to format the datetime</span>
            <span class="n">str_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_time_formats</span><span class="p">[</span><span class="n">format_key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">str_format</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Format key not supported&quot;</span><span class="p">)</span></div>

        <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_kernels">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_kernels">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_kernels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_mission</span><span class="p">,</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">wanted_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">wanted_files_patterns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads specific SPICE kernel files or files matching a pattern from a given URL to a local directory</span>
<span class="sd">        if they do not already exist locally.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `input_mission` (`str`): The name of the mission</span>
<span class="sd">            - `url` (`str`): The base URL where the kernel files are hosted.</span>
<span class="sd">            - `wanted_files` (`list`, optional): A list of specific filenames to be downloaded from the URL.</span>
<span class="sd">            - `wanted_files_pattern` (`str`, optional): A pattern (e.g., &#39;\*.tf&#39;) to match filenames for downloading.</span>
<span class="sd">            - `custom_output` (`str`, optional): The local directory where the downloaded files will be stored.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `list`: A list of full file paths for the downloaded (or already existing) kernel files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># Determine data type and file extension</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extension_for_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span> <span class="ow">and</span> <span class="n">wanted_files</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">wanted_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;asc&quot;</span><span class="p">:</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;maneuver&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;level_1b&quot;</span><span class="p">:</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;antenna_switch&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;level_0&quot;</span><span class="p">:</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;maneuver&quot;</span>

        <span class="k">if</span> <span class="n">custom_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_mission</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="s2">&quot;grail-a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;grail-b&quot;</span><span class="p">,</span>
            <span class="p">}:</span>  <span class="c1"># both grail-a and -b found in grail archive</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_output</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_mission</span> <span class="ow">in</span> <span class="p">{</span>
                <span class="s2">&quot;grail-a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;grail-b&quot;</span><span class="p">,</span>
            <span class="p">}:</span>  <span class="c1"># both grail-a and -b found in grail archive</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grail_archive/</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">_archive/&quot;</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">data_type</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Retrieve files matching pattern if specified</span>
        <span class="n">matched_files_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">wanted_files_patterns</span><span class="p">:</span>
            <span class="c1"># Parse the URL to find matching files</span>
            <span class="n">reqs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">reqs</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">wanted_files_pattern</span> <span class="ow">in</span> <span class="n">wanted_files_patterns</span><span class="p">:</span>
                <span class="c1"># Extract all links that match the pattern</span>
                <span class="n">regex_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">wanted_files_pattern</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\*&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">)</span>
                <span class="n">matched_files</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_pattern</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="n">matched_files_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">matched_files</span><span class="p">)</span>

        <span class="c1"># Combine explicitly specified files and pattern-matched files</span>
        <span class="n">all_files_to_download</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">wanted_files</span> <span class="ow">or</span> <span class="p">[])</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">matched_files_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files_to_load</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">all_files_to_download</span>
        <span class="p">]</span>



        <span class="c1"># Download each file if not already present</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">local_file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_files_to_download</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_to_load</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_file</span><span class="p">):</span>
                <span class="n">full_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading File: </span><span class="si">{</span><span class="n">full_url</span><span class="si">}</span><span class="s2"> to: </span><span class="si">{</span><span class="n">local_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">urlretrieve</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">local_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">local_file</span><span class="si">}</span><span class="s2"> already exists in: </span><span class="si">{</span><span class="n">base_folder</span><span class="si">}</span><span class="s2"> and will not be downloaded.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_to_load</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.add_custom_mission_kernel_pattern">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.add_custom_mission_kernel_pattern">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_custom_mission_kernel_pattern</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">custom_kernel_type</span><span class="p">,</span> <span class="n">custom_pattern</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Allows users to define and add custom regex patterns for a specific mission to the list of supported patterns. Once added, the custom pattern can be used for mission data file matching.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `input_mission` (`str`): The name of the mission for which the custom pattern is defined.</span>
<span class="sd">            - `custom_kernel_type`: the name of kernel type (eg &#39;ck&#39;., &#39;spk&#39;, etc...)</span>
<span class="sd">            - `custom_pattern` (`str`): The regular expression pattern that will be associated with the mission kernel.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `dict`: The updated `supported_patterns` dictionary containing the new custom pattern.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function updates the `supported__kernel_patterns` dictionary with the new mission and its associated pattern.</span>
<span class="sd">            - Custom patterns can be added dynamically at runtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">custom_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">custom_dict</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">custom_kernel_type</span><span class="p">:</span> <span class="n">custom_pattern</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span></div>


<div class="viewcode-block" id="LoadPDS.add_custom_mission_meta_kernel_url">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.add_custom_mission_meta_kernel_url">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_custom_mission_meta_kernel_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Allows users to define and add custom regex patterns for a specific mission to the list of supported patterns. Once added, the custom pattern can be used for mission data file matching.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `input_mission` (`str`): The name of the mission for which the custom pattern is defined.</span>
<span class="sd">            - `url` (`str`): The url that will be associated with the mission.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `dict`: The updated `supported_mission_meta_kernel_url` dictionary containing the new custom pattern.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function updates the `supported_mission_meta_kernel_url` dictionary with the new mission and its associated pattern.</span>
<span class="sd">            - Custom patterns can be added dynamically at runtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">custom_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">custom_dict</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_url</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_url</span></div>


<div class="viewcode-block" id="LoadPDS.add_custom_mission_kernel_url">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.add_custom_mission_kernel_url">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_custom_mission_kernel_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Allows users to define and add custom regex patterns for a specific mission to the list of supported patterns. Once added, the custom pattern can be used for mission data file matching.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `input_mission` (`str`): The name of the mission for which the custom pattern is defined.</span>
<span class="sd">            - `url` (`str`): The url that will be associated with the mission.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `dict`: The updated `supported_mission_kernels_url` dictionary containing the new custom pattern.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function updates the `supported_mission_kernels_url` dictionary with the new mission and its associated pattern.</span>
<span class="sd">            - Custom patterns can be added dynamically at runtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">custom_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">custom_dict</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_kernels_url</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_kernels_url</span></div>


<div class="viewcode-block" id="LoadPDS.add_custom_mission_meta_kernel_pattern">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.add_custom_mission_meta_kernel_pattern">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_custom_mission_meta_kernel_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">custom_pattern</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Allows users to define and add custom regex patterns for a specific mission to the list of supported patterns. Once added, the custom pattern can be used for mission data file matching.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `input_mission` (`str`): The name of the mission for which the custom pattern is defined.</span>
<span class="sd">            - `custom_pattern` (`str`): The regular expression pattern that will be associated with the mission.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `dict`: The updated `supported_mission_kernel_pattern` dictionary containing the new custom pattern.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - This function updates the `supported_mission_kernel_pattern` dictionary with the new mission and its associated pattern.</span>
<span class="sd">            - Custom patterns can be added dynamically at runtime.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">custom_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">custom_dict</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_pattern</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">custom_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_pattern</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.is_date_in_intervals">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.is_date_in_intervals">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_date_in_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">intervals</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Checks if a given date falls within any of the specified date intervals.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `date` (`datetime`): The date to check.</span>
<span class="sd">            - `intervals` (`list` of tuples): A list of tuples, where each tuple contains two `datetime` objects representing the start and end of an interval.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `bool`: `True` if the date falls within any of the intervals, otherwise `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_intervals</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">date</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_intervals</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_intervals</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.clean_mission_archive">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.clean_mission_archive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean_mission_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Cleans up the mission archive by removing empty subdirectories within the specified local folder.</span>

<span class="sd">        Input:</span>
<span class="sd">            - `local_folder` (`str`): Path to the local folder where the archive is stored.</span>

<span class="sd">        Output:</span>
<span class="sd">            - `None`: This function does not return any value. It performs in-place directory cleanup.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaning Mission Archive...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_folder</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">local_folder</span><span class="p">):</span>
                <span class="n">directory_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done.&quot;</span><span class="p">)</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.match_type_extension">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.match_type_extension">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">match_type_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the extension of a given file matches the expected extension for the specified data type.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_type (str): The data type (e.g., &#39;ck&#39;, &#39;spk&#39;, &#39;odf&#39;, etc.).</span>
<span class="sd">            filename (str): The filename whose extension is to be checked.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the file extension matches any valid extension for the given data type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the file extension and compare it</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">valid_exts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_exts</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valid_exts</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">valid_exts</span> <span class="o">=</span> <span class="p">[</span><span class="n">valid_exts</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">valid_exts</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_extension_for_data_type">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_extension_for_data_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_extension_for_data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">first_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns one or more file extensions for the given data type.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_type (str): The data type (e.g., &#39;ck&#39;, &#39;spk&#39;, etc.).</span>
<span class="sd">            first_only (bool): If True, returns only the first matching extension.</span>
<span class="sd">                            If False, returns a list of all valid extensions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str or list[str] or None: Extension(s) for the given data type, or None if unsupported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">first_only</span> <span class="k">else</span> <span class="n">ext</span>
        <span class="k">return</span> <span class="n">ext</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.dynamic_download_url_files_single_time">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.dynamic_download_url_files_single_time">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dynamic_download_url_files_single_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">url</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Downloads files for a single time interval based on specified mission parameters and date range.</span>
<span class="sd">            It checks if the files already exist locally, and if not, attempts to download them from the specified URL.</span>
<span class="sd">            The filenames are matched to supported patterns, and relevant files are downloaded if they are not already present.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - input_mission (`str`): The name of the mission (e.g., &#39;cassini&#39;, &#39;mro&#39;).</span>
<span class="sd">            - local_path (`str`): The local directory where the files should be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date of the time interval for which files are required.</span>
<span class="sd">            - end_date (`datetime`): The end date of the time interval for which files are required.</span>
<span class="sd">            - url (`str`): The base URL where the files are hosted.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `self.relevant_files` (`list`): A list of paths to the files that were either already present or successfully downloaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking URL:&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">local_subfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="n">supported_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span><span class="p">[</span><span class="n">input_mission</span><span class="p">][</span><span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Pattern not found among supported patterns.&quot;</span><span class="p">)</span>

        <span class="n">existing_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_existing_files</span><span class="p">(</span>
            <span class="n">data_type</span><span class="p">,</span> <span class="n">local_subfolder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">existing_files</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_check_existing_files</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;--------------------------------------- EXISTING FILES CHECK ----------------------------------------------&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The following files already exist in the folder:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">existing_files</span><span class="si">}</span><span class="se">\n\n</span><span class="s2"> and will not be downloaded.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">existing_files</span><span class="p">)</span>

        <span class="n">all_dates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Initialize a dictionary to hold files from the HTML response</span>
        <span class="n">files_url_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">reqs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">reqs</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Parse links from the HTML response</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">reqs</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;[To Parent Directory]&quot;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
                <span class="n">full_link</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>  <span class="c1"># Extract the href attribute</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">full_link</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Check if the link is a full URL or a relative path</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">full_link</span><span class="p">:</span>
                        <span class="c1"># It&#39;s a full URL</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                            <span class="n">full_link</span>
                        <span class="p">)</span>  <span class="c1"># Get the filename from the URL</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># It&#39;s a relative path</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">full_link</span>

                    <span class="c1"># Check if the filename matches the specified format</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_type_extension</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">RS_dict</span><span class="p">,</span> <span class="n">RS_underscores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filename</span><span class="p">(</span>
                                <span class="n">input_mission</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span>
                            <span class="p">)</span>
                            <span class="n">filename_to_download</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_filename</span><span class="p">(</span>
                                <span class="n">RS_dict</span><span class="p">,</span> <span class="n">RS_underscores</span>
                            <span class="p">)</span>
                            <span class="c1"># Determine the date string format</span>
                            <span class="n">date_key</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">RS_dict</span><span class="p">[</span><span class="s2">&quot;date_file&quot;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;mex&quot;</span> <span class="ow">or</span> <span class="s2">&quot;ro&quot;</span>
                                <span class="k">else</span> <span class="n">RS_dict</span><span class="p">[</span><span class="s2">&quot;date_file&quot;</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">files_url_dict</span><span class="p">[</span><span class="n">date_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename_to_download</span>

                            <span class="c1"># Downloading only the latest version of a file</span>
                            <span class="n">version</span> <span class="o">=</span> <span class="n">RS_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                <span class="s2">&quot;version&quot;</span>
                            <span class="p">)</span>  <span class="c1"># Define default version if not provided</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                                <span class="n">files_url_dict</span><span class="p">[(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">filename_to_download</span>
                                <span class="p">)</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ext</span> <span class="o">=</span> <span class="n">RS_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extension&quot;</span><span class="p">)</span>
                                <span class="c1"># Extract the base filename without the version</span>
                                <span class="n">base_name_no_version_no_ext</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">filename_to_download</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                        <span class="n">ext</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                                <span class="n">current_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                    <span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                                <span class="p">)</span>  <span class="c1"># Extract numeric version (e.g., v02 -&gt; 2)</span>
                                <span class="c1"># Only store the highest version</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                    <span class="n">base_name_no_version_no_ext</span> <span class="ow">in</span> <span class="n">value</span>
                                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">files_url_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                                <span class="p">):</span>
                                    <span class="n">files_url_dict</span><span class="p">[</span><span class="n">date_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename_to_download</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">stored_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">RS_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                                    <span class="k">if</span> <span class="n">current_version</span> <span class="o">&gt;=</span> <span class="n">stored_version</span><span class="p">:</span>
                                        <span class="n">latest_filename_to_download</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name_no_version_no_ext</span><span class="si">}{</span><span class="n">version</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="n">files_url_dict</span><span class="p">[</span><span class="n">date_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">latest_filename_to_download</span>
                                        <span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">input_mission</span> <span class="o">!=</span> <span class="s2">&quot;grail-a&quot;</span>
                                <span class="ow">and</span> <span class="n">input_mission</span> <span class="o">!=</span> <span class="s2">&quot;grail-b&quot;</span>
                            <span class="p">):</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> - Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="c1"># Download missing files</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;mex&quot;</span> <span class="ow">or</span> <span class="s2">&quot;ro&quot;</span><span class="p">:</span>
                <span class="n">date_string</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">02d</span><span class="si">}{</span><span class="n">date</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input_mission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_odf_time_formats</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">format_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_odf_time_formats</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span>
                    <span class="n">date_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_datetime_to_string</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">format_key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No ODF time format associated to input mission: </span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">. Please provide it in self.supported_mission_odf_time_formats.&quot;</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">date_string</span> <span class="ow">in</span> <span class="n">files_url_dict</span><span class="p">:</span>
                <span class="n">download_file</span> <span class="o">=</span> <span class="n">files_url_dict</span><span class="p">[</span><span class="n">date_string</span><span class="p">]</span>
                <span class="n">full_download_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">download_file</span><span class="p">)</span>

                <span class="n">full_local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span> <span class="n">download_file</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">existing_files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">full_local_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_files</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Downloading: </span><span class="si">{</span><span class="n">full_download_url</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span><span class="w"> </span><span class="n">download_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                            <span class="n">urlretrieve</span><span class="p">(</span>
                                <span class="n">full_download_url</span><span class="p">,</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span> <span class="n">download_file</span><span class="p">),</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_local_path</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!! Failed to download </span><span class="si">{</span><span class="n">full_download_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> !!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Downloading: </span><span class="si">{</span><span class="n">full_download_url</span><span class="si">}</span><span class="s2"> to: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span><span class="w"> </span><span class="n">download_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">urlretrieve</span><span class="p">(</span>
                            <span class="n">full_download_url</span><span class="p">,</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span> <span class="n">download_file</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_local_path</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!! Failed to download </span><span class="si">{</span><span class="n">full_download_url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> !!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to download.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;...Done.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.check_existing_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.check_existing_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_existing_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">local_subfolder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Checks the local directory for files that match a given pattern and fall within a specified date range.</span>
<span class="sd">            This function filters and returns the files that already exist locally, based on their extensions and matching patterns.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - data_type (`str`): The type of data (e.g., &#39;ck&#39;, &#39;spk&#39;).</span>
<span class="sd">            - local_subfolder (`str`): Path to the local directory where the files are stored.</span>
<span class="sd">            - start_date (`datetime`): The start date of the time interval for which files are required.</span>
<span class="sd">            - end_date (`datetime`): The end date of the time interval for which files are required.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `self.existing_files` (`list`): A list of paths to the files that already exist and match the given pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get all existing files that match the filename format</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_extension_for_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">existing_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">f</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_subfolder</span><span class="si">}</span><span class="s2">/*&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;\.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_check_existing_files</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_files</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.dynamic_download_url_files_time_interval">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.dynamic_download_url_files_time_interval">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dynamic_download_url_files_time_interval</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">local_path</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">url</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Downloads files within a specified time interval from a given URL, checking if the files already exist locally before downloading them.</span>
<span class="sd">            This function is typically used to download mission data files for a specific time range, ensuring that files are only downloaded if they are not already present.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - input_mission (`str`): The name of the mission (e.g., &#39;cassini&#39;, &#39;mro&#39;).</span>
<span class="sd">            - local_path (`str`): The directory path where files will be stored locally.</span>
<span class="sd">            - start_date (`datetime`): The start date of the time interval for which files are required.</span>
<span class="sd">            - end_date (`datetime`): The end date of the time interval for which files are required.</span>
<span class="sd">            - url (`str`): The base URL for downloading the files.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `self.relevant_files` (`list`): A list of local file paths for the files that were either found or successfully downloaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking URL:&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating Local Folder: </span><span class="si">{</span><span class="n">local_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span>

        <span class="n">local_subfolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating Local Subfolder: </span><span class="si">{</span><span class="n">local_subfolder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">)</span>

        <span class="c1"># Prepare the date range for searching existing files</span>
        <span class="n">all_dates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">supported_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span><span class="p">[</span><span class="n">input_mission</span><span class="p">][</span><span class="n">data_type</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern not found among supported patterns.&quot;</span><span class="p">)</span>

        <span class="n">existing_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_existing_files</span><span class="p">(</span>
            <span class="n">data_type</span><span class="p">,</span> <span class="n">local_subfolder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_files</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_check_existing_files</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;--------------------------------------- EXISTING FILES CHECK ---------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The following files already exist in the folder:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">existing_files</span><span class="si">}</span><span class="se">\n\n</span><span class="s2"> and will not be downloaded.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">existing_files</span><span class="p">)</span>

        <span class="c1"># Initialize a dictionary to hold files from the HTML response</span>
        <span class="n">files_url_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get the content of the URL</span>
        <span class="n">reqs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="c1"># Parse links from the HTML response</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">reqs</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
            <span class="n">full_link</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>  <span class="c1"># Extract the href attribute</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">full_link</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Check if the link is a full URL or a relative path</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">full_link</span><span class="p">:</span>
                    <span class="c1"># It&#39;s a full URL</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                        <span class="n">full_link</span>
                    <span class="p">)</span>  <span class="c1"># Get the filename from the URL</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># It&#39;s a relative path</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">full_link</span>
                    <span class="c1"># Check if the filename matches the specified format</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_type_extension</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Parse the information from the filename</span>
                        <span class="n">dictionary</span><span class="p">,</span> <span class="n">underscores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_filename</span><span class="p">(</span>
                            <span class="n">input_mission</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span>
                        <span class="p">)</span>
                        <span class="c1"># Reconstruct the filename and get time intervals</span>
                        <span class="n">filename_to_download</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_filename</span><span class="p">(</span>
                            <span class="n">dictionary</span><span class="p">,</span> <span class="n">underscores</span>
                        <span class="p">)</span>
                        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span>
                        <span class="n">end_time</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_utc&quot;</span><span class="p">]</span>

                        <span class="c1"># Downloading only the latest version of a file</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s2">&quot;version&quot;</span>
                        <span class="p">)</span>  <span class="c1"># Define default version if not provided</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                            <span class="n">files_url_dict</span><span class="p">[(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">filename_to_download</span>
                            <span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ext</span> <span class="o">=</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extension&quot;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Unwanted filename found: </span><span class="si">{</span><span class="n">filename_to_download</span><span class="si">}</span><span class="s2">. Skipping... [Do not worry! ;)]&quot;</span>
                                <span class="p">)</span>
                                <span class="k">continue</span>

                            <span class="c1"># Extract the base filename without the version</span>
                            <span class="n">base_name_no_version_no_ext</span> <span class="o">=</span> <span class="n">filename_to_download</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">current_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                <span class="n">version</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                            <span class="p">)</span>  <span class="c1"># Extract numeric version (e.g., v02 -&gt; 2)</span>
                            <span class="c1"># Only store the highest version</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span>
                                <span class="n">base_name_no_version_no_ext</span> <span class="ow">in</span> <span class="n">value</span>
                                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">files_url_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                            <span class="p">):</span>
                                <span class="n">files_url_dict</span><span class="p">[(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">filename_to_download</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">stored_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                                <span class="k">if</span> <span class="n">current_version</span> <span class="o">&gt;=</span> <span class="n">stored_version</span><span class="p">:</span>
                                    <span class="n">latest_filename_to_download</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_name_no_version_no_ext</span><span class="si">}{</span><span class="n">version</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                    <span class="n">files_url_dict</span><span class="p">[(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="n">latest_filename_to_download</span>
                                    <span class="p">)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>  <span class="c1"># Skip to the next link</span>

        <span class="c1"># Download files for all intervals from the HTML response</span>
        <span class="k">for</span> <span class="n">new_interval</span><span class="p">,</span> <span class="n">filename_to_download</span> <span class="ow">in</span> <span class="n">files_url_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">full_local_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_subfolder</span><span class="p">,</span> <span class="n">filename_to_download</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">existing_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">full_local_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_date_in_intervals</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="p">[</span><span class="n">new_interval</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates</span>
                    <span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Downloading: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">filename_to_download</span><span class="p">)</span><span class="si">}</span><span class="s2"> to: </span><span class="si">{</span><span class="n">full_local_path</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>  <span class="c1"># Print which file is being downloaded</span>
                        <span class="n">urlretrieve</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename_to_download</span><span class="p">),</span>
                            <span class="n">full_local_path</span><span class="p">,</span>
                        <span class="p">)</span>  <span class="c1"># Download the file</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_local_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_date_in_intervals</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="p">[</span><span class="n">new_interval</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates</span>
                <span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Downloading: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">filename_to_download</span><span class="p">)</span><span class="si">}</span><span class="s2"> to: </span><span class="si">{</span><span class="n">full_local_path</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>  <span class="c1"># Print which file is being downloaded</span>
                    <span class="n">urlretrieve</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename_to_download</span><span class="p">),</span> <span class="n">full_local_path</span>
                    <span class="p">)</span>  <span class="c1"># Download the file</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_local_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to download.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;...Done.&quot;</span><span class="p">)</span>  <span class="c1"># Indicate completion</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span></div>


<div class="viewcode-block" id="LoadPDS.download_url_files_time">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.download_url_files_time">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_url_files_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">local_path</span><span class="p">,</span>
        <span class="n">filename_format</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">,</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">time_format</span><span class="p">,</span>
        <span class="n">indices_date_filename</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            Downloads files within a specified time interval from a given URL. The function checks for existing files locally,</span>
<span class="sd">            identifies missing files for the given time interval, and downloads them if necessary.</span>
<span class="sd">            It handles cases where files are organized in nested folders at the target URL.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_path (`str`): The local directory path where files will be stored.</span>
<span class="sd">            - filename_format (`str`): The format of the filenames to be downloaded, with date placeholders and optional folder structure.</span>
<span class="sd">            - start_date (`datetime`): The start date of the time interval for which files are needed.</span>
<span class="sd">            - end_date (`datetime`): The end date of the time interval for which files are needed.</span>
<span class="sd">            - url (`str`): The base URL from which the files will be downloaded.</span>
<span class="sd">            - time_format (`str`): The format string used to represent dates in the filenames (e.g., &#39;%Y%m%d&#39;).</span>
<span class="sd">            - indices_date_filename (`list[int]`): A list of indices indicating where date strings are embedded within the filename format.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `self.relevant_files` (`list`): A list of local file paths for files that were either already present or successfully downloaded.</span>

<span class="sd">        Raises:</span>
<span class="sd">            - `Exception`: If the `filename_format` contains more than one folder.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Retrieve all dates contained within the time interval defined by the start and end dates provided as inputs</span>
        <span class="n">all_dates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Split the file name at the symbol &quot;/&quot;, to separate between the name of the file and the folder in which it might be contained</span>
        <span class="n">filename_split</span> <span class="o">=</span> <span class="n">filename_format</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename_split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;In the current implementation, the filename format cannot contain more than one folder.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename_split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">filename_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># In the reduced file name (after removing the folder part), replace the wildcards - indicated by &quot;\w&quot; - by &quot;*&quot;, which will later allow the</span>
        <span class="c1"># BeautifulSoup package to look for all pattern-matching names at the targeted url (without any a priori information on the date and/or</span>
        <span class="c1"># wildcard present in the file name)</span>
        <span class="n">reduced_filename</span> <span class="o">=</span> <span class="n">filename_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">reduced_filename</span> <span class="o">=</span> <span class="n">reduced_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;\w&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve all filenames present at the &quot;local_path&quot; location that match the specified filename format</span>

        <span class="n">existing_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">local_path</span> <span class="o">+</span> <span class="n">reduced_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The following files already exist in the folder:</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{</span><span class="n">existing_files</span><span class="si">}</span><span class="se">\n\n</span><span class="s2"> and will not be downloaded.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Identify dates of interest that are not covered by existing files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dates_without_file</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">all_dates</span><span class="p">:</span>
            <span class="c1"># Create string object corresponding to the date under investigation</span>
            <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>

            <span class="c1"># Reconstruct the expected filename for this particular date</span>
            <span class="n">current_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices_date_filename</span><span class="p">:</span>
                <span class="n">current_filename</span> <span class="o">+=</span> <span class="n">filename_format</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">date_str</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">current_filename</span> <span class="o">+=</span> <span class="n">filename_format</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>

            <span class="c1"># Parse existing files and check whether the current file name can be found</span>
            <span class="n">current_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">existing_files</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">local_path</span> <span class="o">+</span> <span class="n">current_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># If so, add the identified file to the list of relevant files to be loaded</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">current_files</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># If not, mark the current date as non-covered by any file yet (i.e., date for which a file is missing)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dates_without_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

        <span class="c1"># Retrieve the missing files from the specified url</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates_without_file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="c1"># List containing the names of the files to be downloaded</span>
            <span class="n">files_url</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Parse all files contained at the targeted url</span>
            <span class="n">reqs</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">reqs</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>

                <span class="c1"># Retrieve full url link for each of these files</span>
                <span class="n">full_link</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>

                <span class="c1"># Check whether the file of interest is nested within an additional folder</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_filename</span> <span class="o">=</span> <span class="n">full_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_filename</span> <span class="o">=</span> <span class="n">full_link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

                <span class="c1"># Store the name of the file to be downloaded</span>
                <span class="n">files_url</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_filename</span><span class="p">)</span>

        <span class="c1"># Parse all dates for which a file was originally missing and download missing files from the specified url.</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates_without_file</span><span class="p">:</span>

            <span class="c1"># List of the files to be downloaded</span>
            <span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Reconstruct expected filename for the date under consideration</span>
            <span class="n">date_str</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
            <span class="n">current_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices_date_filename</span><span class="p">:</span>
                <span class="n">current_filename</span> <span class="o">+=</span> <span class="n">filename_format</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">date_str</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">current_filename</span> <span class="o">+=</span> <span class="n">filename_format</span><span class="p">[</span><span class="n">index</span><span class="p">:]</span>

            <span class="c1"># Check whether a matching file was found at the targeted url for this specific date, and split the filename at &quot;/&quot;</span>
            <span class="c1"># to account for the possibility that the targeted file is stored in a nested folder</span>
            <span class="n">file_to_download</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files_url</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">current_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="c1"># If the file is directly stored at the specified url (no nested folder), then the filename can be stored directly</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">files_to_download</span> <span class="o">=</span> <span class="n">file_to_download</span>

            <span class="c1"># Otherwise, explore additional folder layer</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_to_download</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">reqs2</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">file_to_download</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Parse all files within the current folder</span>
                <span class="k">for</span> <span class="n">nested_link</span> <span class="ow">in</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">reqs2</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
                    <span class="s2">&quot;a&quot;</span>
                <span class="p">):</span>
                    <span class="n">nested_file</span> <span class="o">=</span> <span class="n">nested_link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>

                    <span class="c1"># Retrieve all matching file names within the current folder</span>
                    <span class="n">relevant_link</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">x</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nested_file</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">current_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">]</span>

                    <span class="c1"># If a match is found, store the filename that should be downloaded (now including the extra folder layer)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_link</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">files_to_download</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">file_to_download</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">relevant_link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>

            <span class="c1"># Download all relevant files from the targeted url</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_download</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading &quot;</span><span class="p">,</span> <span class="n">url</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">local_path</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_path</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Return the list of all relevant files that should be loaded to cover the time interval of interest</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_files</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.parse_filename">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.parse_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        This function parses a filename into its components based on the mission and data type patterns.</span>
<span class="sd">        It uses regular expressions to match the filename against predefined patterns for different mission types.</span>
<span class="sd">        It then returns the parsed components as a dictionary, along with the indices of underscores within the matched groups.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - input_mission (`str`): The mission name (e.g., &#39;cassini&#39;, &#39;mro&#39;, etc.).</span>
<span class="sd">            - data_type (`str`): The type of data (e.g., &quot;radioscience&quot;, &quot;kernels&quot;, &quot;all&quot;).</span>
<span class="sd">            - filename (`str`): The filename to be parsed.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - (`dict`, `list`): A tuple containing:</span>
<span class="sd">              - `dictionary` (`dict`): A dictionary where the keys are the component names</span>
<span class="sd">              (e.g., &#39;date&#39;, &#39;purpose&#39;, etc.), and the values are the parsed values from the filename.</span>
<span class="sd">              - `underscore_indices` (`list`): A list of indices representing</span>
<span class="sd">              the positions of underscores in the matched groups.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">data_type_lower</span> <span class="o">=</span> <span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">all_supported_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">input_mission</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span><span class="p">:</span>
            <span class="n">level_one_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_patterns</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Selected Mission Not Supported (yet!) Aborting ...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_type_lower</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">data_type_types</span> <span class="o">=</span> <span class="n">all_supported_types</span>

        <span class="k">elif</span> <span class="n">data_type_lower</span> <span class="ow">in</span> <span class="n">all_supported_types</span><span class="p">:</span>
            <span class="n">data_type_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_type_lower</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Specified data type: </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize the dictionary and underscore index list</span>
        <span class="n">underscore_indices</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">level_one_object</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># deals with multiple keys</span>
            <span class="k">for</span> <span class="n">data_type_type</span> <span class="ow">in</span> <span class="n">level_one_object</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">data_type_type</span> <span class="ow">in</span> <span class="n">data_type_types</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_type_extension</span><span class="p">(</span><span class="n">data_type_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="n">level_one_object</span><span class="p">[</span><span class="n">data_type_type</span><span class="p">]</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                            <span class="c1"># Populate the dictionary with matched groups</span>
                            <span class="n">dictionary</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>

                            <span class="c1"># Add underscore index tracking based on group positions</span>
                            <span class="n">last_pos</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">group_index</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">current_pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
                                    <span class="n">key</span>
                                <span class="p">)</span>  <span class="c1"># Get the start position of the matched group</span>
                                <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">last_pos</span> <span class="o">!=</span> <span class="n">current_pos</span> <span class="ow">and</span> <span class="n">last_pos</span> <span class="o">!=</span> <span class="mi">0</span>
                                    <span class="p">):</span>  <span class="c1"># Check if there&#39;s a gap since last valid group</span>
                                        <span class="n">underscore_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                            <span class="n">group_index</span>
                                        <span class="p">)</span>  <span class="c1"># Track the index of the underscore</span>
                                    <span class="n">last_pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span>
                                        <span class="n">key</span>
                                    <span class="p">)</span>  <span class="c1"># Move to the end of the current matched group</span>
                                <span class="n">group_index</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Increment the group index</span>

                            <span class="c1"># If present, convert start and end dates in utc (both will only be present in spice file names).</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="s2">&quot;start_date_file&quot;</span> <span class="ow">in</span> <span class="n">dictionary</span>
                                <span class="ow">and</span> <span class="s2">&quot;end_date_file&quot;</span> <span class="ow">in</span> <span class="n">dictionary</span>
                            <span class="p">):</span>
                                <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

                                    <span class="k">if</span> <span class="p">(</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span>
                                    <span class="p">):</span>  <span class="c1"># this deals with MEX ORMF files</span>

                                        <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">LoadPDS</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                                                <span class="n">LoadPDS</span><span class="p">,</span>
                                                <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span>
                                            <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span>
                                        <span class="p">)</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span>

                                    <span class="k">elif</span> <span class="p">(</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span>
                                        <span class="ow">and</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;purpose&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SA&quot;</span>
                                    <span class="p">):</span>
                                        <span class="n">mex_sa_date_trick</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;0101_&quot;</span>
                                        <span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">LoadPDS</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                                                <span class="n">LoadPDS</span><span class="p">,</span> <span class="n">mex_sa_date_trick</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span>
                                        <span class="p">)</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span>

                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">LoadPDS</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                                                <span class="n">LoadPDS</span><span class="p">,</span>
                                                <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_file&quot;</span><span class="p">],</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">LoadPDS</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                                                <span class="n">LoadPDS</span><span class="p">,</span>
                                                <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_file&quot;</span><span class="p">],</span>
                                            <span class="p">)</span>
                                            <span class="k">if</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_file&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;000000&quot;</span>
                                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span>
                                            <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                        <span class="p">)</span>  <span class="c1"># this deals with MEX ORMM files</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">start_date_utc</span>
                                        <span class="p">)</span>
                                        <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;end_date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date_utc</span>

                            <span class="c1"># If present, convert date_file in utc (only one date is present in the Radio Science file names)</span>
                            <span class="k">elif</span> <span class="s2">&quot;date_file&quot;</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">date_utc</span> <span class="o">=</span> <span class="n">LoadPDS</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                                    <span class="n">LoadPDS</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;date_file&quot;</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;date_utc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_utc</span>

                            <span class="k">return</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">underscore_indices</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># print(f&#39;Filename: {filename} does not match any supported patterns.&#39;)</span>
                            <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.reconstruct_filename">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.reconstruct_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">underscore_indices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">            This function reconstructs the original filename by combining the parsed components (from the `dictionary`) and placing underscores at the specified indices (from the `underscore_indices`). It takes into account the specific format of the filename, ensuring the proper placement of underscores.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - dictionary (`dict`): A dictionary containing the parsed components of the filename, where the keys are the component names and the values are the corresponding values extracted from the filename.</span>
<span class="sd">            - underscore_indices (`list`): A list of indices where underscores should be placed in the reconstructed filename. These indices correspond to the position of the groups in the parsed dictionary.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - (`str`): The reconstructed filename as a string, with underscores placed at the specified positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Extract the keys (group names) from the dictionary in order</span>
        <span class="n">group_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Initialize an empty list to build the filename</span>
        <span class="n">reconstructed_filename</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Iterate through the group values and append to the list</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group_values</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">reconstructed_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># Add the current group</span>

            <span class="c1"># Check if the current index is in the underscore_indices list</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">underscore_indices</span>
            <span class="p">):</span>  <span class="c1"># Underscore comes *after* the current group (between i and i+1)</span>
                <span class="n">reconstructed_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="c1"># Join the list into a single string (the reconstructed filename)</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">reconstructed_filename</span><span class="p">)</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.extract_kernels_from_meta_kernel">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.extract_kernels_from_meta_kernel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_kernels_from_meta_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches a meta-kernel file from an HTTPS URL and categorizes kernel files by type</span>
<span class="sd">        using the type-to-extension mapping.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            input_mission (str): e.g. &#39;mex&#39;, &#39;mro&#39;, &#39;juice&#39;, &#39;ro&#39;, etc...</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary categorizing kernel files by type based on `type_to_extension`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_names</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="n">meta_kernel_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_meta_kernel</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fetch the meta-kernel file content</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">meta_kernel_url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an error for bad status codes</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="c1"># Ignore comment lines and empty lines</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Extract the kernel path between quotes</span>
                <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">quote_char</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">quote_char</span><span class="p">)</span>
                    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">quote_char</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">start_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">end_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">relative_kernel_path</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end_idx</span><span class="p">]</span>
                        <span class="n">full_kernel_path</span> <span class="o">=</span> <span class="n">relative_kernel_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                            <span class="s2">&quot;$KERNELS/&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_kernels_url</span><span class="p">[</span><span class="n">input_mission</span><span class="p">],</span>
                        <span class="p">)</span>

                        <span class="c1"># Extract the file extension</span>
                        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">full_kernel_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                        <span class="c1"># Match extension to kernel type</span>
                        <span class="n">matched_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">key</span>
                                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">exts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">(</span><span class="n">exts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">exts</span><span class="p">])</span>
                            <span class="p">),</span>
                            <span class="kc">None</span><span class="p">,</span>  <span class="c1"># No fallback, unmatched extensions will be ignored</span>
                        <span class="p">)</span>

                        <span class="c1"># Add to results if matched</span>
                        <span class="k">if</span> <span class="n">matched_key</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_names</span><span class="p">[</span><span class="n">matched_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_kernel_path</span><span class="p">)</span>

            <span class="c1"># Add the meta-kernel URL to the dictionary</span>
            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">meta_kernel_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Match extension to kernel type</span>
            <span class="n">matched_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">key</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">exts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_to_extension</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">(</span><span class="n">exts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">exts</span><span class="p">])</span>
                <span class="p">),</span>
                <span class="kc">None</span><span class="p">,</span>  <span class="c1"># No fallback, unmatched extensions will be ignored</span>
            <span class="p">)</span>
            <span class="c1"># Add to results if matched</span>
            <span class="k">if</span> <span class="n">matched_key</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_names</span><span class="p">[</span><span class="n">matched_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_kernel_url</span><span class="p">)</span>



            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_names</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while fetching the meta-kernel: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred in meta kernel extraction: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span></div>


    <span class="c1">#########################################################################################################</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">download_kernels_from_meta_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">):</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_kernels_from_meta_kernel</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_urls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">kernel_url</span> <span class="ow">in</span> <span class="n">kernel_urls</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s1">&#39;mk&#39;</span><span class="p">:</span> <span class="c1"># some meta-kernel paths are different from kernel paths</span>
                    <span class="n">url_kernel_path</span> <span class="o">=</span> <span class="n">kernel_url</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_kernels_url</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]):]</span>
                    <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">url_kernel_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">url_kernel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_url</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_url</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]):])</span>
                    <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">url_kernel_path</span><span class="p">)</span>

                <span class="n">local_kernel_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">local_kernel_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Meta-kernels should always be re-downloaded to assure the latest version</span>
                <span class="k">if</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s2">&quot;mk&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;Re-downloading&quot;</span> <span class="k">if</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s2">&quot;mk&quot;</span> <span class="k">else</span> <span class="s2">&quot;Downloading&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">: &#39;</span><span class="si">{</span><span class="n">kernel_url</span><span class="si">}</span><span class="s2">&#39; to: </span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">urlretrieve</span><span class="p">(</span><span class="n">kernel_url</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">url_kernel_path</span><span class="si">}</span><span class="s2"> already exists in: </span><span class="si">{</span><span class="n">local_folder</span><span class="si">}</span><span class="s2"> and will not be downloaded.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span>

    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_latest_meta_kernel">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_latest_meta_kernel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest_meta_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the most recent meta-kernel file URL based on year and version.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            base_url (str): The base URL containing meta-kernel file links.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The URL of the most recent meta-kernel file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_url</span><span class="p">[</span><span class="n">input_mission</span><span class="p">]</span>
        <span class="n">meta_kernel_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_mission_meta_kernel_pattern</span><span class="p">[</span>
            <span class="n">input_mission</span>
        <span class="p">]</span>  <span class="c1"># the pattern for mex, ro, and juice is an exact name</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fetch the HTML page</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an error for bad status codes</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>

            <span class="c1"># Extract all matching filenames and their year/version</span>
            <span class="n">meta_kernels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">meta_kernel_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="c1"># Find the most recent meta-kernel based on year and version</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
                        <span class="n">meta_kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">base_url</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">])</span>
                        <span class="p">)</span>  <span class="c1"># iterating through the past list of meta kernels</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">latest_kernel</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">base_url</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;href&quot;</span><span class="p">]</span>
                        <span class="p">)</span>  <span class="c1"># there is just one exact name for juice and mex (no-brainer)</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_kernel</span>

            <span class="k">if</span> <span class="n">meta_kernels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">latest_kernel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">meta_kernels</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_kernel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Return the URL of the most recent file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No meta-kernels found matching the pattern.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while fetching the meta-kernel list: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred in getting latest meta-kernel: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1">#########################################################################################################</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest_clock_kernel_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_mission</span><span class="p">):</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">kernels_from_meta_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_kernels_from_meta_kernel</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>

        <span class="n">clock_files_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_files</span> <span class="ow">in</span> <span class="n">kernels_from_meta_kernel</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">kernel_file</span> <span class="ow">in</span> <span class="n">kernel_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_type</span> <span class="o">==</span> <span class="s2">&quot;sclk&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kernel_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Clock Kernel Ambiguity Found: </span><span class="si">{</span><span class="n">kernel_files</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">clock_file</span> <span class="ow">in</span> <span class="n">kernel_files</span><span class="p">:</span>
                            <span class="n">clock_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clock_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">clock_file</span> <span class="o">=</span> <span class="n">kernel_file</span>
                        <span class="n">clock_files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clock_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">clock_files_list</span>

    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mission_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mission_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mission_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_mission</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">flyby_IDs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">custom_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">all_meta_kernel_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">load_kernels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">radio_observation_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">radio_science_file_type</span><span class="o">=</span><span class="s2">&quot;odf&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        This function downloads and organizes mission-specific data files (kernels, radio science files, and ancillary files)</span>
<span class="sd">        for a specified space mission. It supports downloading data for multiple missions such as Cassini, MEX, JUICE, MRO and ROSETTA.</span>
<span class="sd">        The function also allows for downloading files within a specific date range or for specific flybys (in the case of Cassini).</span>
<span class="sd">        It automatically creates the necessary folder structure for storing the downloaded data and loads the files into the SPICE kernel system.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - input_mission (`str`): The name of the space mission for which to download the data. Valid values include:</span>
<span class="sd">                - &#39;cassini&#39;</span>
<span class="sd">                - &#39;mex&#39;</span>
<span class="sd">                - &#39;juice&#39;</span>
<span class="sd">                - &#39;mro&#39;</span>
<span class="sd">                - &#39;ro&#39;</span>
<span class="sd">            - start_date (`datetime`, optional): The start date for downloading data. If not provided, data is not filtered by date.</span>
<span class="sd">            - end_date (`datetime`, optional): The end date for downloading data (data from the end_date will be downloaded as well, meaning data from start_date &lt;= date &lt;= end_date).</span>
<span class="sd">                                                If not provided, data is not filtered by date.</span>
<span class="sd">            - flyby_IDs (`list` or `str`, optional): A list of flyby IDs (e.g., [&#39;T101&#39;, &#39;E303&#39;]) for Cassini missions.</span>
<span class="sd">                It can also include special values like &#39;ALL_TITAN&#39; or &#39;ALL_ENCELADUS&#39; to download all flybys for Titan or Enceladus.</span>
<span class="sd">            - custom_output (`str`, optional): A custom path where the downloaded files will be stored. If not provided,</span>
<span class="sd">                the default folder structure is used based on the mission name.</span>
<span class="sd">            - radio_observation_type: (&#39;str&#39;, optional): type of (mex) radio_observation_type (e.g. phobos gravity, commissioning, occultation, etc ...)</span>
<span class="sd">            - radio_science_file_type (&#39;str&#39;, optional): tnf or odf</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - (`dict`, `dict`, `dict`): A tuple containing:</span>
<span class="sd">                - `all_kernel_files` (`dict`): A dictionary where keys are kernel types (e.g., &#39;ck&#39;, &#39;spk&#39;) and values are</span>
<span class="sd">                  lists of paths to the successfully loaded kernel files.</span>
<span class="sd">                - `all_radio_science_files` (`dict`): A dictionary where keys are radio science data types and values are</span>
<span class="sd">                  lists of paths to the successfully loaded radio science files.</span>
<span class="sd">                - `all_ancillary_files` (`dict`): A dictionary where keys are ancillary data types and values are</span>
<span class="sd">                  lists of paths to the successfully loaded ancillary files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_mission</span> <span class="o">=</span> <span class="n">input_mission</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_radio_science_files</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_ancillary_files</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">start_date</span> <span class="ow">and</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="n">all_dates</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;======================================= Downloading </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Data ==============================================</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_output</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-a&quot;</span> <span class="ow">or</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-b&quot;</span>
            <span class="p">):</span>  <span class="c1"># both grail-a and -b found in grail archive</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">custom_output</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-a&quot;</span> <span class="ow">or</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-b&quot;</span>
            <span class="p">):</span>  <span class="c1"># both grail-a and -b found in grail archive</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;grail_archive/</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base_folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2">_archive/&quot;</span>

        <span class="n">local_folder_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[]</span>
        <span class="p">)</span>  <span class="c1"># this will be a multiple-element list (length != 1)ONLY if &quot;Cassini&quot; and ONLY if len(flyby_IDs) &gt; 1</span>
        <span class="k">if</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;cassini&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_titan_flyby_table</span><span class="p">()</span>
                <span class="n">flyby_IDs</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;You are about to download data for the Cassini Spacecraft. What flyby would you like to download? (Check Provided Table for Reference.)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Split the input string by commas and remove any leading/trailing spaces from each item</span>
                <span class="n">flyby_IDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">flyby</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">flyby</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                <span class="c1"># Output the list of flyby IDs</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You selected the following flyby_IDs: </span><span class="si">{</span><span class="n">flyby_IDs</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flyby_IDs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># Create a flag to track if Titan or Enceladus has been processed</span>
                <span class="n">processed_moons</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Process Titan flybys if &#39;ALL_TITAN&#39; is in the list</span>
                <span class="k">if</span> <span class="s2">&quot;ALL_TITAN&quot;</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;removing&quot;</span><span class="p">)</span>
                    <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;ALL_TITAN&quot;</span><span class="p">)</span>  <span class="c1"># Remove &#39;ALL_TITAN&#39;</span>
                    <span class="n">full_moon_flybys_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_full_moon_flybys_list</span><span class="p">(</span>
                        <span class="s2">&quot;TITAN&quot;</span>
                    <span class="p">)</span>
                    <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">full_moon_flybys_list</span><span class="p">)</span>
                    <span class="c1"># Remove duplicates</span>
                    <span class="n">flyby_IDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">flyby_IDs</span><span class="p">))</span>
                    <span class="c1"># Add Titan folder creation to the list</span>
                    <span class="n">processed_moons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TITAN&quot;</span><span class="p">)</span>

                <span class="c1"># Process Enceladus flybys if &#39;ALL_ENCELADUS&#39; is in the list</span>
                <span class="k">if</span> <span class="s2">&quot;ALL_ENCELADUS&quot;</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                    <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;ALL_ENCELADUS&quot;</span><span class="p">)</span>  <span class="c1"># Remove &#39;ALL_ENCELADUS&#39;</span>
                    <span class="n">full_moon_flybys_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_full_moon_flybys_list</span><span class="p">(</span>
                        <span class="s2">&quot;ENCELADUS&quot;</span>
                    <span class="p">)</span>
                    <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">full_moon_flybys_list</span><span class="p">)</span>
                    <span class="c1"># Remove duplicates</span>
                    <span class="n">flyby_IDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">flyby_IDs</span><span class="p">))</span>
                    <span class="c1"># Add Enceladus folder creation to the list</span>
                    <span class="n">processed_moons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ENCELADUS&quot;</span><span class="p">)</span>

                <span class="c1"># At this point, `flyby_IDs` contains the full list of flyby IDs without &#39;ALL_TITAN&#39; or &#39;ALL_ENCELADUS&#39;</span>
                <span class="c1"># Now create the local folders</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_moons</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">moon</span> <span class="ow">in</span> <span class="n">processed_moons</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">flyby_ID</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                            <span class="n">local_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">flyby_ID</span><span class="p">)</span>
                            <span class="n">local_folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">local_folder</span>
                            <span class="p">)</span>  <span class="c1"># Append to local_folder_list</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">flyby_ID</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">flyby_ID</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
                            <span class="n">moon</span> <span class="o">=</span> <span class="s2">&quot;TITAN&quot;</span>
                        <span class="k">elif</span> <span class="n">flyby_ID</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">):</span>
                            <span class="n">moon</span> <span class="o">=</span> <span class="s2">&quot;ENCELADUS&quot;</span>
                        <span class="n">local_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">flyby_ID</span><span class="p">)</span>
                        <span class="n">local_folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">local_folder</span>
                        <span class="p">)</span>  <span class="c1"># Append to local_folder_list</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">moon</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TITAN&quot;</span><span class="p">,</span> <span class="s2">&quot;ENCELADUS&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;ALL_</span><span class="si">{</span><span class="n">moon</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                        <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ALL_</span><span class="si">{</span><span class="n">moon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">full_moon_flybys_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_full_moon_flybys_list</span><span class="p">(</span>
                            <span class="n">moon</span>
                        <span class="p">)</span>
                        <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">full_moon_flybys_list</span><span class="p">)</span>
                        <span class="n">flyby_IDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flyby_IDs</span><span class="p">))</span>  <span class="c1"># This removes duplicates</span>

                        <span class="k">for</span> <span class="n">flyby_ID</span> <span class="ow">in</span> <span class="n">flyby_IDs</span><span class="p">:</span>
                            <span class="n">local_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">flyby_ID</span><span class="p">)</span>
                            <span class="n">local_folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">local_folder</span>
                            <span class="p">)</span>  <span class="c1"># append to local_folder_list</span>

                <span class="k">if</span> <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
                    <span class="n">moon</span> <span class="o">=</span> <span class="s2">&quot;TITAN&quot;</span>
                <span class="k">elif</span> <span class="n">flyby_IDs</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">):</span>
                    <span class="n">moon</span> <span class="o">=</span> <span class="s2">&quot;ENCELADUS&quot;</span>

                <span class="n">local_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_folder</span><span class="p">,</span> <span class="n">moon</span><span class="p">,</span> <span class="n">flyby_IDs</span><span class="p">)</span>
                <span class="n">local_folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">local_folder</span>
                <span class="p">)</span>  <span class="c1"># in this case, it is just a single folder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_folder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">base_folder</span>
            <span class="p">)</span>  <span class="c1"># in this case, it is just a single folder</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;=========================================== Folder(s) Creation ==================================================&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_folder</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Creating Local Folder: </span><span class="si">{</span><span class="n">base_folder</span><span class="si">}</span><span class="s2"> and its subfolders (kernels and radio)...&quot;</span>
            <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_folder</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">local_folder</span> <span class="ow">in</span> <span class="n">local_folder_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Folder: </span><span class="si">{</span><span class="n">local_folder</span><span class="si">}</span><span class="s2"> already exists and will not be overwritten.&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Folder: </span><span class="si">{</span><span class="n">base_folder</span><span class="si">}</span><span class="s2"> already exists and will not be overwritten.&quot;</span>
            <span class="p">)</span>


        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===============================================================================================================</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">local_folder</span> <span class="ow">in</span> <span class="n">local_folder_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_check_existing_files</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">all_meta_kernel_files</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Downloading all Kernels from </span><span class="si">{</span><span class="n">input_mission</span><span class="si">}</span><span class="s2"> Latest Meta-Kernel File...&quot;</span>
                <span class="p">)</span>
                <span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_kernels_from_meta_kernel</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span> <span class="n">local_folder</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;ro&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_ro_files</span><span class="p">(</span>
                            <span class="n">local_folder</span><span class="p">,</span>
                            <span class="n">start_date</span><span class="p">,</span>
                            <span class="n">end_date</span><span class="p">,</span>
                            <span class="n">radio_observation_type</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ro_files</span><span class="p">(</span>
                        <span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="p">,</span>
                        <span class="n">radio_observation_type</span><span class="p">,</span>
                    <span class="p">)</span>


            <span class="k">if</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;mex&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_mex_files</span><span class="p">(</span>
                            <span class="n">local_folder</span><span class="p">,</span>
                            <span class="n">start_date</span><span class="p">,</span>
                            <span class="n">end_date</span><span class="p">,</span>
                            <span class="n">radio_observation_type</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mex_files</span><span class="p">(</span>
                        <span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="p">,</span>
                        <span class="n">radio_observation_type</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">elif</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;juice&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_juice_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_juice_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;mro&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_mro_files</span><span class="p">(</span>
                            <span class="n">local_folder</span><span class="p">,</span>
                            <span class="n">start_date</span><span class="p">,</span>
                            <span class="n">end_date</span><span class="p">,</span>
                            <span class="n">radio_science_file_type</span><span class="o">=</span><span class="n">radio_science_file_type</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mro_files</span><span class="p">(</span>
                        <span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="p">,</span>
                        <span class="n">radio_science_file_type</span><span class="o">=</span><span class="n">radio_science_file_type</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;cassini&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_flyby_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_flyby_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-a&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_grail_a_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grail_a_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">input_mission</span> <span class="o">==</span> <span class="s2">&quot;grail-b&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">radio_science_files_to_load</span><span class="p">,</span> <span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_grail_b_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="n">kernel_files_to_load</span><span class="p">,</span>
                        <span class="n">radio_science_files_to_load</span><span class="p">,</span>
                        <span class="n">ancillary_files_to_load</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grail_b_files</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kernel_files_to_load</span><span class="p">:</span>
            <span class="n">meta_kernel_present</span> <span class="o">=</span> <span class="s2">&quot;mk&quot;</span> <span class="ow">in</span> <span class="n">kernel_files_to_load</span>

            <span class="c1"># Always populate self.all_kernel_files with all converted kernels</span>
            <span class="k">for</span> <span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_files</span> <span class="ow">in</span> <span class="n">kernel_files_to_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span><span class="p">[</span><span class="n">kernel_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">kernel_file</span> <span class="ow">in</span> <span class="n">kernel_files</span><span class="p">:</span>
                    <span class="n">converted_kernel_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spice_transfer2binary</span><span class="p">(</span><span class="n">kernel_file</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span><span class="p">[</span><span class="n">kernel_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted_kernel_file</span><span class="p">)</span>

            <span class="c1"># If meta-kernel is present and load_kernels is True: load only meta-kernel</span>
            <span class="k">if</span> <span class="n">meta_kernel_present</span> <span class="ow">and</span> <span class="n">load_kernels</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">meta_kernel_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span><span class="p">[</span><span class="s2">&quot;mk&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">spice</span><span class="o">.</span><span class="n">load_kernel</span><span class="p">(</span><span class="n">meta_kernel_file</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to load meta-kernel file: </span><span class="si">{</span><span class="n">meta_kernel_file</span><span class="si">}</span><span class="s2">, Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># If meta-kernel is not present: load individual kernels if requested</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">meta_kernel_present</span> <span class="ow">and</span> <span class="n">load_kernels</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_files</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">converted_kernel_file</span> <span class="ow">in</span> <span class="n">kernel_files</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">spice</span><span class="o">.</span><span class="n">load_kernel</span><span class="p">(</span><span class="n">converted_kernel_file</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;!! Failed to load kernel: </span><span class="si">{</span><span class="n">converted_kernel_file</span><span class="si">}</span><span class="s2">, Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> !!&quot;</span>
                            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Kernel Files to Load.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ancillary_files_to_load</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">ancillary_type</span><span class="p">,</span>
                <span class="n">ancillary_files</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">ancillary_files_to_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">ancillary_file</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">ancillary_files</span><span class="p">:</span>  <span class="c1"># Iterate over each file in the list</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ancillary_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_ancillary_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">all_ancillary_files</span><span class="p">[</span><span class="n">ancillary_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ancillary_file</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">load_kernels</span><span class="p">:</span>
                                <span class="n">spice</span><span class="o">.</span><span class="n">load_kernel</span><span class="p">(</span><span class="n">ancillary_file</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">all_ancillary_files</span><span class="p">[</span><span class="n">ancillary_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">ancillary_file</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">load_kernels</span><span class="p">:</span>
                                <span class="n">spice</span><span class="o">.</span><span class="n">load_kernel</span><span class="p">(</span><span class="n">ancillary_file</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!! Failed to load kernel: </span><span class="si">{</span><span class="n">ancillary_file</span><span class="si">}</span><span class="s2">, Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> !!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Ancillary Files to Load.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">radio_science_files_to_load</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">radio_science_type</span><span class="p">,</span>
                <span class="n">radio_science_files</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">radio_science_files_to_load</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">radio_science_file</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">radio_science_files</span><span class="p">:</span>  <span class="c1"># Iterate over each file in the list</span>
                    <span class="k">if</span> <span class="n">radio_science_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_radio_science_files</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">all_radio_science_files</span><span class="p">[</span><span class="n">radio_science_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">radio_science_file</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">all_radio_science_files</span><span class="p">[</span><span class="n">radio_science_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">radio_science_file</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Radio Science Files to Load.&quot;</span><span class="p">)</span>

        <span class="n">n_kernels</span> <span class="o">=</span> <span class="n">spice</span><span class="o">.</span><span class="n">get_total_count_of_kernels_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_load_standard_kernels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">load_kernels</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;===============================================================================================================&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Loaded Existing + Downloaded Kernels: </span><span class="si">{</span><span class="n">n_kernels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">std_kernels</span> <span class="o">=</span> <span class="n">spice</span><span class="o">.</span><span class="n">load_standard_kernels</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_load_standard_kernels</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">n_standard_kernels</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">spice</span><span class="o">.</span><span class="n">get_total_count_of_kernels_loaded</span><span class="p">()</span> <span class="o">-</span> <span class="n">n_kernels</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Loaded Standard Kernels: </span><span class="si">{</span><span class="n">n_standard_kernels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;===============================================================================================================&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of Loaded Existing + Downloaded + Standard Kernels: </span><span class="si">{</span><span class="n">n_kernels</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;===============================================================================================================&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clean_mission_archive</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_kernel_files</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_radio_science_files</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_ancillary_files</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">############################################# START OF MEX SECTION #####################################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mex_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mex_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mex_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        This function downloads and organizes various types of SPICE kernels and</span>
<span class="sd">        radio science files for the MEX (Mars Express) mission.</span>
<span class="sd">        It supports downloading kernel files related to radio science, clock data, frame data,</span>
<span class="sd">        SPK (spacecraft position) data, CK (orientation) data, and tropospheric/ionospheric correction files.</span>
<span class="sd">        The function interacts with remote FTP servers to retrieve the data and organizes them into the specified local folder.</span>
<span class="sd">        The data is filtered by a given date range, and the function returns the downloaded files for further use.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): The local directory where the downloaded files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for downloading data.</span>
<span class="sd">              This will filter the data to include only those within the date range.</span>
<span class="sd">            - end_date (`datetime`): The end date for downloading data.</span>
<span class="sd">              This will filter the data to include only those within the date range.</span>
<span class="sd">            - radio_observation_type (`str`): The type of radio science files to download (e.g. phobos gravity, commissioniong, etc...)</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - (`dict`, `dict`, `dict`): A tuple containing:</span>

<span class="sd">                - `kernel_files_to_load` (`dict`): A dictionary where the keys are kernel types (e.g., &#39;ck&#39;, &#39;spk&#39;, &#39;fk&#39;, &#39;sclk&#39;) and values are lists of paths to the successfully downloaded and loaded kernel files.</span>
<span class="sd">                - `radio_science_files_to_load` (`dict`): A dictionary where keys are categories of radio science data (e.g., &#39;ifms_dp2&#39;, &#39;dsn_dps&#39;) and values are lists of paths to the successfully downloaded radio science files.</span>
<span class="sd">                - `ancillary_files_to_load` (`dict`): A dictionary where keys are categories of ancillary data (e.g., &#39;ion&#39;, &#39;tropospheric&#39;) and values are lists of paths to the successfully downloaded ancillary files, such as tropospheric and ionospheric corrections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty for now</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;mex&quot;</span>
        <span class="c1"># Tropospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Tropospheric and Ionospheric Corrections Files&quot;</span>
        <span class="p">)</span>
        <span class="n">url_tropo_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_mex_radio_science_files</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">url_tropo_file_new</span> <span class="ow">in</span> <span class="n">url_tropo_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">folder_type</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;calib/closed_loop/ifms/met/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;calib/closed_loop/dsn/ion/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;calib/closed_loop/dsn/tro/&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">url_flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">url_tropo_file</span> <span class="o">=</span> <span class="n">url_tropo_file_new</span> <span class="o">+</span> <span class="n">folder_type</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_tropo_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">url_flag</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="c1"># Parse the HTML with BeautifulSoup</span>
                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
                    <span class="c1"># Extract file links and their names</span>
                    <span class="n">wanted_tropo_files</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
                        <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tab&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.aux&quot;</span><span class="p">):</span>
                            <span class="n">wanted_tropo_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">href</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">tropo_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_tropo_file</span><span class="p">,</span>
                        <span class="n">wanted_files_patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*l3l1b*.tab&quot;</span><span class="p">],</span>
                        <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">tropo_files_to_load</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">folder_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tropo_files_to_load</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tropospheric or ionospheric files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Radio Science Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_radio_science_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_mex_radio_science_files</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">url_radio_science_file_new</span> <span class="ow">in</span> <span class="n">url_radio_science_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">closed_loop_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ifms/dp2/&quot;</span><span class="p">,</span> <span class="s2">&quot;dsn/dps/&quot;</span><span class="p">,</span> <span class="s2">&quot;dsn/dpx/&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_radio_science_file</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">url_radio_science_file_new</span>
                        <span class="o">+</span> <span class="s2">&quot;data/level02/closed_loop/&quot;</span>
                        <span class="o">+</span> <span class="n">closed_loop_type</span>
                    <span class="p">)</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_single_time</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_radio_science_file</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closed_loop_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">closed_loop_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="c1"># Clock files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/sclk/&quot;</span>
        <span class="p">)</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_clock_kernel_name</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>
        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/fk/&quot;</span>
        <span class="p">)</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;MEX_V16.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MEX_SCI_V01.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MEX_RELAY_LOCATIONS_V03.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MEX_DSK_SURFACES_V04.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MEX_PFS_ROIS_V02.TF&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Spk files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_spk_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/spk/&quot;</span>
        <span class="p">]</span>

        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_spk_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_spk_file</span> <span class="ow">in</span> <span class="n">url_spk_files</span><span class="p">:</span>
                <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_spk_file</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">spk_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;spk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Orientation files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> CK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/MARS-EXPRESS/kernels/ck/&quot;</span>
        <span class="p">]</span>

        <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_ck_file</span> <span class="ow">in</span> <span class="n">url_ck_files</span><span class="p">:</span>
                <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_ck_file</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">ck_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;-----------------------------------------------------------------------------------------------------------&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;All requested, relevant and previously non-existing MEX files have been now downloaded. Enjoy!&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">#########################################################################################################</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mex_volume_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">interval_dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key_start</span><span class="p">,</span> <span class="n">key_end</span><span class="p">),</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">interval_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="c1"># Check if either start or end of the input interval overlaps with the dictionary interval</span>
                <span class="k">if</span> <span class="n">key_end</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">key_end</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="o">&gt;=</span> <span class="n">key_start</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">volume_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;volume_id&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">end_date</span> <span class="o">&gt;=</span> <span class="n">key_start</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">volume_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;volume_id&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_id_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume_id_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No MEX Volume_ID found associated to input interval: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="c1">#########################################################################################################</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_url_mex_radio_science_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_date_mex</span><span class="p">,</span> <span class="n">end_date_mex</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>

        <span class="c1"># url = &quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-v1/mexmrs_0735/aareadme.txt&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext9-v1/mexmrs_4405/aareadme.txt&quot;</span>
        <span class="n">radio_science_base_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-v1/&quot;</span>
        <span class="p">)</span>
        <span class="n">radio_science_base_urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext1-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext2-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext3-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext4-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext5-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext6-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext7-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext8-v1/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mex/mex-m-mrs-1_2_3-ext9-v1/&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mex_volume_ID_mapping</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">radio_observation_type</span><span class="p">:</span>
            <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_mapping_dict_by_radio_observation_type</span><span class="p">(</span>
                <span class="n">mapping_dict</span><span class="p">,</span>
                <span class="n">radio_observation_type</span><span class="p">,</span>
                <span class="n">start_date_mex</span><span class="p">,</span>
                <span class="n">end_date_mex</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">volume_ID_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mex_volume_ID</span><span class="p">(</span>
            <span class="n">start_date_mex</span><span class="p">,</span> <span class="n">end_date_mex</span><span class="p">,</span> <span class="n">mapping_dict</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mex_volume_ID</span><span class="p">(</span><span class="n">start_date_mex</span><span class="p">,</span> <span class="n">end_date_mex</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">volume_ID</span> <span class="ow">in</span> <span class="n">volume_ID_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">radio_science_base_url</span> <span class="ow">in</span> <span class="n">radio_science_base_urls</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">volume_ID_url</span> <span class="o">=</span> <span class="n">radio_science_base_url</span> <span class="o">+</span> <span class="n">volume_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
                            <span class="n">volume_ID_url</span>
                        <span class="p">)</span>  <span class="c1"># Use HEAD to check existence without downloading the content</span>
                        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL Exists: </span><span class="si">{</span><span class="n">volume_ID_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_ID_url</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL does not exist: </span><span class="si">{</span><span class="n">volume_ID_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_ID_url</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1"># print(f&quot;Error occurred for radio science base url {radio_science_base_url} and volume ID {volume_ID}: {e}&quot;)</span>
                        <span class="k">continue</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No url available for MEX radio science files. Please check the mapping.&quot;</span>
            <span class="p">)</span>

    <span class="c1">#########################################################################################################</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_mapping_dict_by_radio_observation_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="p">,</span> <span class="n">start_date_mex</span><span class="p">,</span> <span class="n">end_date_mex</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>

<span class="sd">        Filters a mapping dictionary to extract entries based on a specified observation type and a date range.</span>
<span class="sd">        The function returns a new dictionary where each key corresponds to a filtered set of entries that match</span>
<span class="sd">        the specified observation type and fall within the given start and end dates.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - mapping_dict (`dict`): A dictionary where keys represent categories and values are lists of entries. Each entry is expected to be a dictionary containing:</span>
<span class="sd">              - `start_date_utc` (`str`): The start date in UTC (format: YYYY-MM-DD).</span>
<span class="sd">              - `radio_observation_type` (`str`): The type of observation.</span>

<span class="sd">            - radio_observation_type (`str`): The type of observation to filter by (e.g., &#39;Phobos Gravity&#39;).</span>
<span class="sd">            - start_date_mex (`str`): The start date for filtering in UTC (format: YYYY-MM-DD).</span>
<span class="sd">            - end_date_mex (`str`): The end date for filtering in UTC (format: YYYY-MM-DD).</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `filtered_dict` (`dict`): A dictionary where keys are the same as in `mapping_dict`, and values are lists of filtered entries that match the specified observation type and fall within the date range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filtered_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">entry</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;radio_observation_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">radio_observation_type</span>
                <span class="ow">and</span> <span class="n">start_date_mex</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date_mex</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;radio_observation_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">radio_observation_type</span>
                <span class="ow">and</span> <span class="n">start_date_mex</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date_mex</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">filtered_dict</span>

    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.filter_mapping_dict_by_radio_observation_type">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.filter_mapping_dict_by_radio_observation_type">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_mapping_dict_by_radio_observation_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="p">,</span> <span class="n">start_date_mex</span><span class="p">,</span> <span class="n">end_date_mex</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Filters a mapping dictionary to extract entries based on a specified observation type and a date range.</span>
<span class="sd">        The function returns a new dictionary where each key corresponds to a filtered set of entries that match</span>
<span class="sd">        the specified observation type and fall within the given start and end dates.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - mapping_dict (`dict`): A dictionary where keys represent categories and values are lists of entries. Each entry is expected to be a dictionary containing:</span>
<span class="sd">                - `start_date_utc` (`str`): The start date in UTC (format: YYYY-MM-DD).</span>
<span class="sd">                - `radio_observation_type` (`str`): The type of observation.</span>

<span class="sd">            - radio_observation_type (`str`): The type of observation to filter by (e.g., &#39;Phobos Gravity&#39;).</span>
<span class="sd">            - start_date_mex (`str`): The start date for filtering in UTC (format: YYYY-MM-DD).</span>
<span class="sd">            - end_date_mex (`str`): The end date for filtering in UTC (format: YYYY-MM-DD).</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `filtered_dict` (`dict`): A dictionary where keys are the same as in `mapping_dict`, and values are lists</span>
<span class="sd">              of filtered entries that match the specified observation type and fall within the date range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filtered_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">entry</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;radio_observation_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">radio_observation_type</span>
                <span class="ow">and</span> <span class="n">start_date_mex</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date_mex</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;radio_observation_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">radio_observation_type</span>
                <span class="ow">and</span> <span class="n">start_date_mex</span> <span class="o">&lt;=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_date_mex</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">values</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">filtered_dict</span></div>


    <span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mex_volume_ID_mapping">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mex_volume_ID_mapping">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mex_volume_ID_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Fetches data from a given URL and extracts volume ID, date range, and observation type</span>
<span class="sd">        for the Mars Express mission. The data is returned as a dictionary mapping date intervals</span>
<span class="sd">        to volume IDs and metadata.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - url (`str`): The URL from which to fetch the data (plain text format).</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `mapping_dict` (`dict`): A dictionary where keys are tuples of (start_date_utc, end_date_utc), and values are dictionaries with:</span>

<span class="sd">                - `volume_id` (`str`): The volume ID.</span>
<span class="sd">                - `start_date_file` (`str`): Start date (YYYY-MM-DD).</span>
<span class="sd">                - `end_date_file` (`str`): End date (YYYY-MM-DD).</span>
<span class="sd">                - `radio_observation_type` (`str`): Type of observation.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Step 1: Fetch content from the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Check for request errors</span>
        <span class="n">aareadme_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Step 2: Parse content using regex to extract the table entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^\s*(MEXMRS_\d</span><span class="si">{4}</span><span class="s2">)\s+(MEXMRS_\d</span><span class="si">{4}</span><span class="s2">|\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">)\s+(\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">)\s+(.+?)\s*$&quot;</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Step 3: Find all matches and populate the dictionary</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">aareadme_text</span><span class="p">):</span>
            <span class="n">volume_id</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">start_date_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">end_date_file</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">start_date_utc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">start_date_file</span><span class="p">)</span>
            <span class="n">end_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">end_date_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">end_date_file</span> <span class="o">!=</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">interval_key_for_retrieval</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_date_utc</span><span class="p">,</span> <span class="n">end_date_utc</span><span class="p">)</span>
            <span class="n">radio_observation_type</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Add entry to dictionary</span>
            <span class="k">if</span> <span class="n">interval_key_for_retrieval</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">[</span><span class="n">interval_key_for_retrieval</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[]</span>
                <span class="p">)</span>  <span class="c1"># Initialize as a list</span>

            <span class="c1"># Append the current entry to the list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">[</span><span class="n">interval_key_for_retrieval</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;volume_id&quot;</span><span class="p">:</span> <span class="n">volume_id</span><span class="p">,</span>
                    <span class="s2">&quot;start_date_file&quot;</span><span class="p">:</span> <span class="n">start_date_file</span><span class="p">,</span>
                    <span class="s2">&quot;end_date_file&quot;</span><span class="p">:</span> <span class="n">end_date_file</span><span class="p">,</span>
                    <span class="s2">&quot;start_date_utc&quot;</span><span class="p">:</span> <span class="n">start_date_utc</span><span class="p">,</span>
                    <span class="s2">&quot;end_date_utc&quot;</span><span class="p">:</span> <span class="n">end_date_utc</span><span class="p">,</span>
                    <span class="s2">&quot;radio_observation_type&quot;</span><span class="p">:</span> <span class="n">radio_observation_type</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">################################################# END OF MEX SECTION ###############################################################</span>
    <span class="c1">########################################################################################################################################</span>

    <span class="c1"># --------------------------------------------------------------------------------------------------------------------------------------#</span>

    <span class="c1">########################################################################################################################################</span>
    <span class="c1">################################################# START OF JUICE SECTION ###############################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_juice_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_juice_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_juice_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Downloads various SPICE kernel and ancillary files for the JUICE mission, including clock, frame,</span>
<span class="sd">        orientation, and SPK kernels, based on a specified date range. Files are saved in the provided local folder.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): Path to the local folder where files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for the data retrieval.</span>
<span class="sd">            - end_date (`datetime`): The end date for the data retrieval.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `kernel_files_to_load` (`dict`): A dictionary containing the loaded kernel files, categorized by type</span>
<span class="sd">              (e.g., &#39;sclk&#39;, &#39;fk&#39;, &#39;ck&#39;, &#39;spk&#39;).</span>
<span class="sd">            - `radio_science_files_to_load` (`dict`): An empty dictionary for now, intended for radio science files.</span>
<span class="sd">            - `ancillary_files_to_load` (`dict`): An empty dictionary for now, intended for ancillary files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty for now, since we need fdets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty for now</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;juice&quot;</span>
        <span class="c1"># Clock files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Files:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/sclk/&quot;</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_clock_kernel_name</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>
        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>

        <span class="c1"># Frame Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Files:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/fk/&quot;</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;juice_v41.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_events_crema_5_1_150lb_23_1_v02.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_ops_v11.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_stations_topo_v01.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_dsk_surfaces_v11.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_sci_v17.tf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_roi_v02.tf&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Orientation Kernels:&quot;</span><span class="p">)</span>
        <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wanted_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;juice_mga_crema_5_1_150lb_23_1_baseline_v04.bc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_sa_crema_5_1_150lb_23_1_baseline_v04.bc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;juice_sc_crema_5_1_150lb_23_1_baseline_v03.bc&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">url_planned_ck_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/ck/&quot;</span>
        <span class="p">)</span>
        <span class="n">planned_ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_planned_ck_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_ck_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">planned_ck_files_to_load</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">planned_ck_files_to_load</span><span class="p">:</span>
                <span class="n">ck_files_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Crema Planned CK files to download this time.&quot;</span><span class="p">)</span>

        <span class="n">measured_url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/ck/&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">measured_url_ck_file</span> <span class="ow">in</span> <span class="n">measured_url_ck_files</span><span class="p">:</span>
                <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">measured_ck_files_to_load</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">measured_ck_files_to_load</span><span class="p">:</span>
                <span class="n">ck_files_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Measured ck files to download this time.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_files_to_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Overall CK files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># SPK files</span>
        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">measured_url_spk_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/JUICE/kernels/spk/&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_url_spk_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">measured_spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">measured_url_spk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">measured_url_spk_file</span> <span class="ow">in</span> <span class="n">measured_url_spk_files</span><span class="p">:</span>
                <span class="n">measured_spk_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">measured_url_spk_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">measured_spk_files_to_load</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">measured_spk_files_to_load</span><span class="p">:</span>
                <span class="n">spk_files_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------------------&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spk_files_to_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;spk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Overall SPK files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Tropospheric corrections</span>
        <span class="c1"># print(f&#39;===========================================================================================================\n&#39;)</span>
        <span class="c1"># print(f&#39;Download {input_mission.upper()} tropospheric corrections files\n&#39;)</span>
        <span class="c1"># url_tropo_files = &quot;https://pds-geosciences.wustl.edu/mro/mro-m-rss-1-magr-v1/mrors_0xxx/ancillary/tro/&quot;</span>
        <span class="c1"># tropo_files_to_load = self.dynamic_download_url_files_time_interval(input_mission,</span>
        <span class="c1">#    local_path=local_folder, start_date=start_date,</span>
        <span class="c1">#    end_date=end_date, url=url_tropo_files)</span>

        <span class="c1"># if tropo_files_to_load:</span>
        <span class="c1">#    self.ancillary_files_to_load[&#39;tro&#39;] = tropo_files_to_load</span>
        <span class="c1"># else:</span>
        <span class="c1">#    print(&#39;No tropospheric files to download this time.&#39;)</span>

        <span class="c1"># Ionospheric corrections</span>
        <span class="c1"># print(f&#39;===========================================================================================================\n&#39;)</span>
        <span class="c1"># print(f&#39;Download {input_mission.upper()} ionospheric corrections files\n&#39;)</span>
        <span class="c1"># url_ion_files = &quot;https://pds-geosciences.wustl.edu/mro/mro-m-rss-1-magr-v1/mrors_0xxx/ancillary/ion/&quot;</span>
        <span class="c1"># ion_files_to_load = self.dynamic_download_url_files_time_interval(input_mission,</span>
        <span class="c1">#    local_path=local_folder, start_date=start_date, end_date=end_date,</span>
        <span class="c1">#    url=url_ion_files)</span>

        <span class="c1"># if ion_files_to_load:</span>
        <span class="c1">#    self.ancillary_files_to_load[&#39;ion&#39;] = ion_files_to_load</span>
        <span class="c1"># else:</span>
        <span class="c1">#    print(&#39;No ionospheric files to download this time.&#39;)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">################################################### END OF JUICE SECTION ###############################################################</span>
    <span class="c1">########################################################################################################################################</span>

    <span class="c1"># --------------------------------------------------------------------------------------------------------------------------------------#</span>

    <span class="c1">########################################################################################################################################</span>
    <span class="c1">################################################### START OF MRO SECTION ###############################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mro_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mro_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mro_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_science_file_type</span><span class="o">=</span><span class="s2">&quot;odf&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Downloads various SPICE kernel and ancillary files for the MRO mission, including clock, frame,</span>
<span class="sd">        orientation, and SPK kernels, based on a specified date range. Files are saved in the provided local folder.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): Path to the local folder where files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for the data retrieval.</span>
<span class="sd">            - end_date (`datetime`): The end date for the data retrieval.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `kernel_files_to_load` (`dict`): A dictionary containing the loaded kernel files, categorized by type</span>
<span class="sd">              (e.g., &#39;sclk&#39;, &#39;fk&#39;, &#39;ck&#39;, &#39;spk&#39;).</span>
<span class="sd">            - `radio_science_files_to_load` (`dict`): An empty dictionary for now, intended for radio science files.</span>
<span class="sd">            - `ancillary_files_to_load` (`dict`): An empty dictionary for now, intended for ancillary files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;mro&quot;</span>
        <span class="c1"># ODF files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">radio_science_file_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> files:&quot;</span>
        <span class="p">)</span>
        <span class="n">url_radio_science_file_type</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/mro/mro-m-rss-1-magr-v1/mrors_0xxx/</span><span class="si">{}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">radio_science_file_type</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">radio_science_file_type</span>
        <span class="k">for</span> <span class="n">url_radio_science_file</span> <span class="ow">in</span> <span class="n">url_radio_science_file_type</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_single_time</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_radio_science_file</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Radio Science files to download this time.&quot;</span><span class="p">)</span>
        <span class="c1"># Clock Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/sclk/&quot;</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_clock_kernel_name</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>
        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error handling clock file downloads: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="c1"># Frame Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/fk/&quot;</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mro_v16.tf&quot;</span><span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Planetary and Ephemeris Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_spk_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/spk/&quot;</span>
        <span class="n">wanted_spk_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_mro_spk_files</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_spk_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">wanted_struct_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mro_struct_v10.bsp&quot;</span><span class="p">]</span>
        <span class="n">struct_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_struct_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">spk_files_to_load</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">struct_files_to_load</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">spk_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;spk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Orientation Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Orientation Kernels:&quot;</span><span class="p">)</span>
        <span class="n">measured_url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/ck/&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">measured_url_ck_file</span> <span class="ow">in</span> <span class="n">measured_url_ck_files</span><span class="p">:</span>
                <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">measured_ck_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measured_ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ck files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Tropospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Tropospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_tropo_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/mro/mro-m-rss-1-magr-v1/mrors_0xxx/ancillary/tro/&quot;</span>
        <span class="n">tropo_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_tropo_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">tropo_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;tro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tropo_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tropospheric files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Ionospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Ionospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_ion_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/mro/mro-m-rss-1-magr-v1/mrors_0xxx/ancillary/ion/&quot;</span>
        <span class="n">ion_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_ion_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">ion_files_to_load</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ion_files_to_load</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ionospheric files to download this time.&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error handling file downloads: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mapping_dict_spk_mro">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mapping_dict_spk_mro">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mapping_dict_spk_mro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Fetches and parses phase information for MRO SPK kernels from a given URL. It extracts the phase name</span>
<span class="sd">        along with the associated start and end dates, and returns a dictionary mapping date intervals to phase names.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - url (`str`): The URL from which to fetch the phase information.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `phase_dict` (`dict`): A dictionary where the keys are tuples representing date intervals</span>
<span class="sd">              (start_date, end_date), and the values are dictionaries containing the SPK phase ID (`spk_ID`).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Step 1: Fetch content from the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Check for request errors</span>
        <span class="n">file_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Step 2: Define a dictionary to hold date intervals and phase names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Step 3: Regex pattern to capture phase name and dates</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^\s*(\w+)\s+(\d</span><span class="si">{4}</span><span class="s2"> \w</span><span class="si">{3}</span><span class="s2"> \d</span><span class="si">{2}</span><span class="s2">)\s+(\d</span><span class="si">{4}</span><span class="s2"> \w</span><span class="si">{3}</span><span class="s2"> \d</span><span class="si">{2}</span><span class="s2">)\s*$&quot;</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Step 4: Extract all matches and populate the dictionary</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">file_text</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Convert string dates to datetime objects for easier manipulation if needed</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date_str</span><span class="p">,</span> <span class="s2">&quot;%Y %b </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date_str</span><span class="p">,</span> <span class="s2">&quot;%Y %b </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Use the date interval as the key and the phase as the value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_dict</span><span class="p">[(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;spk_ID&quot;</span><span class="p">:</span> <span class="n">phase</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_dict</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_mro_spk_ID">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_mro_spk_ID">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mro_spk_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Checks if the given date interval overlaps with any of the date intervals in the mapping dictionary,</span>
<span class="sd">        and returns a list of SPK IDs associated with those overlapping intervals.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - start_date (`datetime`): The start date of the input interval.</span>
<span class="sd">            - end_date (`datetime`): The end date of the input interval.</span>
<span class="sd">            - mapping_dict (`dict`): A dictionary mapping date intervals (as tuples of start and end dates)</span>
<span class="sd">              to SPK phase IDs (`spk_ID`).</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `spk_id_list` (`list`): A list of SPK IDs associated with the overlapping intervals.</span>

<span class="sd">        Raises:</span>
<span class="sd">            - `ValueError`: If no SPK IDs are found for the given date interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spk_id_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key_start</span><span class="p">,</span> <span class="n">key_end</span><span class="p">),</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check if either start or end of the input interval overlaps with the dictionary interval</span>
            <span class="k">if</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">key_end</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="o">&gt;=</span> <span class="n">key_start</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spk_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;spk_ID&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spk_id_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spk_id_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No MRO SPK_ID found associated to input interval: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_url_mro_spk_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_url_mro_spk_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_url_mro_spk_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Fetches the SPK file URLs associated with the given date range for the MRO mission. It first retrieves</span>
<span class="sd">        a mapping of SPK phases to date intervals, identifies the SPK IDs that overlap with the input interval,</span>
<span class="sd">        and then constructs the corresponding SPK file URLs.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - start_date (`datetime`): The start date of the input interval.</span>
<span class="sd">            - end_date (`datetime`): The end date of the input interval.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `spk_ID_urls` (`list`): A list of SPK file URLs corresponding to the overlapping SPK IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            - `ValueError`: If no SPK file URLs are found for the given date range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/mro-m-spice-6-v1.0/mrosp_1000/data/spk/spkinfo.txt&quot;</span>
        <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mapping_dict_spk_mro</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">spk_ID_urls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">spk_ID_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mro_spk_ID</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spk_ID_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">spk_ID</span> <span class="ow">in</span> <span class="n">spk_ID_list</span><span class="p">:</span>
                <span class="n">spk_ID_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mro_</span><span class="si">{</span><span class="n">spk_ID</span><span class="si">}</span><span class="s2">.bsp&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spk_ID_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spk_ID_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spk_ID_urls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spk_ID_urls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No url available for MEX radio science files. Please check the mapping.&quot;</span>
            <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">##################################################### END OF MRO SECTION ###############################################################</span>
    <span class="c1">########################################################################################################################################</span>

    <span class="c1"># --------------------------------------------------------------------------------------------------------------------------------------#</span>

    <span class="c1">########################################################################################################################################</span>
    <span class="c1">################################################### START OF CASSINI SECTION ###########################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_cassini_flyby_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_cassini_flyby_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cassini_flyby_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Downloads Cassini mission data files related to a specific flyby, including kernel, ancillary, and</span>
<span class="sd">        radio science files. The function fetches the cumulative index table and identifies the relevant</span>
<span class="sd">        files for download based on the provided flyby ID. It handles the file download process, ensuring</span>
<span class="sd">        that files are downloaded only if they are not already present in the specified local folder.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): The path to the local directory where files should be downloaded.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - kernel_files_to_load (`dict`): A dictionary containing kernel files (e.g., `ck`, `spk`).</span>
<span class="sd">            - radio_science_files_to_load (`dict`): A dictionary containing radio science files (e.g., `odf`).</span>
<span class="sd">            - ancillary_files_to_load (`dict`): A dictionary containing ancillary files (e.g., `ion`, `tro`, `eop`).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;cassini&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">flyby_ID</span> <span class="o">=</span> <span class="n">local_folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_folder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>

        <span class="n">filenames_to_download</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flyby_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cassini_flyby2experiment</span><span class="p">(</span><span class="n">flyby_ID</span><span class="p">)</span>

        <span class="c1"># Ensure &#39;cumindex_repo&#39; is set to &#39;pds_repo&#39; if &#39;cumindex_repo&#39; is None</span>
        <span class="n">cumindex_repo</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;cumindex_repo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;cumindex_repo&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;pds_repo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Get URLs and cumulative index table</span>
        <span class="n">volume_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_flyby_volume_url</span><span class="p">(</span><span class="n">flyby_dict</span><span class="p">)</span>
        <span class="n">cumindex_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_flyby_cumindex_url</span><span class="p">(</span><span class="n">flyby_dict</span><span class="p">)</span>
        <span class="n">cumindex_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cassini_volume_cumindex_table</span><span class="p">(</span><span class="n">cumindex_url</span><span class="p">)</span>

        <span class="c1"># Create dictionary of filenames by pds_repo</span>
        <span class="n">filenames_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">pds_repo</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pds_repo</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">cumindex_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">pds_repo</span><span class="p">,</span> <span class="n">filenames_list</span> <span class="ow">in</span> <span class="n">filenames_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">wanted_filenames</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">volume_url</span> <span class="o">+</span> <span class="n">pds_repo</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames_list</span>
            <span class="p">]</span>
            <span class="n">filenames_to_download</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wanted_filenames</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Kernels (ck, spk) Ancillary Files (eop, ion, tro) and Radio Science (odf) files from PDS Atmosphere Node:&quot;</span>
        <span class="p">)</span>
        <span class="c1"># Download each file if not already present</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames_to_download</span><span class="p">:</span>
            <span class="c1"># Extract the actual filename from the URL</span>
            <span class="n">actual_filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">actual_filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ckf&quot;</span><span class="p">):</span>
                <span class="n">file_ext</span> <span class="o">=</span> <span class="s2">&quot;ck&quot;</span>
                <span class="n">file_folder</span> <span class="o">=</span> <span class="n">file_ext</span>
                <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">local_folder</span><span class="p">,</span> <span class="n">file_folder</span><span class="p">,</span> <span class="n">actual_filename</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_ext</span> <span class="o">=</span> <span class="n">actual_filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">file_folder</span> <span class="o">=</span> <span class="n">file_ext</span>
                <span class="n">local_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">local_folder</span><span class="p">,</span> <span class="n">file_folder</span><span class="p">,</span> <span class="n">actual_filename</span>
                <span class="p">)</span>

            <span class="c1"># Check if the file already exists in the local folder</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">actual_filename</span><span class="si">}</span><span class="s2"> already exists in </span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2"> and will not be downloaded.&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Add file paths for &#39;ck&#39; type files</span>

                <span class="k">if</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;tro&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">local_file_path</span>
                    <span class="p">)</span>

                <span class="k">elif</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;odf&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">local_file_path</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">local_file_path</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Download the file if it doesn&#39;t exist</span>
                    <span class="n">urlretrieve</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; to: </span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;tro&quot;</span><span class="p">,</span> <span class="s2">&quot;eop&quot;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">local_file_path</span>
                        <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;odf&quot;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                            <span class="n">file_ext</span><span class="p">,</span> <span class="p">[]</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">local_file_path</span>
                        <span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">urlretrieve</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">local_file_path</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Downloading: &#39;</span><span class="si">{</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; to: </span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                        <span class="k">if</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">,</span> <span class="s2">&quot;tro&quot;</span><span class="p">,</span> <span class="s2">&quot;eop&quot;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                                <span class="n">file_ext</span><span class="p">,</span> <span class="p">[]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">file_ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;odf&quot;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                                <span class="n">file_ext</span><span class="p">,</span> <span class="p">[]</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">file_ext</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">local_file_path</span>
                            <span class="p">)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error downloading </span><span class="si">{</span><span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Frame Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels from NAIF:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/CASSINI/kernels/fk/&quot;</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cas_v43.tf&quot;</span><span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.cassini_flyby2experiment">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.cassini_flyby2experiment">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cassini_flyby2experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flyby_ID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Returns the experiment data for a given flyby ID from the `cassini_titan_flyby_dict`. If the provided</span>
<span class="sd">        flyby ID exists in the dictionary, it retrieves the corresponding data; otherwise, it returns a</span>
<span class="sd">        message indicating that the flyby ID was not found.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - flyby_ID (`str`): The identifier for a specific flyby.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `dict` or `str`: The experiment data associated with the provided flyby ID if found,</span>
<span class="sd">              otherwise a message stating that the flyby ID was not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if the flyby_ID exists in the dictionary</span>
        <span class="k">if</span> <span class="n">flyby_ID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cassini_titan_flyby_dict</span><span class="p">:</span>
            <span class="c1"># Return the corresponding data for the given flyby_ID</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cassini_titan_flyby_dict</span><span class="p">[</span><span class="n">flyby_ID</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the flyby_ID is not found, return a message indicating so</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Flyby ID </span><span class="si">{</span><span class="n">flyby_ID</span><span class="si">}</span><span class="s2"> not found.&quot;</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_cassini_full_moon_flybys_list">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_cassini_full_moon_flybys_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cassini_full_moon_flybys_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moon</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Returns a list of flyby IDs corresponding to either Titan or Enceladus. If the provided</span>
<span class="sd">        moon name is &#39;titan&#39;, it returns the flyby IDs from the `cassini_titan_flyby_dict`; if the name is</span>
<span class="sd">        &#39;enceladus&#39;, it returns the flyby IDs from the `enceladus_flyby_dict`. If the input moon name</span>
<span class="sd">        is invalid, an error is raised.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - moon (`str`): The name of the moon (&#39;titan&#39; or &#39;enceladus&#39;) for which flyby IDs should</span>
<span class="sd">              be retrieved.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `list`: A list of flyby IDs corresponding to the provided moon. If the moon name is invalid,</span>
<span class="sd">              a `ValueError` is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">moon</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;titan&quot;</span><span class="p">:</span>
            <span class="c1"># Return the keys of the cassini_titan_flyby_dict</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cassini_titan_flyby_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">moon</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;enceladus&quot;</span><span class="p">:</span>
            <span class="c1"># Return the keys of the enceladus_flyby_dict</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enceladus_flyby_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid moon name. Please provide a valid Saturn Moon name.&quot;</span>
            <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_cassini_flyby_volume_url">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_cassini_flyby_volume_url">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cassini_flyby_volume_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flyby_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Retrieves the PDS (Planetary Data System) repository URL for a given flyby experiment. The function</span>
<span class="sd">        extracts the &#39;experiment&#39; value from the provided `flyby_dict` and constructs the URL based on that</span>
<span class="sd">        information. It then checks whether the constructed URL exists by sending a HEAD request. If the URL</span>
<span class="sd">        is valid (status code 200), the function returns the URL; otherwise, it returns `None` and prints</span>
<span class="sd">        an error message.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - flyby_dict (`dict`): A dictionary containing data for a specific flyby, including the &#39;experiment&#39;</span>
<span class="sd">              key used to construct the URL.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `str` or `None`: The constructed PDS repository URL if it exists; otherwise, `None` if the URL</span>
<span class="sd">              is not found or an error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Extract the &#39;experiment&#39; value from the flyby_dict</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span>

        <span class="c1"># Define the URL template</span>
        <span class="n">pds_repo_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://atmos.nmsu.edu/pdsd/archive/data/co-ssa-rss-1-</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">-v10/&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Check if the URL exists by sending a HEAD request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">pds_repo_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># If the status code is 200, the URL exists</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pds_repo_url</span> <span class="o">=</span> <span class="n">pds_repo_url</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pds_repo_url</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the status code is not 200, URL doesn&#39;t exist</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;URL not found: </span><span class="si">{</span><span class="n">pds_repo_url</span><span class="si">}</span><span class="s2">. Please check the template URL in: get_cassini_flyby_volume_url&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Catch any exceptions (e.g., network errors, invalid URL)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_cassini_flyby_cumindex_url">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_cassini_flyby_cumindex_url">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cassini_flyby_cumindex_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flyby_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Constructs the URL for the cumulative index (CUMINDEX.TAB) file associated with a specific flyby</span>
<span class="sd">        experiment. The function extracts the &#39;experiment&#39; and &#39;cumindex_repo&#39; (or &#39;pds_repo&#39;) values from</span>
<span class="sd">        the provided `flyby_dict` to build the URL. It then checks if the URL exists by sending a HEAD request.</span>
<span class="sd">        If the URL is valid (status code 200), it returns the URL; otherwise, it attempts an alternative URL and</span>
<span class="sd">        returns it if valid. If neither URL is found, it returns `None` and prints an error message.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - flyby_dict (`dict`): A dictionary containing data for a specific flyby, including the &#39;experiment&#39;</span>
<span class="sd">              and &#39;cumindex_repo&#39; (or &#39;pds_repo&#39;) keys used to construct the cumulative index URL.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `str` or `None`: The constructed cumulative index URL if it exists; otherwise, `None` if the URL</span>
<span class="sd">              is not found or an error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Extract the &#39;experiment&#39; value from the flyby_dict</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span>
        <span class="n">cumindex_repo</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;cumindex_repo&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;cumindex_repo&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">flyby_dict</span><span class="p">[</span><span class="s2">&quot;pds_repo&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Define the URL template</span>

        <span class="n">cumindex_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://atmos.nmsu.edu/pdsd/archive/data/co-ssa-rss-1-</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">-v10/</span><span class="si">{</span><span class="n">cumindex_repo</span><span class="si">}</span><span class="s2">/INDEX/CUMINDEX.TAB&quot;</span>
        <span class="c1"># Check if the URL exists by sending a HEAD request</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
                <span class="n">cumindex_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># Sends a HEAD request</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># If the status code is 200, the URL exists</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cumindex_url</span> <span class="o">=</span> <span class="n">cumindex_url</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumindex_url</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the status code is not 200, URL doesn&#39;t exist</span>
                <span class="n">cumindex_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://atmos.nmsu.edu/pdsd/archive/data/co-ssa-rss-1-</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">-v10/</span><span class="si">{</span><span class="n">cumindex_repo</span><span class="si">}</span><span class="s2">/index/cumindex.tab&quot;</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
                    <span class="n">cumindex_url</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>  <span class="c1"># Sends a HEAD request</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="c1"># If the status code is 200, the URL exists</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cumindex_url</span> <span class="o">=</span> <span class="n">cumindex_url</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cumindex_url</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;URL not found: </span><span class="si">{</span><span class="n">cumindex_url</span><span class="si">}</span><span class="s2">. Please check the template URL in: get_cassini_flyby_cumindex_url&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Or return an appropriate message indicating the issue</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Catch any exceptions (e.g., network errors, invalid URL)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error checking URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Or return an error message</span></div>


    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_cassini_volume_cumindex_table">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_cassini_volume_cumindex_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cassini_volume_cumindex_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cumindex_url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Constructs the URL for the cumulative index (CUMINDEX.TAB) file associated with a specific flyby</span>
<span class="sd">        experiment. The function extracts the &#39;experiment&#39; and &#39;cumindex_repo&#39; (or &#39;pds_repo&#39;) values from</span>
<span class="sd">        the provided `flyby_dict` to build the URL. It then checks if the URL exists by sending a HEAD request.</span>
<span class="sd">        If the URL is valid (status code 200), it returns the URL; otherwise, it attempts an alternative URL and</span>
<span class="sd">        returns it if valid. If neither URL is found, it returns `None` and prints an error message.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - flyby_dict (`dict`): A dictionary containing data for a specific flyby, including the &#39;experiment&#39;</span>
<span class="sd">              and &#39;cumindex_repo&#39; (or &#39;pds_repo&#39;) keys used to construct the cumulative index URL.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `str` or `None`: The constructed cumulative index URL if it exists; otherwise, `None` if the URL</span>
<span class="sd">              is not found or an error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fetch the .tab file content from the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cumindex_url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Ensure the request was successful</span>

        <span class="c1"># Split the response content into lines</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="c1"># Prepare the dictionary to store the result</span>
        <span class="n">cumindex_table</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Iterate over each line in the file</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># Split the line by commas (assuming the .tab file is comma-separated)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

            <span class="c1"># Skip lines that don&#39;t have the expected number of columns</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Extract the columns</span>
            <span class="n">pds_repo</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">file_label</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">file_label_path</span> <span class="o">=</span> <span class="n">file_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">file_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">file_label_path</span>
                <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                <span class="o">+</span> <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">external_file_name</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">start_date_utc</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">end_date_utc</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">creation_date_utc</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;tigm&quot;</span><span class="p">,</span> <span class="s2">&quot;odf&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;tigf&quot;</span><span class="p">,</span> <span class="s2">&quot;odf&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ancillary&quot;</span><span class="p">,</span> <span class="s2">&quot;eop&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ancillary&quot;</span><span class="p">,</span> <span class="s2">&quot;tro&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ancillary&quot;</span><span class="p">,</span> <span class="s2">&quot;ion&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ancillary&quot;</span><span class="p">,</span> <span class="s2">&quot;spk&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ancillary&quot;</span><span class="p">,</span> <span class="s2">&quot;ckf&quot;</span><span class="p">),</span>
            <span class="p">]</span>

            <span class="c1"># Check if both words in any pair appear in the file_label</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                <span class="nb">all</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">file_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">keywords</span>
            <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">start_date_utc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">start_date_utc</span><span class="p">)</span>
                    <span class="n">end_date_utc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">end_date_utc</span><span class="p">)</span>
                    <span class="n">creation_date_utc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span>
                        <span class="n">creation_date_utc</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping time conversion due to invalid date format.&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># Skip rows with invalid date format</span>

                <span class="c1"># Use setdefault to ensure the key exists and initialize lists if not</span>
                <span class="k">if</span> <span class="n">pds_repo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cumindex_table</span><span class="p">:</span>
                    <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;file_label&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;file_name&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;external_file_name&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;start_date_utc&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;end_date_utc&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;creation_date_utc&quot;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="p">}</span>

                <span class="c1"># Append data to the lists for the current pds_repo</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;file_label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_label</span><span class="p">)</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;file_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;external_file_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">external_file_name</span>
                <span class="p">)</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_date_utc</span><span class="p">)</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;end_date_utc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_date_utc</span><span class="p">)</span>
                <span class="n">cumindex_table</span><span class="p">[</span><span class="n">pds_repo</span><span class="p">][</span><span class="s2">&quot;creation_date_utc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">creation_date_utc</span><span class="p">)</span>

        <span class="c1"># Return the cumindex_table</span>
        <span class="k">return</span> <span class="n">cumindex_table</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">########################################## END OF CASSINI SECTION #####################################################################</span>
    <span class="c1">########################################################################################################################################</span>

    <span class="c1">########################################################################################################################################</span>
    <span class="c1">########################################## START OF GRAIL-A SECTION ####################################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_grail_a_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_grail_a_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_grail_a_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Downloads various SPICE kernel and ancillary files for the GRAIL-A mission, including clock, frame,</span>
<span class="sd">        orientation, and SPK kernels, based on a specified date range. Files are saved in the provided local folder.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): Path to the local folder where files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for the data retrieval.</span>
<span class="sd">            - end_date (`datetime`): The end date for the data retrieval.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `kernel_files_to_load` (`dict`): A dictionary containing the loaded kernel files, categorized by type</span>
<span class="sd">              (e.g., &#39;sclk&#39;, &#39;fk&#39;, &#39;ck&#39;, &#39;spk&#39;).</span>
<span class="sd">            - `radio_science_files_to_load` (`dict`): An empty dictionary for now, intended for radio science files.</span>
<span class="sd">            - `ancillary_files_to_load` (`dict`): An empty dictionary for now, intended for ancillary files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;grail-a&quot;</span>

        <span class="c1"># ODF files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> ODF files:&quot;</span><span class="p">)</span>
        <span class="n">url_radio_science_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/odf/&quot;</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">url_radio_science_file</span> <span class="ow">in</span> <span class="n">url_radio_science_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_single_time</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_radio_science_file</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;odf&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Radio Science files to download this time.&quot;</span><span class="p">)</span>

        <span class="c1"># Clock Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/sclk/&quot;</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_clock_kernel_name</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>
        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="s2">&quot;./grail_archive&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>

        <span class="c1"># Frame Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/fk/&quot;</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;grail_v07.tf&quot;</span><span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="s2">&quot;./grail_archive&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># maneuver Files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Maneuver Files:&quot;</span><span class="p">)</span>
        <span class="n">url_man_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-lgrs-2-edr-v1/grail_0001/level_0/2012_04_06/&quot;</span>
        <span class="n">wanted_man_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mas00_2012_04_06_a_04.asc&quot;</span><span class="p">]</span>
        <span class="n">man_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_man_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_man_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="s2">&quot;./grail_archive&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">man_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;maneuver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">man_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maneuver files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Antenna Switch Files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Antenna Switch Files:&quot;</span><span class="p">)</span>

        <span class="n">url_antenna_switch_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-lgrs-3-cdr-v1/grail_0101/level_1b/&quot;</span>
        <span class="n">antenna_switch_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_url_files_time</span><span class="p">(</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="s2">&quot;antenna_switch/&quot;</span><span class="p">),</span>
            <span class="n">filename_format</span><span class="o">=</span><span class="s2">&quot;*/vgs1b_*_a_04.asc&quot;</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_antenna_switch_files</span><span class="p">,</span>
            <span class="n">time_format</span><span class="o">=</span><span class="s2">&quot;%Y_%m_</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">indices_date_filename</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">antenna_switch_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;antenna_switch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">antenna_switch_files_to_load</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Antenna Switch files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Planetary and Ephemeris Kernels</span>
        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_spk_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/spk/&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_spk_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_spk_file</span> <span class="ow">in</span> <span class="n">url_spk_files</span><span class="p">:</span>
                <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_spk_file</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">spk_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Orientation Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Orientation Kernels:&quot;</span><span class="p">)</span>
        <span class="n">measured_url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/ck/&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">measured_url_ck_file</span> <span class="ow">in</span> <span class="n">measured_url_ck_files</span><span class="p">:</span>
                <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">measured_ck_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measured_ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ck files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Tropospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Tropospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_tropo_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/ancillary/tro/&quot;</span>
        <span class="n">tropo_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_tropo_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">tropo_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;tro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tropo_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tropospheric files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Ionospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Ionospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_ion_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/ancillary/ion/&quot;</span>
        <span class="n">ion_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_ion_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ion_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ion_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ionospheric files to download this time.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1">########################################################################################################################################</span>
    <span class="c1">########################################## END OF GRAIL-A SECTION ####################################################################</span>
    <span class="c1">########################################################################################################################################</span>

    <span class="c1">########################################################################################################################################</span>
    <span class="c1">########################################## START OF GRAIL-B SECTION ####################################################################</span>
    <span class="c1">########################################################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_grail_b_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_grail_b_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_grail_b_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Downloads various SPICE kernel and ancillary files for the GRAIL_B mission, including clock, frame,</span>
<span class="sd">        orientation, and SPK kernels, based on a specified date range. Files are saved in the provided local folder.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): Path to the local folder where files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for the data retrieval.</span>
<span class="sd">            - end_date (`datetime`): The end date for the data retrieval.</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `kernel_files_to_load` (`dict`): A dictionary containing the loaded kernel files, categorized by type</span>
<span class="sd">              (e.g., &#39;sclk&#39;, &#39;fk&#39;, &#39;ck&#39;, &#39;spk&#39;).</span>
<span class="sd">            - `radio_science_files_to_load` (`dict`): An empty dictionary for now, intended for radio science files.</span>
<span class="sd">            - `ancillary_files_to_load` (`dict`): An empty dictionary for now, intended for ancillary files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;grail-b&quot;</span>

        <span class="c1"># ODF files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> ODF files:&quot;</span><span class="p">)</span>
        <span class="n">url_radio_science_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/odf/&quot;</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">url_radio_science_file</span> <span class="ow">in</span> <span class="n">url_radio_science_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_single_time</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_radio_science_file</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;odf&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Radio Science files to download this time.&quot;</span><span class="p">)</span>

        <span class="c1"># Clock Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/sclk/&quot;</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latest_clock_kernel_name</span><span class="p">(</span><span class="n">input_mission</span><span class="p">)</span>
        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>

        <span class="c1"># Frame Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/fk/&quot;</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;grail_v07.tf&quot;</span><span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># maneuver Files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Maneuver Files:&quot;</span><span class="p">)</span>
        <span class="n">url_man_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-lgrs-2-edr-v1/grail_0001/level_0/&quot;</span>
        <span class="n">wanted_man_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mas00_2012_04_06_a_04.asc&quot;</span><span class="p">]</span>
        <span class="n">man_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_man_files</span><span class="p">,</span>
            <span class="n">wanted_files_patterns</span><span class="o">=</span><span class="n">wanted_man_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">man_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;maneuver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">man_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No maneuver files to download this time.&quot;</span><span class="p">)</span>

        <span class="n">url_antenna_switch_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-lgrs-3-cdr-v1/grail_0101/level_1b/&quot;</span>
        <span class="n">wanted_antenna_switch_files_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*/vgs1b_*_a_04.asc&quot;</span><span class="p">]</span>
        <span class="n">antenna_switch_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_antenna_switch_files</span><span class="p">,</span>
            <span class="n">wanted_files_patterns</span><span class="o">=</span><span class="n">wanted_antenna_switch_files_patterns</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">antenna_switch_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;antenna_switch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">antenna_switch_files_to_load</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Antenna Switch files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Planetary and Ephemeris Kernels</span>
        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_spk_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/spk/&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_spk_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_spk_file</span> <span class="ow">in</span> <span class="n">url_spk_files</span><span class="p">:</span>
                <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                    <span class="n">input_mission</span><span class="p">,</span>
                    <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                    <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">url_spk_file</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">spk_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Orientation Kernels</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Orientation Kernels:&quot;</span><span class="p">)</span>
        <span class="n">measured_url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://naif.jpl.nasa.gov/pub/naif/pds/data/grail-l-spice-6-v1.0/grlsp_1000/data/ck/&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measured_url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">measured_url_ck_file</span> <span class="ow">in</span> <span class="n">measured_url_ck_files</span><span class="p">:</span>
                <span class="n">measured_ck_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">measured_url_ck_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">measured_ck_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measured_ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ck files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Tropospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Tropospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_tropo_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/ancillary/tro/&quot;</span>
        <span class="n">tropo_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_tropo_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">tropo_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;tro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tropo_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No tropospheric files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Ionospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Ionospheric Corrections Files&quot;</span><span class="p">)</span>
        <span class="n">url_ion_files</span> <span class="o">=</span> <span class="s2">&quot;https://pds-geosciences.wustl.edu/grail/grail-l-rss-2-edr-v1/grail_0201/ancillary/ion/&quot;</span>
        <span class="n">ion_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="p">,</span>
            <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_ion_files</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ion_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="s2">&quot;ion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ion_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No ionospheric files to download this time.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1">########################################################################################################################################</span>
<span class="c1">########################################## END OF GRAIL-B SECTION ####################################################################</span>
<span class="c1">########################################################################################################################################</span>

<span class="c1">########################################################################################################################################</span>
<span class="c1">########################################## START OF ROSETTA SECTION ####################################################################</span>
<span class="c1">########################################################################################################################################</span>


<div class="viewcode-block" id="LoadPDS.get_ro_files">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_ro_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ro_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        This function downloads and organizes various types of SPICE kernels and</span>
<span class="sd">        radio science files for the ROSETTA mission.</span>
<span class="sd">        It supports downloading kernel files related to radio science, clock data, frame data,</span>
<span class="sd">        SPK (spacecraft position) data, CK (orientation) data, and tropospheric/ionospheric correction files.</span>
<span class="sd">        The function interacts with remote FTP servers to retrieve the data and organizes them into the specified local folder.</span>
<span class="sd">        The data is filtered by a given date range, and the function returns the downloaded files for further use.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - local_folder (`str`): The local directory where the downloaded files will be saved.</span>
<span class="sd">            - start_date (`datetime`): The start date for downloading data.</span>
<span class="sd">              This will filter the data to include only those within the date range.</span>
<span class="sd">            - end_date (`datetime`): The end date for downloading data.</span>
<span class="sd">              This will filter the data to include only those within the date range.</span>
<span class="sd">            - radio_observation_type (`str`): The type of radio science files to download (e.g. commissioning, checkout, solar conjuction, Lutetia, Global Gravity etc...)</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - (`dict`, `dict`, `dict`): A tuple containing:</span>
<span class="sd">                - `kernel_files_to_load` (`dict`): A dictionary where the keys are kernel types</span>
<span class="sd">                (e.g., &#39;ck&#39;, &#39;spk&#39;, &#39;fk&#39;, &#39;sclk&#39;) and values are lists of paths to the successfully downloaded and loaded kernel files.</span>
<span class="sd">                - `radio_science_files_to_load` (`dict`): A dictionary where keys are categories of</span>
<span class="sd">                radio science data (e.g., &#39;ifms_dp2&#39;, &#39;dsn_dps&#39;) and values are lists of paths</span>
<span class="sd">                to the successfully downloaded radio science files.</span>
<span class="sd">                - `ancillary_files_to_load` (`dict`): A dictionary where keys are categories</span>
<span class="sd">                of ancillary data (e.g., &#39;ion&#39;, &#39;tropospheric&#39;) and values are lists of paths</span>
<span class="sd">                to the successfully downloaded ancillary files, such as tropospheric and ionospheric corrections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty for now</span>

        <span class="n">input_mission</span> <span class="o">=</span> <span class="s2">&quot;ro&quot;</span>
        <span class="c1"># Tropospheric corrections</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Tropospheric and Ionospheric Corrections Files&quot;</span>
        <span class="p">)</span>
        <span class="n">url_tropo_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_ro_radio_science_files</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">url_tropo_file_new</span> <span class="ow">in</span> <span class="n">url_tropo_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">folder_type</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;CALIB/CLOSED_LOOP/IFMS/MET/&quot;</span><span class="p">,</span>
                <span class="s2">&quot;CALIB/CLOSED_LOOP/DSN/MET/&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">url_flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">url_tropo_file</span> <span class="o">=</span> <span class="n">url_tropo_file_new</span> <span class="o">+</span> <span class="n">folder_type</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_tropo_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">url_flag</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
                    <span class="c1"># Parse the HTML with BeautifulSoup</span>
                    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
                    <span class="c1"># Extract file links and their names</span>
                    <span class="n">wanted_tropo_files</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
                        <span class="n">href</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.TAB&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">href</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.AUX&quot;</span><span class="p">):</span>
                            <span class="n">wanted_tropo_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">href</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">tropo_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_tropo_file</span><span class="p">,</span>
                        <span class="n">wanted_files_patterns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*L3L1B*.TAB&quot;</span><span class="p">],</span>
                        <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">tropo_files_to_load</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">folder_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tropo_files_to_load</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;No tropospheric or ionospheric files to download this time.&quot;</span>
                    <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Radio Science Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_radio_science_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_url_ro_radio_science_files</span><span class="p">(</span>
            <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">radio_observation_type</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">url_radio_science_file_new</span> <span class="ow">in</span> <span class="n">url_radio_science_files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">closed_loop_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;IFMS/DP2/&quot;</span><span class="p">,</span> <span class="s2">&quot;DSN/DPS/&quot;</span><span class="p">,</span> <span class="s2">&quot;DSN/DPX/&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_radio_science_file</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">url_radio_science_file_new</span>
                        <span class="o">+</span> <span class="s2">&quot;DATA/LEVEL02/CLOSED_LOOP/&quot;</span>
                        <span class="o">+</span> <span class="n">closed_loop_type</span>
                    <span class="p">)</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_single_time</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_radio_science_file</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">closed_loop_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">closed_loop_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">files</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="c1"># Clock files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Clock Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_clock_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/sclk/&quot;</span>
        <span class="p">)</span>


        <span class="c1"># wanted_clock_files = self.get_latest_clock_kernel_name(input_mission)</span>
        <span class="n">wanted_clock_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;ROS_160929_STEP.TSC&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        	<span class="c1"># TODO: Automate the clock file name retrieval</span>

        <span class="n">clock_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_clock_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_clock_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">clock_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;sclk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clock_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No sclk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> Frame Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_frame_files</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/fk/&quot;</span>
        <span class="p">)</span>
        <span class="n">wanted_frame_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;ROS_V38.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ROS_DSK_SURFACES_V03.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ROS_CGS_AUX_V01.TF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ROS_LUTETIA_RSOC_V03.TF&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">frame_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_kernels</span><span class="p">(</span>
            <span class="n">input_mission</span><span class="o">=</span><span class="n">input_mission</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url_frame_files</span><span class="p">,</span>
            <span class="n">wanted_files</span><span class="o">=</span><span class="n">wanted_frame_files</span><span class="p">,</span>
            <span class="n">custom_output</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">frame_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;fk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Spk files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> SPK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_spk_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/spk/&quot;</span>
        <span class="p">]</span>

        <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># TODO: check which files to download</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_spk_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_spk_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_spk_file</span> <span class="ow">in</span> <span class="n">url_spk_files</span><span class="p">:</span>
                <span class="n">spk_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_spk_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">spk_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;spk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spk_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

            <span class="c1"># Orientation files</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;===========================================================================================================&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download </span><span class="si">{</span><span class="n">input_mission</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> CK Kernels:&quot;</span><span class="p">)</span>
        <span class="n">url_ck_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;https://spiftp.esac.esa.int/data/SPICE/ROSETTA/kernels/ck/&quot;</span>
        <span class="p">]</span>

        <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_ck_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                <span class="n">input_mission</span><span class="p">,</span>
                <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url_ck_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">url_ck_file</span> <span class="ow">in</span> <span class="n">url_ck_files</span><span class="p">:</span>
                <span class="n">ck_files_to_load</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_download_url_files_time_interval</span><span class="p">(</span>
                        <span class="n">input_mission</span><span class="p">,</span>
                        <span class="n">local_path</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span>
                        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                        <span class="n">url</span><span class="o">=</span><span class="n">url_ck_file</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">ck_files_to_load</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">[</span><span class="s2">&quot;ck&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ck_files_to_load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No spk files to download this time.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;-----------------------------------------------------------------------------------------------------------&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;All requested, relevant and previously non-existing MEX files have been now downloaded. Enjoy!&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_files_to_load</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancillary_files_to_load</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1">#########################################################################################################</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_url_ro_radio_science_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_date_ro</span><span class="p">,</span> <span class="n">end_date_ro</span><span class="p">,</span> <span class="n">radio_observation_type</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>

        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://archives.esac.esa.int/psa/ftp/INTERNATIONAL-ROSETTA-MISSION/RSI/RO-C-RSI-1-2-3-EXT3-1881-V1.0/AAREADME.TXT&quot;</span>
        <span class="n">radio_science_base_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://archives.esac.esa.int/psa/ftp/INTERNATIONAL-ROSETTA-MISSION/RSI/&quot;</span>
        <span class="p">)</span>


        <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ro_rsi_volume_ID_mapping</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_ro_mission_phase_designation</span><span class="p">(</span><span class="n">mapping_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">radio_observation_type</span><span class="p">:</span>
            <span class="n">mapping_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_mapping_dict_by_radio_observation_type</span><span class="p">(</span>
                <span class="n">mapping_dict</span><span class="p">,</span>
                <span class="n">radio_observation_type</span><span class="p">,</span>
                <span class="n">start_date_ro</span><span class="p">,</span>
                <span class="n">end_date_ro</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">rsi_volume_ID_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ro_rsi_volume_ID</span><span class="p">(</span>
            <span class="n">start_date_ro</span><span class="p">,</span> <span class="n">end_date_ro</span><span class="p">,</span> <span class="n">mapping_dict</span>
            <span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ro_rsi_volume_ID</span><span class="p">(</span><span class="n">start_date_ro</span><span class="p">,</span> <span class="n">end_date_ro</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">):</span>
            <span class="c1"># Here, rsi_volume_ID_list is assumed to be a list of keys (rsi_volume_id strings)</span>
            <span class="k">for</span> <span class="n">rsi_id</span> <span class="ow">in</span> <span class="n">rsi_volume_ID_list</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Get the first entry for the current rsi_volume_id from the mapping dictionary</span>
                    <span class="n">entry</span> <span class="o">=</span> <span class="n">mapping_dict</span><span class="p">[</span><span class="n">rsi_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># Extract target and mission phase abbreviation (Abbn)</span>

                    <span class="n">target</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">abbn</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;abbn&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">rsi_volume_ID_num</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rsi_volume_id_num&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


                    <span class="c1"># Construct the URL using the target, Abbn and rsi_volume_id.</span>
                    <span class="c1"># The URL pattern:</span>
                    <span class="c1"># &quot;https://archives.esac.esa.int/psa/ftp/INTERNATIONAL-ROSETTA-MISSION/RSI/RO-X-RSI-1-2-3-PPP-RRRR-V1.0/&quot;</span>
                    <span class="n">volume_ID_url</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">radio_science_base_url</span> <span class="o">+</span>
                        <span class="s2">&quot;RO-&quot;</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">&quot;-RSI-1-2-3-&quot;</span> <span class="o">+</span> <span class="n">abbn</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="n">rsi_volume_ID_num</span> <span class="o">+</span> <span class="s2">&quot;-V1.0/&quot;</span>
                    <span class="p">)</span>
                    <span class="c1"># Check if URL exists with a HEAD request</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">volume_ID_url</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL Exists: </span><span class="si">{</span><span class="n">volume_ID_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">volume_ID_url</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL does not exist: </span><span class="si">{</span><span class="n">volume_ID_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error occurred for rsi_volume_id </span><span class="si">{</span><span class="n">rsi_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_science_urls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No url available for RO radio science files. Please check the mapping.&quot;</span>
            <span class="p">)</span>

<span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_ro_rsi_volume_ID">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_ro_rsi_volume_ID">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ro_rsi_volume_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a start_date and end_date, iterate over the mapping_dict (which is keyed by rsi_volume_id)</span>
<span class="sd">        and return a list of rsi_volume_id values whose associated record&#39;s start_date_utc falls within the interval.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            start_date (datetime): The start of the input date interval.</span>
<span class="sd">            end_date (datetime): The end of the input date interval.</span>
<span class="sd">            mapping_dict (dict): A dictionary where the keys are rsi_volume_id strings and the values</span>
<span class="sd">                                are lists of dictionaries. Each dictionary includes at least:</span>
<span class="sd">                                - &quot;rsi_volume_id&quot;: the RSI volume ID</span>
<span class="sd">                                - &quot;start_date_utc&quot;: a datetime object representing the record&#39;s start date.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of rsi_volume_id strings that fall within the [start_date, end_date] interval.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no matching rsi_volume_id is found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rsi_volume_id_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Iterate over each key-value pair. In this dictionary, keys are rsi_volume_id.</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Ensure items is always a list.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">record_date</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">record_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Log or skip entries without a valid date.</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Missing start_date_utc in item: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="c1"># Check if the record_date falls within the input interval.</span>
                    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">record_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
                        <span class="n">rsi_volume_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If no valid volume IDs are found, raise an error.</span>
        <span class="k">if</span> <span class="n">rsi_volume_id_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rsi_volume_id_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No RSI Volume_ID found associated with input interval: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>




<span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.add_ro_mission_phase_designation">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.add_ro_mission_phase_designation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_ro_mission_phase_designation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates mapping_dict entries by adding an &#39;Abbn&#39; field (mission phase abbreviation)</span>
<span class="sd">        based on each entry&#39;s start_date_utc.</span>
<span class="sd">        The function caches the mapping from unique start dates to their mission phase.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            mapping_dict (dict): Dictionary where keys are rsi_volume_id and values are lists</span>
<span class="sd">                                of dictionaries, each having a &#39;start_date_utc&#39; datetime object.</span>

<span class="sd">        Returns:</span>
<span class="sd">        dict: The updated mapping_dict with two additional keys for each entry:</span>
<span class="sd">              - &quot;Abbn&quot;: the mission phase abbreviation.</span>
<span class="sd">              - &quot;target&quot;: the target designation (&quot;X&quot; for non-target-specific or pre-comet phases,</span>
<span class="sd">                          &quot;C&quot; for comet, &quot;M&quot; for Mars, &quot;A&quot; for asteroid flybys).</span>
<span class="sd">    &quot;&quot;&quot;</span>


        <span class="c1"># Define the mission phase date ranges for the Rosetta mission, in which RSI experiments were conducted.</span>
        <span class="n">mission_phases</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CVP1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2004-03-05&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2004-06-06&#39;</span><span class="p">},</span>
            <span class="s1">&#39;CVP2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2004-09-06&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2004-10-16&#39;</span><span class="p">},</span>
            <span class="s1">&#39;CR2&#39;</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2005-04-05&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2006-07-28&#39;</span><span class="p">},</span>
            <span class="s1">&#39;MARS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2006-07-29&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2007-05-28&#39;</span><span class="p">},</span>
            <span class="s1">&#39;EAR2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2007-09-13&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2008-01-27&#39;</span><span class="p">},</span>
            <span class="s1">&#39;CR4B&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2008-10-06&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2009-09-13&#39;</span><span class="p">},</span>
            <span class="s1">&#39;AST2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2010-05-17&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2010-09-03&#39;</span><span class="p">},</span>
            <span class="s1">&#39;PRL&#39;</span><span class="p">:</span>  <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2014-01-21&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2014-11-19&#39;</span><span class="p">},</span>
            <span class="s1">&#39;ESC1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2014-11-20&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-03-10&#39;</span><span class="p">},</span>
            <span class="s1">&#39;ESC2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-03-11&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-06-30&#39;</span><span class="p">},</span>
            <span class="s1">&#39;ESC3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-07-01&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-10-21&#39;</span><span class="p">},</span>
            <span class="s1">&#39;ESC4&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-10-22&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2015-12-31&#39;</span><span class="p">},</span>
            <span class="s1">&#39;EXT1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-01-01&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-04-05&#39;</span><span class="p">},</span>
            <span class="s1">&#39;EXT2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-04-06&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-06-30&#39;</span><span class="p">},</span>
            <span class="s1">&#39;EXT3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-07-01&#39;</span><span class="p">,</span>     <span class="s1">&#39;end&#39;</span><span class="p">:</span> <span class="s1">&#39;2016-09-30&#39;</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">mission_phases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Convert the start date and end date string using the provided method.</span>
            <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;start_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;end_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

        <span class="c1"># Cache mapping: map each unique entry start date (as date object) to its phase abbreviation.</span>
        <span class="n">date_to_phase</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">unique_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">unique_dates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">unique_dates</span><span class="p">:</span>
            <span class="n">found_phase</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">mission_phases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">start_dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;start_dt&#39;</span><span class="p">]</span>
                <span class="n">end_dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;end_dt&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">start_dt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">start_dt</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">end_dt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">end_dt</span><span class="p">)):</span>
                    <span class="n">found_phase</span> <span class="o">=</span> <span class="n">phase</span>
                    <span class="k">break</span>
            <span class="n">date_to_phase</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">found_phase</span>



        <span class="c1"># Define a mapping from mission phase abbreviation to target designation.</span>
        <span class="c1"># (X: early/launch phases, C: comet target, M: Mars, A: asteroid)</span>
        <span class="n">phase_to_target</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CVP1&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CVP2&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CR2&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MARS&#39;</span><span class="p">:</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EAR2&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AST2&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CR4B&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
            <span class="c1"># After the flybys, the mission target becomes the comet (67P)</span>
            <span class="s1">&#39;PRL&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ESC1&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ESC2&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ESC3&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ESC4&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EXT1&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EXT2&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EXT3&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
        <span class="p">}</span>


        <span class="c1"># Update each entry in mapping_dict, adding both the mission phase abbreviation (&quot;abbn&quot;)</span>
        <span class="c1"># and the corresponding target designation (&quot;target&quot;).</span>
        <span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date_utc&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">phase</span> <span class="o">=</span> <span class="n">date_to_phase</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;abbn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase_to_target</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;abbn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">mapping_dict</span></div>



<span class="c1">#########################################################################################################</span>

<div class="viewcode-block" id="LoadPDS.get_ro_rsi_volume_ID_mapping">
<a class="viewcode-back" href="../../../mission_data_downloader.html#tudatpy.data.mission_data_downloader.LoadPDS.get_ro_rsi_volume_ID_mapping">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ro_rsi_volume_ID_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description:</span>
<span class="sd">        Fetches data from a given URL and extracts volume ID, date range, and observation type</span>
<span class="sd">        for the Rosetta mission. The data is returned as a dictionary mapping date intervals</span>
<span class="sd">        to volume IDs and metadata.</span>

<span class="sd">        Inputs:</span>
<span class="sd">            - url (`str`): The URL from which to fetch the data (plain text format).</span>

<span class="sd">        Outputs:</span>
<span class="sd">            - `mapping_dict` (`dict`): A dictionary where keys are &quot;rsi_volume_id&quot;,</span>
<span class="sd">              and values are dictionaries with:</span>
<span class="sd">                - `rsi_volume_id` (`str`): The rsi volume ID.</span>
<span class="sd">                - `volume_id` (`str`): The volume ID.</span>
<span class="sd">                - `start_date_file` (`str`): Start date (YYYY-MM-DD).</span>
<span class="sd">                - `start_date_utc` (`datetime`): Start date in UTC format.</span>
<span class="sd">                - `radio_observation_type` (`str`): Type of observation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Step 1: Fetch content from the URL</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Check for request errors</span>
        <span class="n">aareadme_text</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># Step 2: Parse content using regex to extract the table entries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^\s*(RORSI_\d</span><span class="si">{4}</span><span class="s2">)\s+(RORSI_\d</span><span class="si">{4}</span><span class="s2">)\s+(\d</span><span class="si">{4}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">-\d</span><span class="si">{2}</span><span class="s2">)\s+(.+?)\s*$&quot;</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Step 3: Find all matches and populate the dictionary</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">aareadme_text</span><span class="p">):</span>
            <span class="n">full_rsi_volume_id</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># e.g. &quot;RORSI_0001&quot;</span>
            <span class="c1"># Remove the &quot;RORSI_&quot; prefix to keep only the numeric part.</span>
            <span class="n">rsi_volume_id_num</span> <span class="o">=</span> <span class="n">full_rsi_volume_id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;RORSI_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">volume_id</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">start_date_file</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">start_date_utc</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">format_string_to_datetime</span><span class="p">(</span><span class="n">start_date_file</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">start_date_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">radio_observation_type</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="c1"># Add entry to dictionary</span>
            <span class="k">if</span> <span class="n">full_rsi_volume_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">[</span><span class="n">full_rsi_volume_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[]</span>
                <span class="p">)</span>  <span class="c1"># Initialize as a list</span>

            <span class="c1"># Append the current entry to the list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span><span class="p">[</span><span class="n">full_rsi_volume_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;rsi_volume_id_num&quot;</span><span class="p">:</span> <span class="n">rsi_volume_id_num</span><span class="p">,</span>
                    <span class="s2">&quot;volume_id&quot;</span><span class="p">:</span> <span class="n">volume_id</span><span class="p">,</span>
                    <span class="s2">&quot;start_date_file&quot;</span><span class="p">:</span> <span class="n">start_date_file</span><span class="p">,</span>
                    <span class="s2">&quot;start_date_utc&quot;</span><span class="p">:</span> <span class="n">start_date_utc</span><span class="p">,</span>
                    <span class="s2">&quot;radio_observation_type&quot;</span><span class="p">:</span> <span class="n">radio_observation_type</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_dict</span></div>
</div>



<span class="c1">########################################################################################################################################</span>
<span class="c1">########################################## END OF ROSETTA SECTION ####################################################################</span>
<span class="c1">########################################################################################################################################</span>


</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Tudat Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>