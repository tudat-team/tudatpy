<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>tudatpy.data.mpc.mpc - TudatPy API Reference</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/style.css?v=ab9fdd52" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     Have questions or feedback? See the <a href='https://docs.tudat.space/en/latest/index_user_guide.html'>User Guide</a> or let us know in our <a href='https://github.com/orgs/tudat-team/discussions?discussions_q='>Github Discussion forum</a>! 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">TudatPy API Reference</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">TudatPy API Reference</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../astro.html"><code class="docutils literal notranslate"><span class="pre">astro</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of astro</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../frame_conversion.html"><code class="docutils literal notranslate"><span class="pre">frame_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../element_conversion.html"><code class="docutils literal notranslate"><span class="pre">element_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../time_conversion.html"><code class="docutils literal notranslate"><span class="pre">time_conversion</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../two_body_dynamics.html"><code class="docutils literal notranslate"><span class="pre">two_body_dynamics</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../polyhedron_utilities.html"><code class="docutils literal notranslate"><span class="pre">polyhedron_utilities</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../gravitation.html"><code class="docutils literal notranslate"><span class="pre">gravitation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fundamentals.html"><code class="docutils literal notranslate"><span class="pre">fundamentals</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../constants.html"><code class="docutils literal notranslate"><span class="pre">constants</span></code></a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../data.html"><code class="docutils literal notranslate"><span class="pre">data</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of data</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../horizons.html"><code class="docutils literal notranslate"><span class="pre">horizons</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mpc.html"><code class="docutils literal notranslate"><span class="pre">mpc</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../sbdb.html"><code class="docutils literal notranslate"><span class="pre">sbdb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../mission_data_downloader.html"><code class="docutils literal notranslate"><span class="pre">mission_data_downloader</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../exceptions.html"><code class="docutils literal notranslate"><span class="pre">exceptions</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of exceptions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../spice_exceptions.html"><code class="docutils literal notranslate"><span class="pre">spice_exceptions</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../interface.html"><code class="docutils literal notranslate"><span class="pre">interface</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of interface</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../spice.html"><code class="docutils literal notranslate"><span class="pre">spice</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../math.html"><code class="docutils literal notranslate"><span class="pre">math</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of math</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../interpolators.html"><code class="docutils literal notranslate"><span class="pre">interpolators</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../root_finders.html"><code class="docutils literal notranslate"><span class="pre">root_finders</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../numerical_simulation.html"><code class="docutils literal notranslate"><span class="pre">numerical_simulation</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of numerical_simulation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../estimation_setup.html"><code class="docutils literal notranslate"><span class="pre">estimation_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of estimation_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../observation.html"><code class="docutils literal notranslate"><span class="pre">observation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../parameter.html"><code class="docutils literal notranslate"><span class="pre">parameter</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../environment_setup.html"><code class="docutils literal notranslate"><span class="pre">environment_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of environment_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../aerodynamic_coefficients.html"><code class="docutils literal notranslate"><span class="pre">aerodynamic_coefficients</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../atmosphere.html"><code class="docutils literal notranslate"><span class="pre">atmosphere</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ephemeris.html"><code class="docutils literal notranslate"><span class="pre">ephemeris</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../gravity_field.html"><code class="docutils literal notranslate"><span class="pre">gravity_field</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../gravity_field_variation.html"><code class="docutils literal notranslate"><span class="pre">gravity_field_variation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../ground_station.html"><code class="docutils literal notranslate"><span class="pre">ground_station</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../radiation_pressure.html"><code class="docutils literal notranslate"><span class="pre">radiation_pressure</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rigid_body.html"><code class="docutils literal notranslate"><span class="pre">rigid_body</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../rotation_model.html"><code class="docutils literal notranslate"><span class="pre">rotation_model</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../shape.html"><code class="docutils literal notranslate"><span class="pre">shape</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../shape_deformation.html"><code class="docutils literal notranslate"><span class="pre">shape_deformation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../vehicle_systems.html"><code class="docutils literal notranslate"><span class="pre">vehicle_systems</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../../propagation_setup.html"><code class="docutils literal notranslate"><span class="pre">propagation_setup</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of propagation_setup</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../acceleration.html"><code class="docutils literal notranslate"><span class="pre">acceleration</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../dependent_variable.html"><code class="docutils literal notranslate"><span class="pre">dependent_variable</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../integrator.html"><code class="docutils literal notranslate"><span class="pre">integrator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../mass_rate.html"><code class="docutils literal notranslate"><span class="pre">mass_rate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../propagator.html"><code class="docutils literal notranslate"><span class="pre">propagator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../torque.html"><code class="docutils literal notranslate"><span class="pre">torque</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../thrust.html"><code class="docutils literal notranslate"><span class="pre">thrust</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../estimation.html"><code class="docutils literal notranslate"><span class="pre">estimation</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../environment.html"><code class="docutils literal notranslate"><span class="pre">environment</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../propagation.html"><code class="docutils literal notranslate"><span class="pre">propagation</span></code></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../trajectory_design.html"><code class="docutils literal notranslate"><span class="pre">trajectory_design</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of trajectory_design</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../transfer_trajectory.html"><code class="docutils literal notranslate"><span class="pre">transfer_trajectory</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../shape_based_thrust.html"><code class="docutils literal notranslate"><span class="pre">shape_based_thrust</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plotting.html"><code class="docutils literal notranslate"><span class="pre">plotting</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../util.html"><code class="docutils literal notranslate"><span class="pre">util</span></code></a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for tudatpy.data.mpc.mpc</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.numerical_simulation</span><span class="w"> </span><span class="kn">import</span> <span class="n">environment_setup</span>  <span class="c1"># type:ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.numerical_simulation</span><span class="w"> </span><span class="kn">import</span> <span class="n">estimation</span><span class="p">,</span> <span class="n">environment</span>  <span class="c1"># type:ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.numerical_simulation.estimation_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">observation</span>  <span class="c1"># type:ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.numerical_simulation.environment_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_gravity_field_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tudatpy.numerical_simulation.environment_setup.gravity_field</span><span class="w"> </span><span class="kn">import</span> <span class="n">central_sbdb</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mpc</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy_healpix</span><span class="w"> </span><span class="kn">import</span> <span class="n">HEALPix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>


<span class="n">BIAS_LOWRES_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
    <span class="s2">&quot;.tudat&quot;</span><span class="p">,</span>
    <span class="s2">&quot;resource&quot;</span><span class="p">,</span>
    <span class="s2">&quot;star_catalog_biases&quot;</span><span class="p">,</span>
    <span class="s2">&quot;debias_2018&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bias.dat&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Described here:</span>
<span class="c1"># https://www.minorplanetcenter.net/iau/info/CatalogueCodes.html</span>
<span class="n">DEFAULT_CATALOG_FLAGS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;g&quot;</span><span class="p">,</span>
    <span class="s2">&quot;i&quot;</span><span class="p">,</span>
    <span class="s2">&quot;j&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;m&quot;</span><span class="p">,</span>
    <span class="s2">&quot;n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;t&quot;</span><span class="p">,</span>
    <span class="s2">&quot;u&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="s2">&quot;w&quot;</span><span class="p">,</span>
    <span class="s2">&quot;L&quot;</span><span class="p">,</span>
    <span class="s2">&quot;N&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;R&quot;</span><span class="p">,</span>
    <span class="s2">&quot;S&quot;</span><span class="p">,</span>
    <span class="s2">&quot;U&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_bias_file</span><span class="p">(</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">Nside</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">catalog_flags</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">DEFAULT_CATALOG_FLAGS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a healpix star catalog debias file and processes it into a dataframe. Automatically retrieves NSIDE parameter.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        Filepath of debias file.</span>
<span class="sd">    Nside : Union[None, int], optional</span>
<span class="sd">        NSIDE value, to be left None in most cases as this is retrieved automatically by the function, by default None</span>
<span class="sd">    catalog_flags : Union[None, list], optional</span>
<span class="sd">        list of catalog flags, should be left default in most cases, by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[pd.DataFrame, int]</span>
<span class="sd">        Dataframe with biases in multiindex format ((Npix x Ncat) x Nvals), the numpix value</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If NSIDE cannot be retrieved automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># auto retrieve NSIDE</span>
    <span class="k">if</span> <span class="n">Nside</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;! NSIDE=\s*(\d+)&quot;</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="n">Nside</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">Nside</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Could not automatically retrieve NSIDE, please provide it as a parameter&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">catalog_flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">catalog_flags</span> <span class="o">=</span> <span class="n">DEFAULT_CATALOG_FLAGS</span>
    <span class="n">catalog_flags</span> <span class="o">=</span> <span class="n">catalog_flags</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">]</span>

    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="s2">&quot;PMRA&quot;</span><span class="p">,</span> <span class="s2">&quot;PMDEC&quot;</span><span class="p">]</span>

    <span class="c1"># create a multi_index, this effectively creates a df with 3 dimensions. [row, catalog, value]</span>
    <span class="n">m_index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
        <span class="p">[</span><span class="n">catalog_flags</span><span class="p">,</span> <span class="n">values</span><span class="p">],</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;catalog&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">bias_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">filepath</span><span class="p">,</span>
        <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
        <span class="n">skiprows</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
        <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># we add a set of &#39;unknown&#39; columns to speed up assignment later</span>
    <span class="n">len_df</span> <span class="o">=</span> <span class="n">bias_dataframe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">unknown_columns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">len_df</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">bias_dataframe</span><span class="p">[[</span><span class="s2">&quot;aa&quot;</span><span class="p">,</span> <span class="s2">&quot;bb&quot;</span><span class="p">,</span> <span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;dd&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">unknown_columns</span>

    <span class="c1"># apply the multi_index</span>
    <span class="n">bias_dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">m_index</span>
    <span class="c1"># stack it so it goes from a Npix x (Ncat x Nvals) to (Npix x Ncat) x Nvals shape</span>
    <span class="n">bias_dataframe</span> <span class="o">=</span> <span class="n">bias_dataframe</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bias_dataframe</span><span class="p">,</span> <span class="n">Nside</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_biases_EFCC18</span><span class="p">(</span>
    <span class="n">RA</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">DEC</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">epochJ2000secondsTDB</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">bias_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">BIAS_LOWRES_FILE</span><span class="p">,</span>
    <span class="n">Nside</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">catalog_flags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_CATALOG_FLAGS</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate and return star catalog bias values as described in:</span>
<span class="sd">    &quot;Star catalog position and proper motion corrections in asteroid astrometry II: The Gaia era&quot; by Eggl et al. (2018).</span>
<span class="sd">    Uses the regular bias set by default. A high res version of the bias map can be retrieved from the paper.</span>
<span class="sd">    This can then be selected using the bias_file paramater.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    RA : Union[float, np.ndarray, list]</span>
<span class="sd">        Right Ascension value in radians</span>
<span class="sd">    DEC : Union[float, np.ndarray, list]</span>
<span class="sd">        Declination value in radians</span>
<span class="sd">    epochJ2000secondsTDB : Union[float, np.ndarray, list]</span>
<span class="sd">        Time in seconds since J2000 TDB.</span>
<span class="sd">    catalog : Union[str, np.ndarray, list]</span>
<span class="sd">        Star Catalog code as described by MPC: https://www.minorplanetcenter.net/iau/info/CatalogueCodes.html</span>
<span class="sd">    bias_file : Tuple[str, None], optional</span>
<span class="sd">        Optional bias file location, used to load in alternative debias coefficients. By default coefficients are retrieved from Tudat resources, by default None</span>
<span class="sd">    Nside : Tuple[int, None], optional</span>
<span class="sd">        Optional Nside value, should be left None in most cases, by default None</span>
<span class="sd">    catalog_flags : Tuple[List[str], None], optional</span>
<span class="sd">        List of catalog values to use, should be left None in most cases, by default None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        Right Ascencion Corrections, Declination corrections</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If all mandatory inputs are not matching in size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">bias_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bias_file</span> <span class="o">=</span> <span class="n">BIAS_LOWRES_FILE</span>

    <span class="c1"># transform input to numpy arrays</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">RA</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">RA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">RA</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DEC</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">DEC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">DEC</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epochJ2000secondsTDB</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">epochJ2000secondsTDB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">epochJ2000secondsTDB</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">catalog</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RA</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">DEC</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">epochJ2000secondsTDB</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All inputs must have same size&quot;</span><span class="p">)</span>

    <span class="c1"># load bias file</span>
    <span class="c1"># index matches the pixels</span>
    <span class="c1"># this is effectively a 3d table with axes: (pixel, star catalog), value) using pandas multiindex</span>
    <span class="n">bias_df</span><span class="p">,</span> <span class="n">nside</span> <span class="o">=</span> <span class="n">load_bias_file</span><span class="p">(</span>
        <span class="n">filepath</span><span class="o">=</span><span class="n">bias_file</span><span class="p">,</span> <span class="n">Nside</span><span class="o">=</span><span class="n">Nside</span><span class="p">,</span> <span class="n">catalog_flags</span><span class="o">=</span><span class="n">catalog_flags</span>
    <span class="p">)</span>

    <span class="c1"># find nearest tile using HEALPix Algorithm and get indices</span>
    <span class="c1"># ideally nside should be retrieved from the load_bias_file function</span>
    <span class="n">hp_obj</span> <span class="o">=</span> <span class="n">HEALPix</span><span class="p">(</span><span class="n">nside</span><span class="o">=</span><span class="n">nside</span><span class="p">)</span>

    <span class="n">pixels</span> <span class="o">=</span> <span class="n">hp_obj</span><span class="o">.</span><span class="n">lonlat_to_healpix</span><span class="p">(</span>
        <span class="n">Quantity</span><span class="p">(</span><span class="n">RA</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="p">),</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">DEC</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># retrieve bias values from bias file using indices</span>
    <span class="c1"># result is N x 4 biases for the correct star catalog</span>
    <span class="n">all_catalog_ids</span> <span class="o">=</span> <span class="n">bias_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="c1"># this changes all ids not present in the bias file to unknown, resulting in zero bias</span>
    <span class="n">catalog</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;unknown&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">cat</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_catalog_ids</span><span class="p">)</span> <span class="k">else</span> <span class="n">cat</span> <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">catalog</span><span class="p">]</span>

    <span class="c1"># create combinations of pixel id and catalog then retrieve biases</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">[(</span><span class="n">pix</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="n">pix</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pixels</span><span class="p">,</span> <span class="n">catalog</span><span class="p">)]</span>
    <span class="n">biases</span> <span class="o">=</span> <span class="n">bias_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">targets</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="s2">&quot;PMRA&quot;</span><span class="p">,</span> <span class="s2">&quot;PMDEC&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># transform the values based on the paper, time to JD TT</span>
    <span class="n">J2000_jd</span> <span class="o">=</span> <span class="mf">2451545.0</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="p">(</span><span class="n">epochJ2000secondsTDB</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)</span> <span class="o">+</span> <span class="n">J2000_jd</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;tdb&quot;</span><span class="p">)</span>

    <span class="c1"># this was taken from find_orb -&gt; bias.cpp</span>
    <span class="c1"># https://github.com/Bill-Gray/find_orb/blob/master/bias.cpp#L213</span>
    <span class="n">epochs_years</span> <span class="o">=</span> <span class="p">(</span><span class="n">epochs</span><span class="o">.</span><span class="n">tt</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">J2000_jd</span><span class="p">)</span> <span class="o">/</span> <span class="mf">365.25</span>

    <span class="c1"># from the bias file readme.txt:</span>
    <span class="n">RA_correction</span> <span class="o">=</span> <span class="n">biases</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">epochs_years</span> <span class="o">*</span> <span class="p">(</span><span class="n">biases</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">RA_correction</span> <span class="o">=</span> <span class="n">RA_correction</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">DEC</span><span class="p">)</span>  <span class="c1"># DEC here in radians because of cosine</span>
    <span class="n">DEC_correction</span> <span class="o">=</span> <span class="n">biases</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">epochs_years</span> <span class="o">*</span> <span class="p">(</span><span class="n">biases</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c1"># convert from arcsec to radians</span>
    <span class="n">RA_correction</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">RA_correction</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">DEC_correction</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">DEC_correction</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="k">return</span> <span class="n">RA_correction</span><span class="p">,</span> <span class="n">DEC_correction</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_weights_VFCC17</span><span class="p">(</span>
    <span class="n">MPC_codes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">epochUTC</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">observation_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">observatory</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">star_catalog</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mpc_table</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_full_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves observation weights using the weighting scheme presented in</span>
<span class="sd">    &quot;Statistical analysis of astrometric errors for the most productive</span>
<span class="sd">    asteroid surveys&quot; by Veres et al. (2017). Input may be provided using</span>
<span class="sd">    either a full MPC table (e.g. from BatchMPC) or using the individual</span>
<span class="sd">    variables.</span>

<span class="sd">    Observation types: &quot;x&quot;, &quot;X&quot;, &quot;V&quot;, &quot;v&quot;, &quot;W&quot;, &quot;w&quot;, &quot;R&quot;, &quot;r&quot;, &quot;Q&quot;, &quot;q&quot;, &quot;O&quot;,</span>
<span class="sd">    are not described by the paper and receive a placeholder weight of 1/100</span>
<span class="sd">    if provided.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    MPC_codes : Union[pd.Series, list, np.ndarray, None], optional</span>
<span class="sd">        Iterable with the MPC target codes, e.g. 433 for Eros. Size must match</span>
<span class="sd">        other iterables, by default None</span>
<span class="sd">    epochUTC : Union[pd.Series, list, np.ndarray, None], optional</span>
<span class="sd">        Iterable with UTC times. Size must match other iterables, by default None</span>
<span class="sd">    observation_type : Union[pd.Series, list, np.ndarray, None], optional</span>
<span class="sd">        Iterable with the observation types in MPC format.</span>
<span class="sd">        See the NOTE2 section of the MPC format description for the exact encoding:</span>
<span class="sd">        https://minorplanetcenter.net/iau/info/OpticalObs.html.</span>
<span class="sd">        Size must match other iterables, by default None</span>
<span class="sd">    observatory : Union[pd.Series, list, np.ndarray, None], optional</span>
<span class="sd">        Iterable with the MPC target codes, e.g. 433 for Eros.</span>
<span class="sd">        Size must match other iterables, by default None</span>
<span class="sd">    star_catalog : Union[pd.Series, list, np.ndarray, None], optional</span>
<span class="sd">        Iterable with the star catalog codes.</span>
<span class="sd">        See the MPC catalog codes page for the exact encoding:</span>
<span class="sd">        https://www.minorplanetcenter.net/iau/info/CatalogueCodes.html.</span>
<span class="sd">        Size must match other iterables, by default None</span>
<span class="sd">    mpc_table : Union[pd.DataFrame, None], optional</span>
<span class="sd">        Table retrieved by calling the mpc.BatchMPC.table property.</span>
<span class="sd">        Set None when using iterable input.</span>
<span class="sd">        Set others None when using table, by default None</span>
<span class="sd">    return_full_table : bool, optional</span>
<span class="sd">        Return the table with all intermediate calculations if True,</span>
<span class="sd">        return a numpy array if False, by default False</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        If `return_full_table` is False, numpy array with weights with same size as input.</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        If `return_full_table` is True, pandas table with all intermediate calculations.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        MPC_codes, epochUTC, observation_type, observatory and star_catalog must all</span>
<span class="sd">        be not None and the same size. mpc_table must be None.</span>
<span class="sd">        If table input is used, the remaining input parameters must be done.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Input handling</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">mpc_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">epochUTC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">observation_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">observatory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">star_catalog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">epochUTC</span><span class="p">)</span>
            <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_type</span><span class="p">)</span>
            <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">observatory</span><span class="p">)</span>
            <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">star_catalog</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All inputs must have same size&quot;</span><span class="p">)</span>

        <span class="n">table_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">MPC_codes</span><span class="p">,</span>
            <span class="s2">&quot;epochUTC&quot;</span><span class="p">:</span> <span class="n">epochUTC</span><span class="p">,</span>
            <span class="s2">&quot;note2&quot;</span><span class="p">:</span> <span class="n">observation_type</span><span class="p">,</span>
            <span class="s2">&quot;observatory&quot;</span><span class="p">:</span> <span class="n">observatory</span><span class="p">,</span>
            <span class="s2">&quot;catalog&quot;</span><span class="p">:</span> <span class="n">star_catalog</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">table_dict</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">mpc_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">epochUTC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">observation_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">observatory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">star_catalog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">mpc_table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Must provide either parameters: `epochUTC`, `observation_type`, `observatory` and `star_catalog` OR `mpc_table`.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># create col for Julian Day and the inverted weight</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">epochJD</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epochUTC</span><span class="p">)</span><span class="o">.</span><span class="n">jd1</span> <span class="o">+</span> <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epochUTC</span><span class="p">)</span><span class="o">.</span><span class="n">jd2</span><span class="p">)</span>
    <span class="c1"># NOTE 1000 is a placeholder. The following observation types are not processed and receive the placeholder value:</span>
    <span class="c1"># first_discoveries = [&quot;x&quot;, &quot;X&quot;], roaming = [&quot;V&quot;, &quot;v&quot;, &quot;W&quot;, &quot;w&quot;], radar = [&quot;R&quot;, &quot;r&quot;, &quot;Q&quot;, &quot;q&quot;], offset = [&quot;O&quot;]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">inv_w</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># get an approximate timezone based on the observatory code&#39;s longitude</span>
    <span class="n">observatories_table</span> <span class="o">=</span> <span class="n">MPC</span><span class="o">.</span><span class="n">get_observatory_codes</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="n">observatories_table</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">observatories_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">lon_wrapping</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Longitude</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">approx_tz</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">lon_wrapping</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">))</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">jd_tz</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lon_wrapping</span> <span class="o">/</span> <span class="mi">360</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="s2">&quot;approx_tz&quot;</span><span class="p">,</span> <span class="s2">&quot;jd_tz&quot;</span><span class="p">]]</span>
    <span class="p">)</span>

    <span class="c1"># the reset_index + set_index is a cheeky way to keep the original table index</span>
    <span class="c1"># this prevents mismatches when adding weights to the tables in BatchMPC.to_tudat()</span>
    <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">observatories_table</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;observatory&quot;</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># create column that modifies the JD with an approximate timezone.</span>
    <span class="c1"># the time JD.50 will then be the approximate midnight at that timezone.</span>
    <span class="c1"># if we then take the int, we can group by this number to get all observations that night.</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">epochJD_tz_int</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">jd_tz</span><span class="p">))</span>
    <span class="c1"># table = table.assign(epochJD_tz_int2=lambda x: np.round(x.epochJD + x.jd_tz, 2))</span>

    <span class="c1"># Below are the weights applied as described per table in:</span>
    <span class="c1"># https://www.sciencedirect.com/science/article/pii/S0019103517301987</span>

    <span class="c1"># NON-CCD</span>
    <span class="c1"># ###################</span>
    <span class="c1"># TABLE 5: Non-CCD residuals</span>
    <span class="c1"># Conditions for Table 5</span>
    <span class="c1"># 1890-1-1 and 1950-1-1</span>
    <span class="n">pre_1890</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&lt;=</span> <span class="mf">2411368.0</span>
    <span class="n">between_1890_1950</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&gt;</span> <span class="mf">2411368.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&lt;=</span> <span class="mf">2433282.0</span><span class="p">)</span>
    <span class="n">after_1950</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&gt;</span> <span class="mf">2433282.0</span>

    <span class="n">photographic</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>
    <span class="n">occultations</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span>
    <span class="n">hipparcos</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;H&quot;</span>
    <span class="n">transit_circle</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span>
    <span class="n">micrometer</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span>
    <span class="n">satellite</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">])</span>
    <span class="n">multinormal_place</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span>

    <span class="c1"># Apply Table 5</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">photographic</span> <span class="o">&amp;</span> <span class="n">pre_1890</span><span class="p">),</span> <span class="mf">10.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">photographic</span> <span class="o">&amp;</span> <span class="n">between_1890_1950</span><span class="p">),</span> <span class="mf">5.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">photographic</span> <span class="o">&amp;</span> <span class="n">after_1950</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">occultations</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">hipparcos</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">transit_circle</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">encoder</span><span class="p">),</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">micrometer</span><span class="p">),</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">satellite</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">multinormal_place</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="c1"># ###################</span>

    <span class="c1"># CCD</span>
    <span class="c1"># ###################</span>
    <span class="c1"># TABLE 3: astroid observers</span>
    <span class="c1"># Table 3 conditions:</span>
    <span class="c1"># NOTE for now CCD will receive the same base weighting as CCD.</span>
    <span class="c1"># CMOS sensors for astronomy is a new development.</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">])</span>
    <span class="n">cmos</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">note2</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;B&quot;</span><span class="p">])</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccd</span> <span class="o">|</span> <span class="n">cmos</span>

    <span class="n">tab3_no_catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>

    <span class="c1"># Apply Table 3:</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">ccd</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">tab3_no_catalog</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">ccd</span> <span class="o">&amp;</span> <span class="n">tab3_no_catalog</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;704&quot;</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;G96&quot;</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;F51&quot;</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;G45&quot;</span><span class="p">),</span> <span class="mf">0.6</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;699&quot;</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;D29&quot;</span><span class="p">),</span> <span class="mf">0.75</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;C51&quot;</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;E12&quot;</span><span class="p">),</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;608&quot;</span><span class="p">),</span> <span class="mf">0.6</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;J75&quot;</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="c1"># ###################</span>

    <span class="c1"># ###################</span>
    <span class="c1"># TABLE 2: epoch dependant residuals</span>
    <span class="c1"># Table 2 conditions:</span>
    <span class="n">tab2_703_epoch</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&lt;</span> <span class="mf">2456658.0</span>  <span class="c1"># 2014-1-1</span>
    <span class="n">tab2_691_epoch</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&lt;</span> <span class="mf">2452640.0</span>  <span class="c1"># 2003-1-1</span>
    <span class="n">tab2_644_epoch</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">epochJD</span> <span class="o">&lt;</span> <span class="mf">2452883.0</span>  <span class="c1"># 2003-9-1</span>

    <span class="c1"># Apply Table 2:</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">tab2_703_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;703&quot;</span><span class="p">)),</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
        <span class="p">(</span><span class="o">~</span><span class="n">tab2_703_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;703&quot;</span><span class="p">)),</span> <span class="mf">0.8</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">tab2_691_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;691&quot;</span><span class="p">)),</span> <span class="mf">0.6</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
        <span class="p">(</span><span class="o">~</span><span class="n">tab2_691_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;691&quot;</span><span class="p">)),</span> <span class="mf">0.5</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="n">tab2_644_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;644&quot;</span><span class="p">)),</span> <span class="mf">0.6</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
        <span class="p">(</span><span class="o">~</span><span class="n">tab2_644_epoch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;644&quot;</span><span class="p">)),</span> <span class="mf">0.4</span>
    <span class="p">)</span>
    <span class="c1"># ###################</span>

    <span class="c1"># ###################</span>
    <span class="c1"># TABLE 4: Catalog dependant + NEO observers</span>
    <span class="c1"># Table 4 conditions:</span>
    <span class="c1"># NOTE these are the LCO observatories described in the paper</span>
    <span class="n">LCO_original</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;K92&quot;</span><span class="p">,</span>
        <span class="s2">&quot;K93&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Q63&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Q64&quot;</span><span class="p">,</span>
        <span class="s2">&quot;V37&quot;</span><span class="p">,</span>
        <span class="s2">&quot;W84&quot;</span><span class="p">,</span>
        <span class="s2">&quot;W85&quot;</span><span class="p">,</span>
        <span class="s2">&quot;W86&quot;</span><span class="p">,</span>
        <span class="s2">&quot;W87&quot;</span><span class="p">,</span>
        <span class="s2">&quot;K91&quot;</span><span class="p">,</span>
        <span class="s2">&quot;E10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;F65&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># NOTE these are additional LCO observatories, mostly online after publication</span>
    <span class="c1"># Aqawan and Clamshell (0.4m) style observatories have not been included due to their previous omssion in the paper.</span>
    <span class="c1"># Those thus assume the default inv_weight of 1.0</span>
    <span class="c1"># Since remaining 1m telescopes are duplicates of existing observatories, they are included.</span>
    <span class="c1"># Dates retrieved from: https://sbnmpc.astro.umd.edu/mpecwatch/obs.html</span>
    <span class="c1"># See also: https://lco.global/observatory/sites/mpccodes/</span>
    <span class="n">LCO_new</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># &quot;L09&quot;,  # online 2018 Aqawan</span>
        <span class="c1"># &quot;Q58&quot;,  # online 2017 Clamshell</span>
        <span class="c1"># &quot;Q59&quot;,  # online 2017 Clamshell</span>
        <span class="c1"># &quot;T03&quot;,  # online 2017 Clamshell</span>
        <span class="c1"># &quot;T04&quot;,  # online 2016 Clamshell</span>
        <span class="c1"># &quot;V38&quot;,  # online 2018 Aqawan</span>
        <span class="s2">&quot;V39&quot;</span><span class="p">,</span>  <span class="c1"># online 2019 1m</span>
        <span class="c1"># &quot;W79&quot;,  # online 2018 Aqawan</span>
        <span class="c1"># &quot;W89&quot;,  # online 2015 Aqawan</span>
        <span class="c1"># &quot;Z17&quot;,  # online 2017 Aqawan</span>
        <span class="c1"># &quot;Z21&quot;,  # online 2015 Aqawan</span>
        <span class="s2">&quot;Z24&quot;</span><span class="p">,</span>  <span class="c1"># online 2021 1m</span>
        <span class="s2">&quot;Z31&quot;</span><span class="p">,</span>  <span class="c1"># online 2021 1m</span>
    <span class="p">]</span>

    <span class="n">LCO_obs</span> <span class="o">=</span> <span class="n">LCO_original</span> <span class="o">+</span> <span class="n">LCO_new</span>
    <span class="n">tab4_LCO_observatories</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">observatory</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">LCO_obs</span><span class="p">)</span>
    <span class="c1"># NOTE see catalog codes info: https://www.minorplanetcenter.net/iau/info/CatalogueCodes.html</span>
    <span class="n">tab4_Catalog_UCAC4</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span>
    <span class="n">tab4_Catalog_PPMXL</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">&quot;t&quot;</span>
    <span class="n">tab4_Catalog_GAIA</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">])</span>
    <span class="n">tab4_Catalog_USNOB12</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">])</span>

    <span class="n">tab4_G83_UCAC4_PPMXL</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;G83&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_UCAC4</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_PPMXL</span>
    <span class="p">)</span>
    <span class="n">tab4_G83_GAIA</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;G83&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_GAIA</span>

    <span class="n">tab4_Y28_GAIA_PPMXL</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;Y28&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_PPMXL</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_GAIA</span>
    <span class="p">)</span>
    <span class="n">tab4_568_USNOB</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_USNOB12</span>
    <span class="n">tab4_568_GAIA</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_GAIA</span>
    <span class="n">tab4_568_PPMXL</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_PPMXL</span>
    <span class="n">tab4_T09_T12_T14_GAIA</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_GAIA</span>
    <span class="n">tab4_309_UCAC4_PPMXL</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_UCAC4</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_PPMXL</span>
    <span class="p">)</span>
    <span class="n">tab4_309_GAIA</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;568&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">tab4_Catalog_GAIA</span>

    <span class="c1"># Apply Table 4:</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;645&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;673&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;689&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;950&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;H01&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;J04&quot;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_G83_UCAC4_PPMXL</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_G83_GAIA</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_LCO_observatories</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">observatory</span> <span class="o">==</span> <span class="s2">&quot;W84&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># LCO includes W84?</span>

    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_Y28_GAIA_PPMXL</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_568_USNOB</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_568_GAIA</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_568_PPMXL</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_T09_T12_T14_GAIA</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_309_UCAC4_PPMXL</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">inv_w</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">tab4_309_GAIA</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="c1"># ###################</span>

    <span class="c1"># Transform residual into weight:</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">weight_pre</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">inv_w</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Reduce weight if there are more than 4 observations that night:</span>
    <span class="c1"># NOTE For satellites, this is done per julian day.</span>
    <span class="c1"># calculate number of observations on one night at one observatory for one target:</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">observations_on_epoch</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;epochJD_tz_int&quot;</span><span class="p">,</span> <span class="s2">&quot;observatory&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># divide weight by sqrt(N/4) if N &gt; 4 else 1</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">mult_obs_deweight</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">observations_on_epoch</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="mf">1.0</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">weight_pre</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">mult_obs_deweight</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_full_table</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">table</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>


<div class="viewcode-block" id="BatchMPC">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BatchMPC</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class provides an interface between observations</span>
<span class="sd">    in the Minor Planet Centre database and Tudat.</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    Currently, transformations between reference frames are not implemented.</span>
<span class="sd">    As such observations are only returned in the J2000 Frame.</span>

<span class="sd">    Examples</span>
<span class="sd">    ----------</span>
<span class="sd">    Basic sequence of usage:</span>

<span class="sd">    Initialise and retrieve data:</span>

<span class="sd">    &gt;&gt;&gt; MPCcodes = [1, 4] # Ceres and Vesta</span>
<span class="sd">    &gt;&gt;&gt; batch = BatchMPC()</span>
<span class="sd">    &gt;&gt;&gt; batch.get_observations(MPCcodes)</span>
<span class="sd">    &gt;&gt;&gt; batch.filter(epoch_start=datetime.datetime(2016, 1, 1))</span>

<span class="sd">    Transform to Tudat format:</span>
<span class="sd">    &gt;&gt;&gt; ...</span>
<span class="sd">    &gt;&gt;&gt; bodies = environment_setup.create_system_of_bodies(body_settings)</span>
<span class="sd">    &gt;&gt;&gt; observation_collection = batch.to_tudat(bodies=bodies, included_satellites=None)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an empty MPC batch.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observatories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_space_telescopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_station_info</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bodies_created</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_EFCC18_applied</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_weights_set</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># for manual additions of table (from_pandas, from_astropy)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_req_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span> <span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="s2">&quot;observatory&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">BatchMPC</span><span class="p">()</span>

        <span class="n">new</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_refresh_metadata</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new</span>

<div class="viewcode-block" id="BatchMPC.copy">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.copy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BatchMPC&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a copy of the batch, equivalent to copy.copy(batchMPC())</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BatchMPC</span>
<span class="sd">            Copy of batch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


    <span class="c1"># getters to make everything read-only</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pandas dataframe with observation data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observatories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of observatories in batch&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observatories</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">space_telescopes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of satellite_observatories in batch&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">MPC_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of MPC objects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_codes</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of observations in batch&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bands</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of bands in batch&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">epoch_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Epoch of oldest observation in batch in seconds since J2000 TDB&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_start</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Epoch of latest observation in batch in seconds since J2000 TDB&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bodies_created</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary with the bodies created by to_tudat and details.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bodies_created</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">BatchMPC</span><span class="p">()</span>

        <span class="n">temp</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_table</span><span class="p">])</span>
            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">temp</span><span class="o">.</span><span class="n">_refresh_metadata</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">temp</span>

    <span class="c1"># helper functions</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal. Update batch metadata&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_observatories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">observatory</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observatories</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_space_telescopes</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;bands&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">band</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epochJ2000secondsTDB</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epochJ2000secondsTDB</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_station_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal. Retrieve data on MPC listed observatories&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">MPC</span><span class="o">.</span><span class="n">get_observatory_codes</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># This query checks if Longitude is Nan: non-terretrial telescopes</span>
            <span class="n">sats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Longitude != Longitude&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Code</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span> <span class="o">=</span> <span class="n">temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_space_telescopes</span> <span class="o">=</span> <span class="n">sats</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An error occured while retrieving observatory data&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_observatory_positions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bodies</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">SystemOfBodies</span><span class="p">,</span> <span class="n">earth_name</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal. Add observatory cartesian postions to station data&quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span>

        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This error will probably never occur</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Observatory positions can not be assigned.</span>
<span class="s2">                  This is likely due to a failure in retrieving the observatories.&quot;&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="n">r_earth</span> <span class="o">=</span> <span class="n">bodies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">earth_name</span><span class="p">)</span><span class="o">.</span><span class="n">shape_model</span><span class="o">.</span><span class="n">average_radius</span>

        <span class="c1"># Add geocentric cartesian positions</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cos</span> <span class="o">*</span> <span class="n">r_earth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Longitude</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cos</span> <span class="o">*</span> <span class="n">r_earth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Longitude</span><span class="p">)))</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sin</span> <span class="o">*</span> <span class="n">r_earth</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span> <span class="o">=</span> <span class="n">temp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_EFCC18</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bias_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">Nside</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">catalog_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal, applies star catalog biases based on</span>
<span class="sd">        &#39;Star catalog position and proper motion corrections in asteroid astrometry II: The Gaia era&#39; by Eggl et al. (2018)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EFCC18_applied</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">RA_corr</span><span class="p">,</span> <span class="n">DEC_corr</span> <span class="o">=</span> <span class="n">get_biases_EFCC18</span><span class="p">(</span>
                <span class="n">RA</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">RA</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">DEC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">DEC</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">epochJ2000secondsTDB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">epochJ2000secondsTDB</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">catalog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">bias_file</span><span class="o">=</span><span class="n">bias_file</span><span class="p">,</span>
                <span class="n">Nside</span><span class="o">=</span><span class="n">Nside</span><span class="p">,</span>
                <span class="n">catalog_flags</span><span class="o">=</span><span class="n">catalog_flags</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">RA_EFCC18</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">RA</span> <span class="o">-</span> <span class="n">RA_corr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">DEC_EFCC18</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">DEC</span> <span class="o">-</span> <span class="n">DEC_corr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">corr_RA_EFCC18</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">RA_corr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">corr_DEC_EFCC18</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">DEC_corr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_EFCC18_applied</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># methods for data retrievels</span>
<div class="viewcode-block" id="BatchMPC.get_observations">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.get_observations">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_observations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">MPCcodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">drop_misc_observations</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all observations for a set of MPC listed objeccts.</span>
<span class="sd">        This method uses astroquery to retrieve the observations from the MPC.</span>
<span class="sd">        An internet connection is required, observations are cached for faster subsequent retrieval.</span>
<span class="sd">        Removes duplicate and irrelevant observation data by default (see `drop_misc_observations`).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        MPCcodes : List[int]</span>
<span class="sd">            List of integer MPC object codes for minor planets or and comets.</span>
<span class="sd">        drop_misc_observations : bool, default True</span>
<span class="sd">            Drops observations made by method: radar and offset (natural satellites).</span>
<span class="sd">            Drops observations made by roaming observers.</span>
<span class="sd">            Drops duplicate listings to denote first observation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">MPCcodes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MPCcodes parameter must be list of integers/strings&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">MPCcodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;All codes in the MPCcodes parameter must be integers or string&quot;</span>
                <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="n">MPC</span><span class="o">.</span><span class="n">get_observations</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>  <span class="c1"># type: ignore</span>

                <span class="c1"># convert JD to J2000 and UTC, convert deg to rad</span>
                <span class="n">obs</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">obs</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                        <span class="n">epochJ2000secondsTDB</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                            <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;utc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tdb</span><span class="o">.</span><span class="n">value</span>
                            <span class="o">-</span> <span class="mf">2451545.0</span>
                        <span class="p">)</span>
                        <span class="o">*</span> <span class="mi">86400</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">RA</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">RA</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">DEC</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">DEC</span><span class="p">))</span>
                    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">epochUTC</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">())</span>
                <span class="p">)</span>

                <span class="c1"># drop miscellenous observations:</span>
                <span class="k">if</span> <span class="n">drop_misc_observations</span><span class="p">:</span>
                    <span class="n">first_discoveries</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">]</span>
                    <span class="n">roaming</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]</span>
                    <span class="n">radar</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">]</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;O&quot;</span><span class="p">]</span>
                    <span class="n">observation_types_to_drop</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">first_discoveries</span> <span class="o">+</span> <span class="n">roaming</span> <span class="o">+</span> <span class="n">radar</span> <span class="o">+</span> <span class="n">offset</span>
                    <span class="p">)</span>
                    <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;note2 != @observation_types_to_drop&quot;</span><span class="p">)</span>

                <span class="c1"># convert object mpc code to string</span>
                <span class="k">if</span> <span class="s2">&quot;comettype&quot;</span> <span class="ow">in</span> <span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># for the case where we have a comet</span>
                    <span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">desig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">,</span> <span class="n">obs</span><span class="p">])</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occured while retrieving observations of MPC: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_metadata</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_add_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal. Formats a manually entered table of observations, use from_astropy or from_pandas.&quot;&quot;&quot;</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">table</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">epochJ2000secondsTDB</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;utc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tdb</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mf">2451545.0</span>
            <span class="p">)</span>
            <span class="o">*</span> <span class="mi">86400</span>
        <span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">epochUTC</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Time</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;jd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">in_degrees</span><span class="p">:</span>
            <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">RA</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">RA</span><span class="p">))</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
                <span class="n">DEC</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">DEC</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># convert object mpc code to string</span>
        <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">,</span> <span class="n">obs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_metadata</span><span class="p">()</span>

<div class="viewcode-block" id="BatchMPC.from_astropy">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.from_astropy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_astropy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">QTable</span><span class="p">,</span> <span class="n">in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;J2000&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manually input an astropy table with observations into the batch. </span>
<span class="sd">        Usefull when manual filtering from astroquery is required</span>
<span class="sd">        Table must contain the following columns:</span>
<span class="sd">        number - MPC code of the minor planet\\</span>
<span class="sd">        epoch - in julian days\\</span>
<span class="sd">        RA - right ascension in either degrees or radians (degrees is default)\\</span>
<span class="sd">        DEC - declination in either degrees or radians (degrees is default)\\</span>
<span class="sd">        band - band of the observation (currently unused)\\</span>
<span class="sd">        observatory - MPC code of the observatory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table : astropy.table.QTable</span>
<span class="sd">            Astropy table with the observations</span>
<span class="sd">        in_degrees : bool, optional</span>
<span class="sd">            if True RA and DEC are assumed in degrees, else radians, by default True</span>
<span class="sd">        frame : str, optional</span>
<span class="sd">            Reference frame. Please note that only J2000 is currently supported</span>
<span class="sd">            , by default &quot;J2000&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">QTable</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">astropy</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Table must be of type astropy.table.QTable or astropy.table.Table&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">!=</span> <span class="s2">&quot;J2000&quot;</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Only observations in J2000 are supported currently&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="c1"># check if all mandatory names are present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_req_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">colnames</span><span class="p">)):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Table must include a set of mandatory columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_req_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">in_degrees</span><span class="o">=</span><span class="n">in_degrees</span><span class="p">)</span></div>


<div class="viewcode-block" id="BatchMPC.from_pandas">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.from_pandas">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_pandas</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;J2000&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manually input an pandas dataframe with observations into the batch. </span>
<span class="sd">        Usefull when manual filtering from astroquery is required</span>
<span class="sd">        Table must contain the following columns:</span>
<span class="sd">        number - MPC code of the minor planet\\</span>
<span class="sd">        epoch - in julian days\\</span>
<span class="sd">        RA - right ascension in either degrees or radians (degrees is default)\\</span>
<span class="sd">        DEC - declination in either degrees or radians (degrees is default)\\</span>
<span class="sd">        band - band of the observation (currently unused)\\</span>
<span class="sd">        observatory - MPC code of the observatory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table : astropy.table.QTable</span>
<span class="sd">            Astropy table with the observations</span>
<span class="sd">        in_degrees : bool, optional</span>
<span class="sd">            if True RA and DEC are assumed in degrees, else radians, by default True</span>
<span class="sd">        frame : str, optional</span>
<span class="sd">            Reference frame. Please not that only J2000 is currently supported</span>
<span class="sd">            , by default &quot;J2000&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Table must be of type pandas.DataFrame&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">!=</span> <span class="s2">&quot;J2000&quot;</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Only observations in J2000 are supported currently&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="c1"># check if all mandatory names are present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_req_cols</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Table must include a set of mandatory columns: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_req_cols</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">in_degrees</span><span class="o">=</span><span class="n">in_degrees</span><span class="p">)</span></div>


<div class="viewcode-block" id="BatchMPC.set_weights">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.set_weights">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manually set weights per observation. Weights are passed to</span>
<span class="sd">        observation collection when `.to_tudat()` is called. Set the</span>
<span class="sd">        `apply_weights_VFCC17` parameter in `.to_tudat()` to `False` to avoid</span>
<span class="sd">        overwriting. The order of the weights should match the order found in</span>
<span class="sd">        the `.table` parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights : Union[list, np.ndarray, pd.Series]</span>
<span class="sd">            Iterable with weights per observation.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the size of weights does not match the number of observations in</span>
<span class="sd">            the batch table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Weights vector must have same length as number of observations (BatchMPC.table).&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="c1"># this is to avoid errors with indexing in pandas.</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_weights_set</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BatchMPC.filter">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.filter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bands</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">catalogs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">observation_types</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">observatories</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">observatories_exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">epoch_start</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">epoch_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;BatchMPC&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter out observations from the batch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bands : Union[List[str], None], optional</span>
<span class="sd">            List of observation bands to keep in the batch, by default None</span>
<span class="sd">        catalogs : Union[List[str], None], optional</span>
<span class="sd">            List of star catalogs to keep in the batch. See </span>
<span class="sd">            https://www.minorplanetcenter.net/iau/info/CatalogueCodes.html</span>
<span class="sd">            for the exact encodings used by MPC, by default None</span>
<span class="sd">        observation_types : Union[List[str], None], optional</span>
<span class="sd">            List of observation types to keep in the batch, e.g. CCD,</span>
<span class="sd">            Photographic etc. See the Note2 section of the MPC format description:</span>
<span class="sd">            https://www.minorplanetcenter.net/iau/info/OpticalObs.html</span>
<span class="sd">            for the exact encoding, by default None</span>
<span class="sd">        observatories : Union[List[str], None], optional</span>
<span class="sd">            List of observatories to keep in the batch, by default None</span>
<span class="sd">        observatories_exclude : Union[List[str], None], optional</span>
<span class="sd">            List of observatories to remove from the batch, by default None</span>
<span class="sd">        epoch_start : Union[float, datetime.datetime, None], optional</span>
<span class="sd">            Start date to include observations from, can be in python datetime in utc\</span>
<span class="sd">                 or the more conventional tudat seconds since j2000 in TDB if float,\</span>
<span class="sd">                     by default None</span>
<span class="sd">        epoch_end : Union[float, datetime.datetime, None], optional</span>
<span class="sd">            Final date to include observations from, can be in python datetime in utc\</span>
<span class="sd">                 or the more conventional tudat seconds since j2000 in TDB if float,\</span>
<span class="sd">                     by default None</span>
<span class="sd">        in_place : bool, optional</span>
<span class="sd">            If true, modify the current batch object.\</span>
<span class="sd">                  If false returns a new object that is\</span>
<span class="sd">                      filtered, currect batch remains unmodified, by default True</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Is raised if bands, observatories, or observatories_exclude are not list or </span>
<span class="sd">            None.</span>
<span class="sd">        ValueError</span>
<span class="sd">            Is raised if both observations_exclude and observatories are not None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None or BatchMPC</span>
<span class="sd">            Returns a new instance of BatchMPC that is filtered.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># basic user input handling</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">observatories</span><span class="p">,</span> <span class="nb">int</span>
        <span class="p">),</span> <span class="s2">&quot;stations parameter must be of type &#39;str&#39; or &#39;List[str]&#39;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">observatories</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">observatories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;observatories parameter must be list of strings or None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">catalogs</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">catalogs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;catalogs parameter must be list of strings or None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">observation_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">observation_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;observation_types parameter must be list of strings or None&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">observatories_exclude</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">observatories_exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;observatories_exclude parameter must be list of strings or None&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bands parameter must be list of strings or None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">observatories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">observatories_exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Include or exclude observatories, not both at the same time.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;band == @bands&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">catalogs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;catalog == @catalogs&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">observation_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;note2 == @observation_types&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">observatories</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;observatory == @observatories&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">observatories_exclude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;observatory != @observatories_exclude&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epoch_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_start</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_start</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                        <span class="s2">&quot;epochJ2000secondsTDB &gt;= @epoch_start&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_start</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;epochUTC &gt;= @epoch_start&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epoch_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_end</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_end</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                        <span class="s2">&quot;epochJ2000secondsTDB &lt;= @epoch_end&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epoch_end</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;epochUTC &lt;= @epoch_end&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_metadata</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">bands</span><span class="o">=</span><span class="n">bands</span><span class="p">,</span>
                <span class="n">catalogs</span><span class="o">=</span><span class="n">catalogs</span><span class="p">,</span>
                <span class="n">observation_types</span><span class="o">=</span><span class="n">observation_types</span><span class="p">,</span>
                <span class="n">observatories</span><span class="o">=</span><span class="n">observatories</span><span class="p">,</span>
                <span class="n">observatories_exclude</span><span class="o">=</span><span class="n">observatories_exclude</span><span class="p">,</span>
                <span class="n">epoch_start</span><span class="o">=</span><span class="n">epoch_start</span><span class="p">,</span>
                <span class="n">epoch_end</span><span class="o">=</span><span class="n">epoch_end</span><span class="p">,</span>
                <span class="n">in_place</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">new</span></div>


<div class="viewcode-block" id="BatchMPC.to_tudat">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.to_tudat">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_tudat</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bodies</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">SystemOfBodies</span><span class="p">,</span>
        <span class="n">included_satellites</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">station_body</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Earth&quot;</span><span class="p">,</span>
        <span class="n">add_sbdb_gravity_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">apply_weights_VFCC17</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">apply_star_catalog_debias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">debias_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">estimation</span><span class="o">.</span><span class="n">ObservationCollection</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the observations in the batch into a Tudat compatible format and</span>
<span class="sd">          sets up the relevant Tudat infrastructure to support estimation.</span>
<span class="sd">        This method does the following:\\</span>
<span class="sd">            1. (By Default) Applies star catalog debiasing and estimation</span>
<span class="sd">            weight calculation.\\</span>
<span class="sd">            2. Creates an empty body for each minor planet with their MPC code as a </span>
<span class="sd">            name.\\</span>
<span class="sd">            3. Adds this body to the system of bodies inputted to the method.\\</span>
<span class="sd">            4. Retrieves the global position of the terrestrial observatories in </span>
<span class="sd">            the batch and adds these stations to the Tudat environment.\\</span>
<span class="sd">            5. Creates link definitions between each unique terrestrial </span>
<span class="sd">            observatory/ minor planet combination in the batch.\\</span>
<span class="sd">            6. (Optionally) creates a link definition between each </span>
<span class="sd">            space telescope / minor planet combination in the batch. </span>
<span class="sd">            This requires an addional input.\\</span>
<span class="sd">            7. Creates a `SingleObservationSet` object for each unique link that </span>
<span class="sd">            includes all observations for that link.\\</span>
<span class="sd">            8. (By Default) Add the relevant weights to the `SingleObservationSet`</span>
<span class="sd">            per observation.\\</span>
<span class="sd">            8. Returns the observations</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bodies : environment.SystemOfBodies</span>
<span class="sd">            SystemOfBodies containing at least the earth to allow for the placement of </span>
<span class="sd">            terrestrial telescopes</span>
<span class="sd">        included_satellites : Union[Dict[str, str], None], optional</span>
<span class="sd">            A dictionary that links the name of a space telescope used by the user with </span>
<span class="sd">            the observatory code in MPC. Used when utilising observations from space </span>
<span class="sd">            telescopes like TESS and WISE. The keys should be the MPC observatory </span>
<span class="sd">            codes. The values should be the bodies&#39; in the user&#39;s code. The relevant </span>
<span class="sd">            observatory code can be retrieved using </span>
<span class="sd">            the .observatories_table() method, by default None</span>
<span class="sd">        station_body : str, optional</span>
<span class="sd">            Body to attach ground stations to. Does not need to be changed unless the </span>
<span class="sd">            `Earth` body has been renamed, by default &quot;Earth&quot;</span>
<span class="sd">        station_body : bool, optional</span>
<span class="sd">            Adds a central_sbdb gravity model to the object, generated using JPL&#39;s small body database. </span>
<span class="sd">            This option is only available for a limited number of bodies and raises an error if unavailable. </span>
<span class="sd">            See tudatpy.numerical_simulation.environment_setup.gravity_field.central_sbdb for more info.</span>
<span class="sd">            Enabled if True, by default False</span>
<span class="sd">        apply_weights_VFCC17 : bool, optional</span>
<span class="sd">            Applies the weighting scheme as described in: &quot;Statistical analysis of astrometric errors</span>
<span class="sd">            for the most productive asteroid surveys&quot; by Veres et al. (2017). Overwrites custom weights</span>
<span class="sd">            set through the `.set_weights()` method if True, by default True</span>
<span class="sd">        apply_star_catalog_debias : bool, optional</span>
<span class="sd">            Applies star catalog debiasing as described in: &quot;Star catalog position and proper motion corrections </span>
<span class="sd">            in asteroid astrometry II: The Gaia era&quot; by Eggl et al. (2018), by default True</span>
<span class="sd">        debias_kwargs : dict, optional</span>
<span class="sd">            Additional options when applying star catalog debiasing. A different debias file </span>
<span class="sd">            can be set here. Options are set as kwargs using a dictionary, see data._biases.get_biases_EFCC18() </span>
<span class="sd">            for more info, by default dict()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        estimation.ObservationCollection</span>
<span class="sd">            ObservationCollection with the observations found in the batch</span>

<span class="sd">        Examples</span>
<span class="sd">        ----------</span>
<span class="sd">        Using Space Telescopes</span>

<span class="sd">        Create dictionary to link name in tudat with mpc code in batch:</span>

<span class="sd">        &gt;&gt; sats_dict = {&quot;C57&quot;:&quot;TESS&quot;}</span>
<span class="sd">        &gt;&gt; obs = batch1.to_tudat(bodies, included_satellites=sats_dict)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># apply EFCC18 star catalog corrections:</span>
        <span class="k">if</span> <span class="n">apply_star_catalog_debias</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_EFCC18</span><span class="p">(</span><span class="o">**</span><span class="n">debias_kwargs</span><span class="p">)</span>
            <span class="n">RA_col</span> <span class="o">=</span> <span class="s2">&quot;RA_EFCC18&quot;</span>
            <span class="n">DEC_col</span> <span class="o">=</span> <span class="s2">&quot;DEC_EFCC18&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">RA_col</span> <span class="o">=</span> <span class="s2">&quot;RA&quot;</span>
            <span class="n">DEC_col</span> <span class="o">=</span> <span class="s2">&quot;DEC&quot;</span>

        <span class="c1"># Calculate observation weights and update table:</span>
        <span class="k">if</span> <span class="n">apply_weights_VFCC17</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_weights_set</span><span class="p">:</span>
            <span class="n">temp_table</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">get_weights_VFCC17</span><span class="p">(</span>  <span class="c1"># type:ignore</span>
                <span class="n">mpc_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span>
                <span class="n">return_full_table</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># start user input validation</span>
        <span class="c1"># Ensure that Earth is in the SystemOfBodies object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bodies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">station_body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Body </span><span class="si">{</span><span class="n">station_body</span><span class="si">}</span><span class="s2"> is not in bodies, if you have renamed Earth, &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;set the station_body paramater to the new name.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="c1"># Add positions of the observatories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_observatory_positions</span><span class="p">(</span><span class="n">bodies</span><span class="p">,</span> <span class="n">station_body</span><span class="p">)</span>

        <span class="c1"># get satellites to include and exclude</span>
        <span class="k">if</span> <span class="n">included_satellites</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sat_obs_codes_included</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">included_satellites</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="c1"># this appears unused but is used in a pandas query:</span>
            <span class="n">sat_obs_codes_excluded</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">sat_obs_codes_included</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Ensure that the satellite is in the SystemOfBodies object</span>
            <span class="k">for</span> <span class="n">sat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">included_satellites</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bodies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sat</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Body </span><span class="si">{</span><span class="n">sat</span><span class="si">}</span><span class="s2"> is not in bodies&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sat_obs_codes_included</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># this appears unused but is used in a pandas query:</span>
            <span class="n">sat_obs_codes_excluded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span>

        <span class="c1"># end user input validation</span>

        <span class="c1"># get relevant stations positions</span>
        <span class="n">tempStations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Code == @self.observatories&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="p">:,</span> <span class="p">[</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># add station positions to the observations</span>
        <span class="n">observations_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">temp_table</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="n">right</span><span class="o">=</span><span class="n">tempStations</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;observatory&quot;</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># remove the observations from unused satellite observatories</span>
        <span class="n">observations_table</span> <span class="o">=</span> <span class="n">observations_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Code != @sat_obs_codes_excluded&quot;</span><span class="p">)</span>

        <span class="c1"># add asteroid bodies to SystemOfBodies object</span>
        <span class="k">for</span> <span class="n">body</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MPC_codes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bodies</span><span class="o">.</span><span class="n">does_body_exist</span><span class="p">(</span><span class="n">body</span><span class="p">):</span>
                <span class="n">bodies</span><span class="o">.</span><span class="n">create_empty_body</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
                <span class="c1"># save the name of the body added</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bodies_created</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;empty body&quot;</span>

                <span class="k">if</span> <span class="n">add_sbdb_gravity_model</span><span class="p">:</span>
                    <span class="n">add_gravity_field_model</span><span class="p">(</span><span class="n">bodies</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">),</span> <span class="n">central_sbdb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bodies_created</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;empty body + sbdb gravity&quot;</span>

        <span class="c1"># add ground stations to the earth body</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tempStations</span><span class="p">)):</span>
            <span class="n">station_name</span> <span class="o">=</span> <span class="n">tempStations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Code</span>

            <span class="c1"># skip if it is a satellite observatory</span>
            <span class="k">if</span> <span class="n">station_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_telescopes</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">ground_station_settings</span> <span class="o">=</span> <span class="n">environment_setup</span><span class="o">.</span><span class="n">ground_station</span><span class="o">.</span><span class="n">basic_station</span><span class="p">(</span>
                <span class="n">station_name</span><span class="o">=</span><span class="n">station_name</span><span class="p">,</span>
                <span class="n">station_nominal_position</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">tempStations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
                    <span class="n">tempStations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
                    <span class="n">tempStations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

            <span class="c1"># Check if station already exists</span>
            <span class="k">if</span> <span class="n">station_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bodies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">station_body</span><span class="p">)</span><span class="o">.</span><span class="n">ground_station_list</span><span class="p">:</span>
                <span class="c1"># Add the ground station to the environment</span>
                <span class="n">environment_setup</span><span class="o">.</span><span class="n">add_ground_station</span><span class="p">(</span>
                    <span class="n">bodies</span><span class="o">.</span><span class="n">get_body</span><span class="p">(</span><span class="n">station_body</span><span class="p">),</span> <span class="n">ground_station_settings</span>
                <span class="p">)</span>

        <span class="c1"># get unique combinations of mpc bodies and observatories</span>
        <span class="n">unique_link_combos</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">observations_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;observatory&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="n">observation_set_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">unique_link_combos</span><span class="p">:</span>
            <span class="n">MPC_number</span> <span class="o">=</span> <span class="n">combo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">station_name</span> <span class="o">=</span> <span class="n">combo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># CREATE LINKS</span>
            <span class="n">link_ends</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="c1"># observed body link</span>
            <span class="n">link_ends</span><span class="p">[</span><span class="n">observation</span><span class="o">.</span><span class="n">transmitter</span><span class="p">]</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">body_origin_link_end_id</span><span class="p">(</span>
                <span class="n">MPC_number</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">station_name</span> <span class="ow">in</span> <span class="n">sat_obs_codes_included</span><span class="p">:</span>
                <span class="c1"># link for a satellite</span>
                <span class="n">sat_name</span> <span class="o">=</span> <span class="n">included_satellites</span><span class="p">[</span><span class="n">station_name</span><span class="p">]</span>
                <span class="n">link_ends</span><span class="p">[</span><span class="n">observation</span><span class="o">.</span><span class="n">receiver</span><span class="p">]</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">body_origin_link_end_id</span><span class="p">(</span>
                    <span class="n">sat_name</span>
                <span class="p">)</span>
                <span class="n">link_definition</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">link_definition</span><span class="p">(</span><span class="n">link_ends</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># link for a ground station</span>
                <span class="n">link_ends</span><span class="p">[</span><span class="n">observation</span><span class="o">.</span><span class="n">receiver</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">observation</span><span class="o">.</span><span class="n">body_reference_point_link_end_id</span><span class="p">(</span>
                        <span class="n">station_body</span><span class="p">,</span> <span class="n">station_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">link_definition</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">link_definition</span><span class="p">(</span><span class="n">link_ends</span><span class="p">)</span>

            <span class="c1"># get observations, angles and times for this specific link</span>
            <span class="n">observations_for_this_link</span> <span class="o">=</span> <span class="n">observations_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="s2">&quot;number == @MPC_number&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;observatory == @station_name&quot;</span><span class="p">)</span>

            <span class="n">observation_angles</span> <span class="o">=</span> <span class="n">observations_for_this_link</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="p">[</span><span class="n">RA_col</span><span class="p">,</span> <span class="n">DEC_col</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

            <span class="n">observation_times</span> <span class="o">=</span> <span class="n">observations_for_this_link</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">:,</span> <span class="p">[</span><span class="s2">&quot;epochJ2000secondsTDB&quot;</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="c1"># create a set of obs for this link</span>
            <span class="n">observation_set</span> <span class="o">=</span> <span class="n">estimation</span><span class="o">.</span><span class="n">single_observation_set</span><span class="p">(</span>
                <span class="n">observation</span><span class="o">.</span><span class="n">angular_position_type</span><span class="p">,</span>
                <span class="n">link_definition</span><span class="p">,</span>
                <span class="n">observation_angles</span><span class="p">,</span>
                <span class="n">observation_times</span><span class="p">,</span>
                <span class="n">observation</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># apply weights if apply_weights is True or set_weights() has been used.</span>
            <span class="k">if</span> <span class="n">apply_weights_VFCC17</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_weights_set</span><span class="p">:</span>
                <span class="n">observation_weights</span> <span class="o">=</span> <span class="n">observations_for_this_link</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="c1"># this is to make sure the order is RA1, DEC1, 2, 2, 3, 3 etc.</span>
                <span class="n">observation_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">observation_weights</span><span class="p">,</span> <span class="n">observation_weights</span><span class="p">],</span> <span class="s2">&quot;F&quot;</span>
                <span class="p">)</span>

                <span class="n">observation_set</span><span class="o">.</span><span class="n">weights_vector</span> <span class="o">=</span> <span class="n">observation_weights</span>

            <span class="n">observation_set_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observation_set</span><span class="p">)</span>

        <span class="n">observation_collection</span> <span class="o">=</span> <span class="n">estimation</span><span class="o">.</span><span class="n">ObservationCollection</span><span class="p">(</span><span class="n">observation_set_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_collection</span></div>


<div class="viewcode-block" id="BatchMPC.plot_observations_temporal">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.plot_observations_temporal">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_observations_temporal</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">objects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a matplotlib figure with the declination and right ascension</span>
<span class="sd">        over time.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objects : Union[List[str], None], optional</span>
<span class="sd">            List of specific MPC objects in batch to plot, None to plot all</span>
<span class="sd">            , by default None</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            projection of the figure options are: &#39;aitoff&#39;, &#39;hammer&#39;,</span>
<span class="sd">            &#39;lambert&#39; and &#39;mollweide&#39;, by default &quot;aitoff&quot;</span>
<span class="sd">        figsize : Tuple[float], optional</span>
<span class="sd">            size of the matplotlib figure, by default (15, 7)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Matplotlib figure</span>
<span class="sd">            Matplotlib figure with the observations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">axRA</span><span class="p">,</span> <span class="n">axDEC</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MPC_objects</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @obj&quot;</span><span class="p">)</span>

            <span class="n">axRA</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">.</span><span class="n">epochUTC</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">RA</span><span class="p">),</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MPC: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                <span class="c1"># linestyle=None,</span>
            <span class="p">)</span>
            <span class="n">axDEC</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">tab</span><span class="o">.</span><span class="n">epochUTC</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">DEC</span><span class="p">),</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MPC: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
                <span class="c1"># linestyle=None,</span>
            <span class="p">)</span>

        <span class="n">axRA</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Right Ascension $[\deg]$&quot;</span><span class="p">)</span>
        <span class="n">axDEC</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Declination $[\deg]$&quot;</span><span class="p">)</span>
        <span class="n">axDEC</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Time [year]&quot;</span><span class="p">)</span>

        <span class="n">axRA</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">axDEC</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">axRA</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Right Ascension&quot;</span><span class="p">)</span>
        <span class="n">axDEC</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Declination&quot;</span><span class="p">)</span>
        <span class="n">axRA</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

        <span class="n">buffer</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">axRA</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">360</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">)</span>
        <span class="n">axDEC</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="o">-</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">90</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="BatchMPC.plot_observations_sky">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.plot_observations_sky">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_observations_sky</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">objects</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">projection</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">14.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a matplotlib figure with the observations&#39;</span>
<span class="sd">        right ascension and declination over time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objects : Union[List[str], None], optional</span>
<span class="sd">            List of specific MPC objects in batch to plot, None to plot all</span>
<span class="sd">            , by default None</span>
<span class="sd">        projection : str, optional</span>
<span class="sd">            projection of the figure options are: &#39;aitoff&#39;, &#39;hammer&#39;,</span>
<span class="sd">            &#39;lambert&#39; and &#39;mollweide&#39;, by default &quot;aitoff&quot;</span>
<span class="sd">        figsize : Tuple[float], optional</span>
<span class="sd">            size of the matplotlib figure, by default (15, 7)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Matplotlib figure</span>
<span class="sd">            Matplotlib figure with the observations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">projection</span><span class="p">},</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MPC_objects</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">]</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">]</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @objs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @objs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">objs</span><span class="p">):</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @obj&quot;</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">RA</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">if</span> <span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">RA</span><span class="p">),</span>
                <span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">DEC</span><span class="p">)</span> <span class="k">if</span> <span class="n">projection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">DEC</span><span class="p">),</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">))],</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">plasma</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;MPC: &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">epochUTC</span><span class="p">),</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Right Ascension $[\deg]$&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Declination $[\deg]$&quot;</span><span class="p">)</span>

        <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">°&quot;</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">°&quot;</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;aitoff&quot;</span><span class="p">,</span> <span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;mollweide&quot;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">projection</span> <span class="o">==</span> <span class="s2">&quot;lambert&quot;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> %b %Y&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>

        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">startUTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @objs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">endUTC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;number == @objs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> observations between </span><span class="si">{</span><span class="n">startUTC</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">endUTC</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="BatchMPC.summary">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a quick summary of the content of the batch&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Batch Summary:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1. Batch includes </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MPC_codes</span><span class="p">)</span><span class="si">}</span><span class="s2"> minor planets:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MPC_objects</span><span class="p">)</span>
        <span class="n">satObs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;observatory == @self.space_telescopes&quot;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;2. Batch includes </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> observations, including </span><span class="si">{</span><span class="n">satObs</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;observations from space telescopes&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;3. The observations range from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epochUTC</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   In seconds TDB since J2000: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;   In Julian Days: &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;4. The batch contains observations from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observatories</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;observatories, including </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">space_telescopes</span><span class="p">)</span><span class="si">}</span><span class="s2"> space telescopes&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="BatchMPC.observatories_table">
<a class="viewcode-back" href="../../../../mpc.html#tudatpy.data.mpc.BatchMPC.observatories_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">observatories_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">only_in_batch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">only_space_telescopes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_space_telescopes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">include_positions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pandas DataFrame with information about all MPC observatories,</span>
<span class="sd">        Carthesian positions are only available after running the `to_tudat()` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        only_in_batch : bool, optional</span>
<span class="sd">            Filter out observatories that are not in the batch, by default True</span>
<span class="sd">        only_space_telescopes : bool, optional</span>
<span class="sd">            Filter out all observatories except space telescopes, by default False</span>
<span class="sd">        only_space_telescopes : bool, optional</span>
<span class="sd">            Filter out all space telescopes, by default False</span>
<span class="sd">        include_positions : bool, optional</span>
<span class="sd">            Include cartesian positions of the terrestrial telescopes only available</span>
<span class="sd">            after running to_tudat(), by default False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            Dataframe with information about the observatories.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observatory_info</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>

        <span class="n">count_observations</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">temp2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;observatory&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;observatory&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">count_observations</span><span class="p">,</span>
            <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span>
            <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;observatory&quot;</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">only_in_batch</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Code == @self.observatories&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">only_space_telescopes</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Code == @self._MPC_space_telescopes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_space_telescopes</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Code != @self._MPC_space_telescopes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_positions</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">temp</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Tudat Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>